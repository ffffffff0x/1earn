# çˆ¬è™«

---

**æ‹†åˆ†è¿‡ç¨‹**

è¯·æ±‚ï¼Œè¿‡æ»¤(æå–)ï¼Œå­˜å‚¨

---

## çˆ¬è™«çš„è¯·æ±‚

### maven ä¾èµ–

```xml
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpclient</artifactId>
            <version>4.5.12</version>
        </dependency>
```

### getè¯·æ±‚

```java
    public static void main(String[] args) {
        CloseableHttpClient client = HttpClients.createDefault(); //åˆ›å»ºhttpclient å¯¹è±¡ã€‚
        HttpGet httpGet = new HttpGet("https://java.ffffffff0x.com/api");  //åˆ›å»ºgetè¯·æ±‚å¯¹è±¡ã€‚
        CloseableHttpResponse response = null;
        try {
            response = client.execute(httpGet);   //å‘é€getè¯·æ±‚
            if (response.getStatusLine().getStatusCode()==200){
                String s = EntityUtils.toString(response.getEntity(),"utf-8");
                System.out.println(s);
                System.out.println(httpGet);
            }

        } catch (IOException e) {
            e.printStackTrace();
        }finally {
            try {
                response.close();
                client.close();

            } catch (IOException e) {
                e.printStackTrace();
            }

        }
    }
```

### getæºå¸¦å‚æ•°è¯·æ±‚

```java
    public static void main(String[] args) throws URISyntaxException {
        CloseableHttpClient client = HttpClients.createDefault(); //åˆ›å»ºhttpclient å¯¹è±¡ã€‚
        URIBuilder uriBuilder = new URIBuilder("https://java.ffffffff0x.com/api");   //ä½¿ç”¨URIBuilderè®¾ç½®åœ°å€
        uriBuilder.setParameter("page","2");    //è®¾ç½®ä¼ å…¥å‚æ•°
        HttpGet httpGet = new HttpGet(uriBuilder.build());  //åˆ›å»ºgetè¯·æ±‚å¯¹è±¡ã€‚
//        https://xz.aliyun.com/?page=1
        CloseableHttpResponse response = null;
        try {
            response = client.execute(httpGet);   //å‘é€getè¯·æ±‚
            if (response.getStatusLine().getStatusCode()==200){
                String s = EntityUtils.toString(response.getEntity(),"utf-8");
                System.out.println(s);
                System.out.println(httpGet);

            }

        } catch (IOException e) {
            e.printStackTrace();
        }finally {
            try {
                response.close();
                client.close();

            } catch (IOException e) {
                e.printStackTrace();
            }

        }
    }
```

### postè¯·æ±‚

```java
    public static void main(String[] args) {
        CloseableHttpClient client = HttpClients.createDefault();
        HttpPost httpPost = new HttpPost("https://java.ffffffff0x.com/api");
        CloseableHttpResponse response = null;
        try {
            response = client.execute(httpPost);

                String s = EntityUtils.toString(response.getEntity());
                System.out.println(s);
                System.out.println(httpPost);

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
```

åœ¨ get å’Œ post çš„è¯·æ±‚ä¸æºå¸¦å‚æ•°è¯·æ±‚å½“ä¸­ï¼Œget çš„è¯·æ±‚æ–¹å¼å’Œ post çš„è¯·æ±‚æ–¹å¼åŸºæœ¬ç±»ä¼¼ã€‚ä½†æ˜¯åˆ›å»ºè¯·æ±‚å¯¹è±¡æ—¶ï¼Œget è¯·æ±‚ç”¨çš„æ˜¯ HttpGet æ¥ç”Ÿæˆå¯¹è±¡ï¼Œè€Œ Post åˆ™æ˜¯ HttpPost æ¥ç”Ÿæˆå¯¹è±¡ã€‚

### postæºå¸¦å‚æ•°è¯·æ±‚

```java
    public static void main(String[] args) throws IOException {
        CloseableHttpClient client = HttpClients.createDefault();//åˆ›å»ºhttpClientså¯¹è±¡
        HttpPost httpPost = new HttpPost("http://java.ffffffff0x.com/api"); //è®¾ç½®è¯·æ±‚å¯¹è±¡
        List<NameValuePair> params = new ArrayList<NameValuePair>();  //å£°æ˜listé›†åˆï¼Œå­˜å‚¨ä¼ å…¥å‚æ•°
        params.add(new BasicNameValuePair("page","3"));
        UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(params,"utf-8"); //åˆ›å»ºè¡¨å•çš„Entityå¯¹è±¡ï¼Œä¼ å…¥paramså‚æ•°
        httpPost.setEntity(formEntity);   //è®¾ç½®è¡¨å•å†…å®¹åˆ°poståŒ…ä¸­
        CloseableHttpResponse response  = client.execute(httpPost);
        String s = EntityUtils.toString(response.getEntity());
        System.out.println(s);
        System.out.println(s.length());
        System.out.println(httpPost);
    }
```

![](../../../../assets/img/Develop/Java/ç¬”è®°/çˆ¬è™«/1.png)

### èµ°ä»£ç†

```java
        //è®¾ç½®ä»£ç†IPã€ç«¯å£ã€åè®®ï¼ˆè¯·åˆ†åˆ«æ›¿æ¢ï¼‰
        HttpHost proxy = new HttpHost("127.0.0.1", 1080, "http");

        //æŠŠä»£ç†è®¾ç½®åˆ°è¯·æ±‚é…ç½®
        RequestConfig defaultRequestConfig = RequestConfig.custom()
                .setProxy(proxy)
                .build();

        //å®ä¾‹åŒ–CloseableHttpClientå¯¹è±¡
        CloseableHttpClient httpclient = HttpClients.custom().setDefaultRequestConfig(defaultRequestConfig).build();

        //è®¿é—®ç›®æ ‡åœ°å€
        HttpGet httpGet = new HttpGet("https://www.google.com");

        //è¯·æ±‚è¿”å›
        CloseableHttpResponse httpResp = httpclient.execute(httpGet);
        try {
            int statusCode = httpResp.getStatusLine().getStatusCode();
            if (statusCode == HttpStatus.SC_OK) {
                System.out.println("æˆåŠŸ");
            }
        } catch (Exception e) {

        } finally {
            httpResp.close();
        }
```

---

### è¿æ¥æ± 

å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ›å»º HttpClientï¼Œä¼šæœ‰é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥æ± æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

åˆ›å»ºä¸€ä¸ªè¿æ¥æ± å¯¹è±¡ï¼š

```java
PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();

public void setMaxTotal(int max)
        è®¾ç½®æœ€å¤§è¿æ¥æ•°

public void setDefaultMaxPerRoute(int max)
        è®¾ç½®æ¯ä¸ªä¸»æœºçš„å¹¶å‘æ•°
```

åˆ›å»ºè¿æ¥æ± ä»£ç 

```java
    public static void main(String[] args) {
        PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager();
        cm.setMaxTotal(100); //è®¾ç½®æœ€å¤§è¿æ¥æ•°
        cm.setDefaultMaxPerRoute(100);   //è®¾ç½®æ¯ä¸ªä¸»æœºçš„å¹¶å‘æ•°
        doGet(cm);
        doGet(cm);
    }

    private static void doGet(PoolingHttpClientConnectionManager cm) {
        CloseableHttpClient httpClient = HttpClients.custom().setConnectionManager(cm).build();
        HttpGet httpGet = new HttpGet("http://www.baidu.com");
        try {
            CloseableHttpResponse response = httpClient.execute(httpGet);
            String s = EntityUtils.toString(response.getEntity(),"utf-8");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
```

HttpClient è¯·æ±‚é…ç½®

```java
    public static void main(String[] args) throws IOException {
        CloseableHttpClient client = HttpClients.createDefault(); //åˆ›å»ºhttpclient å¯¹è±¡ã€‚
        HttpGet httpGet = new HttpGet("http://www.baidu.com");  //åˆ›å»ºgetè¯·æ±‚å¯¹è±¡ã€‚
        RequestConfig config = RequestConfig.custom().setConnectTimeout(1000) // è®¾ç½®åˆ›å»ºè¿æ¥çš„æœ€é•¿æ—¶é—´
                .setConnectionRequestTimeout(500) //è®¾ç½®è·å–è¿æ¥æœ€é•¿æ—¶é—´
                .setSocketTimeout(500).build();  //è®¾ç½®æ•°æ®ä¼ è¾“æœ€é•¿æ—¶é—´

        httpGet.setConfig(config);
        CloseableHttpResponse response  = client.execute(httpGet);
        String s = EntityUtils.toString(response.getEntity());
        System.out.println(s);
    }
```

## çˆ¬è™«çš„æå–

### jsoup

jsoup æ˜¯ä¸€æ¬¾ Java çš„ HTML è§£æå™¨ï¼Œå¯ç›´æ¥è§£ææŸä¸ª URL åœ°å€ã€HTML æ–‡æœ¬å†…å®¹ã€‚å®ƒæä¾›äº†ä¸€å¥—éå¸¸çœåŠ›çš„ APIï¼Œå¯é€šè¿‡ DOMï¼ŒCSS ä»¥åŠç±»ä¼¼äº jQuery çš„æ“ä½œæ–¹æ³•æ¥å–å‡ºå’Œæ“ä½œæ•°æ®ã€‚

jsoup çš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š
* ä»ä¸€ä¸ª URLï¼Œæ–‡ä»¶æˆ–å­—ç¬¦ä¸²ä¸­è§£æ HTMLï¼›
* ä½¿ç”¨ DOM æˆ– CSS é€‰æ‹©å™¨æ¥æŸ¥æ‰¾ã€å–å‡ºæ•°æ®ï¼›
* å¯æ“ä½œ HTML å…ƒç´ ã€å±æ€§ã€æ–‡æœ¬ï¼›

**maven ä¾èµ–**

```xml
        <dependency>
            <!-- jsoup HTML parser library @ http://jsoup.org/ -->
            <groupId>org.jsoup</groupId>
            <artifactId>jsoup</artifactId>
            <version>1.10.2</version>
        </dependency>
```

æ¥ä¸€æ®µçˆ¬å–è®ºå› title çš„ä»£ç 
```java
    @Test
    public void testUrl() throws Exception {
        Document doc = Jsoup.parse(new URL("https://home.ffffffff0x.com/"),10000);//è®¾ç½®è¯·æ±‚urlä¸è¶…æ—¶æ—¶é—´
        String title = doc.getElementsByTag("title").first().text();// //è·å–titleçš„å†…å®¹
        System.out.println(title);
    }
```

è¿™é‡Œçš„ first() ä»£è¡¨è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œtext() è¡¨ç¤ºè·å–æ ‡ç­¾å†…å®¹

### doméå†å…ƒç´ 

```java
    @Test
    public void TestDom() throws IOException {
        Document doc = Jsoup.parse(new URL("https://ffffffff0x.com/"), 10000);
        String title = doc.getElementsByTag("title").text();
        String h1 = doc.getElementsByTag("h1").text();

        String ex2 = doc.getElementsByClass("ex2").first().text();
        System.out.println("title : "+title);
        System.out.println("h1 : "+h1);
        System.out.println("ex2 : "+ex2);
    }
```

### çˆ¬å–æ–‡ç« 

```java
    @Test
    public void TestDom() throws IOException {
        String url = "https://www.freebuf.com/articles/network/274294.html";

        Document doc = Jsoup.parse(new URL(url), 10000);
        String title = doc.getElementsByTag("title").text();
        String time = doc.getElementsByClass("author-info").text();
        String artical = doc.getElementsByClass("artical-body").text();

        System.out.println("title : "+title);
        System.out.println("time : "+time);
        System.out.println("artical : "+artical);
    }
```

![](../../../../assets/img/Develop/Java/ç¬”è®°/çˆ¬è™«/2.png)

### å¤šçº¿ç¨‹çˆ¬å–

çˆ¬è™«ç±»
```java
public class Climbimp implements Runnable {
    private String url ;

    Lock lock = new ReentrantLock();

    public Climbimp(String url, int pages) {
        this.url = url;
    }

    public void run() {
        lock.lock();
        Document doc = null;
        try {
            doc = Jsoup.parse(new URL(url), 10000);
        } catch (IOException e) {
            e.printStackTrace();
        }
        String title = doc.getElementsByTag("title").text();
        String time = doc.getElementsByClass("author-info").text();
        String artical = doc.getElementsByClass("artical-body").text();

        System.out.println("title : "+title);
        //System.out.println("time : "+time);
        //System.out.println("artical : "+artical);

        lock.unlock();

    }
}
```

ä¸»ç±»
```java
public class main {

    public static void main(String[] args) {

        int Threadlist_num = 50; //çº¿ç¨‹æ•°
        String url = "https://www.freebuf.com/articles/network/274294.html";  //url

        Climbimp climbimpl = new Climbimp(url,pages);

        for (int i = 0; i < Threadlist_num; i++) {
            new Thread(climbimpl).start();
        }
    }
}
```

è¿™é‡Œæ‰§è¡Œä¼šè®¿é—® 50 æ¬¡ https://www.freebuf.com/articles/network/274294.html , ç„¶åå°±è¢« freebuf å° ip äº†ğŸ˜‚

![](../../../../assets/img/Develop/Java/ç¬”è®°/çˆ¬è™«/3.png)

---

## Source & Reference

- https://www.cnblogs.com/nice0e3/p/13488064.html
- https://blog.csdn.net/ly6cyh/article/details/77141346
- https://www.cnblogs.com/nice0e3/p/13488064.html
