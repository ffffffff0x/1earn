```
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                              â–ˆâ–ˆ       â–ˆâ–ˆ
 â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘                                              â–‘â–ˆâ–ˆ      â–‘â–‘
â–‘â–ˆâ–ˆ         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â–‘â–ˆâ–ˆ       â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ
â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆ
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–‘ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ â–‘ â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆ
       â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘ â–‘â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘       â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–ˆâ–ˆâ–‘â–ˆâ–ˆ
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆ   â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ â–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆ
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘     â–‘â–‘â–‘â–‘â–‘â–‘       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘ â–‘â–‘â–‘   â–‘â–‘  â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘   â–‘â–‘
```

<p align="center">
    <a href="https://commons.wikimedia.org/wiki/File:William_J._McCloskey_(1859%E2%80%931941),_Wrapped_Oranges,_1889._Oil_on_canvas._Amon_Carter_Museum_of_American_Art.jpg"><img src="../../../assets/img/banner/Secure-Linux.jpg" width="90%"></a>
</p>

<p align="center">
    <a href="https://github.com/ellerbrock/open-source-badges/"><img src="../../../assets/img/Integrated/Linux/open-source.png" width="15%"></a>
    <a href="https://github.com/ellerbrock/open-source-badges/"><img src="../../../assets/img/Integrated/Linux/bash.png" width="15%"></a>
</p>

- `Linux åŠ å›º+ç»´æŠ¤+åº”æ€¥å“åº”å‚è€ƒ`
- `æ–‡æ¡£å†…å®¹ä»…é™ Linux ,web æœåŠ¡å’Œä¸­é—´ä»¶çš„åŠ å›ºå†…å®¹è¯·çœ‹` [åŠ å›º](../../Security/BlueTeam/åŠ å›º.md)

---

# å¤§çº²

* [æ–‡ä»¶](#æ–‡ä»¶)
    * [å¯ç–‘æ–‡ä»¶](#å¯ç–‘æ–‡ä»¶)
    * [æ–‡ä»¶æ¢å¤](#æ–‡ä»¶æ¢å¤)
* [ç³»ç»Ÿ](#ç³»ç»Ÿ)
    * [å¯†ç é‡ç½®](#å¯†ç é‡ç½®)
    * [ä¼šè¯](#ä¼šè¯)
    * [å¼€æœºå¯åŠ¨](#å¼€æœºå¯åŠ¨)
    * [è´¦å·](#è´¦å·)
    * [SELinux](#selinux)
    * [è¿›ç¨‹](#è¿›ç¨‹)
    * [ç³»ç»Ÿå®Œæ•´æ€§](#ç³»ç»Ÿå®Œæ•´æ€§)
    * [æ—¥å¿—](#æ—¥å¿—)
* [Net](#Net)
    * [ç«¯å£](#ç«¯å£)
    * [Firewall](#firewall)
    * [ç¦ping](#ç¦ping)
    * [SSH](#ssh)
    * [æ–‡ä»¶å…±äº«](æ–‡ä»¶å…±äº«)
* [åŠ å›º](#åŠ å›º)

---

# æ–‡ä»¶
## å¯ç–‘æ–‡ä»¶

### æœ€è¿‘æ–‡ä»¶

```bash
find / -ctime -2                # æŸ¥æ‰¾72å°æ—¶å†…æ–°å¢çš„æ–‡ä»¶
find ./ -mtime 0 -name "*.jsp"  # æŸ¥æ‰¾24å°æ—¶å†…è¢«ä¿®æ”¹çš„ JSP æ–‡ä»¶
find / *.jsp -perm 4777         # æŸ¥æ‰¾777çš„æƒé™çš„æ–‡ä»¶
```

### ä¸´æ—¶æ–‡ä»¶

```bash
ls -a /tmp                      # æŸ¥çœ‹ä¸´æ—¶ç›®å½•
```

### é…ç½®æ–‡ä»¶

```bash
strings /usr/sbin/sshd | egrep '[1-9]{1,3}.[1-9]{1,3}.'    # åˆ†æ sshd æ–‡ä»¶ï¼Œæ˜¯å¦åŒ…æ‹¬IPä¿¡æ¯
```

---

## æ–‡ä»¶æ¢å¤

`ä¸€ç‚¹å»ºè®® : ä¸šåŠ¡ç³»ç»Ÿ,rm åˆ é™¤å,æ²¡æœ‰ç«‹å³å…³æœº,è¿è¡Œçš„ç³»ç»Ÿä¼šæŒç»­è¦†ç›–è¯¯åˆ æ•°æ®.æ‰€ä»¥å¯¹äºé‡è¦æ•°æ®,è¯¯åˆ åè¯·ç«‹å³å…³æœº`

**[foremost](http://foremost.sourceforge.net/)**
```bash
apt-get install -y foremost
rm -f /dev/sdb1/photo1.png

foremost -t png -i /dev/sdb1
# æ¢å¤å®Œæˆåä¼šåœ¨å½“å‰ç›®å½•å»ºç«‹ä¸€ä¸ª output ç›®å½•,åœ¨ output ç›®å½•ä¸‹ä¼šå»ºç«‹ png å­ç›®å½•ä¸‹ä¼šåŒ…æ‹¬æ‰€æœ‰å¯ä»¥æ¢å¤çš„ png æ ¼å¼çš„æ–‡ä»¶.
# éœ€è¦è¯´æ˜çš„æ˜¯ png å­ç›®å½•ä¸‹ä¼šåŒ…æ‹¬çš„ png æ ¼å¼çš„æ–‡ä»¶åç§°å·²ç»æ”¹å˜,å¦å¤– output ç›®å½•ä¸‹çš„ audit.txt æ–‡ä»¶æ˜¯æ¢å¤æ–‡ä»¶åˆ—è¡¨.
```

**[extundelete](http://extundelete.sourceforge.net/)**
```bash
apt-get install -y extundelete
mkdir -p /backupdate/deldate
mkfs.ext4 /dev/sdd1
mount /dev/sdd1 /backupdate
cd /backupdate/deldate
touch del1.txt
echo " test 1" > del1.txt
md5sum del1.txt             # è·å–æ–‡ä»¶æ ¡éªŒç 
66fb6627dbaa37721048e4549db3224d  del1.txt
rm -fr /backupdate/*
umount /backupdate          # å¸è½½æ–‡ä»¶ç³»ç»Ÿæˆ–è€…æŒ‚è½½ä¸ºåªè¯»

extundelete /dev/sdd1 --inode 2                                 #æŸ¥è¯¢æ¢å¤æ•°æ®ä¿¡æ¯,æ³¨æ„è¿™é‡Œçš„ --inode 2 è¿™é‡Œä¼šæ‰«æåˆ†åŒº :
extundelete /dev/sdd1 --restore-file del1.txt                   # å¦‚æœæ¢å¤ä¸€ä¸ªç›®å½•
extundelete /dev/sdd1 --restore-directory /backupdate/deldate   # æ¢å¤æ‰€æœ‰æ–‡ä»¶
extundelete /dev/sdd1 --restore-all                             # è·å–æ¢å¤æ–‡ä»¶æ ¡éªŒç ,å¯¹æ¯”æ£€æµ‹æ˜¯å¦æ¢å¤æˆåŠŸ
md5sum RECOVERED_FILES/ del1.txt
66fb6627dbaa37721048e4549db3224d  RECOVERED_FILES/del1.txt
```

**[ext3grep](https://code.google.com/archive/p/ext3grep/downloads)**

å¦‚æœè¢«è¯¯åˆ çš„æ–‡ä»¶åœ¨æ ¹åˆ†åŒº,é‚£ä¹ˆä½ æœ€å¥½é‡å¯è®¡ç®—æœº,è¿›å…¥å•ç”¨æˆ·æ¨¡å¼,ä»¥åªè¯»çš„æ–¹å¼æŒ‚è½½æ ¹åˆ†åŒº,ç„¶åå†è¿›è¡Œæ¢å¤.

è¿›å…¥å•ç”¨æˆ·æ¨¡å¼å,æ ¹åˆ†åŒºè¿˜æ˜¯ä»¥è¯»å†™æ–¹å¼ mount çš„,ç”¨ä¸‹é¢çš„å‘½ä»¤,æŠŠæŒ‚è½½æ–¹å¼ç”±è¯»å†™(rw)æ”¹ä¸ºåªè¯»(ro):  `mount -o ro,remount / `

å¦‚æœè¢«åˆ é™¤çš„æ–‡ä»¶ä¸æ˜¯æ ¹åˆ†åŒº,ä¹Ÿå¯ä»¥ç”¨ unmount çš„æ–¹å¼å°†è¯¥åˆ†åŒºå¸è½½.å‡è®¾æ–‡ä»¶åœ¨åˆ†åŒº /dev/sda3ä¸­,è¯¥åˆ†åŒºæŒ‚è½½åˆ° /home,é‚£ä¹ˆæˆ‘ä»¬ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¸è½½: `umount /dev/sda3 `

å½“ç„¶,åœ¨å¸è½½å‰è¦ä¿è¯æ²¡æœ‰ç¨‹åºåœ¨è®¿é—®è¯¥åˆ†åŒº,å¦åˆ™å¸è½½ä¼šå¤±è´¥.æ‰€ä»¥,ä¸€èˆ¬æ¨èè¿›å…¥å•ç”¨æˆ·æ¨¡å¼æ¥æ¢å¤æ–‡ä»¶.

*å®‰è£…*

è®¿é—® https://code.google.com/archive/p/ext3grep/downloads ä¸‹è½½æºä»£ç ,è¿™é‡Œä»¥ ext3grep-0.10.2.tar.gz ä¸ºä¾‹
```bash
yum install -y e2fsprogs
yum install -y e2fsprogs-devel
tar zxf ext3grep-0.10.2.tar.gz
cd ./ext3grep-0.10.2
./configure
make
make install
```

å¦‚æœ make å‡ºé”™,ä¿®æ”¹ src/ext3.h
```C
// ext3grep -- An ext3 file system investigation and undelete tool
//
//! @file ext3.h Declaration of ext3 types and macros.
//
// Copyright (C) 2008, by
//
// Carlo Wood, Run on IRC <carlo@alinoe.com>
// RSA-1024 0x624ACAD5 1997-01-26                    Sign & Encrypt
// Fingerprint16 = 32 EC A7 B6 AC DB 65 A6  F6 F6 55 DD 1C DC FF 61
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.

#ifndef EXT3_H
#define EXT3_H
#ifdef _LINUX_EXT2_FS_H
#error please include this file before any other includes of ext2fs/ext2_fs.h
#endif
#define s_clusters_per_group s_frags_per_group

// Use the header files from e2progs (http://e2fsprogs.sourceforge.net)
// We can use these headers and then everything named ext2 or ext3.
#include <ext2fs/ext2_fs.h>			// Definitions of ext2, ext3 and ext4.

// All of the following is backwards compatible, so we can use the EXT2 versions.
#define EXT3_BLOCK_SIZE		EXT2_BLOCK_SIZE
#define EXT3_FRAG_SIZE		EXT2_FRAG_SIZE
#define EXT3_BLOCKS_PER_GROUP	EXT2_BLOCKS_PER_GROUP
#define EXT3_INODES_PER_GROUP	EXT2_INODES_PER_GROUP
#define EXT3_FIRST_INO		EXT2_FIRST_INO
#define EXT3_INODE_SIZE		EXT2_INODE_SIZE
#define EXT3_BLOCK_SIZE_BITS	EXT2_BLOCK_SIZE_BITS
#define EXT3_DESC_PER_BLOCK	EXT2_DESC_PER_BLOCK
#define EXT3_DIR_ROUND		EXT2_DIR_ROUND
#define EXT3_DIR_REC_LEN	EXT2_DIR_REC_LEN
#define EXT3_FT_DIR		EXT2_FT_DIR
#define EXT3_FT_UNKNOWN		EXT2_FT_UNKNOWN
#define EXT3_FT_MAX		EXT2_FT_MAX
#define EXT3_MAX_BLOCK_SIZE	EXT2_MAX_BLOCK_SIZE
#define EXT3_NDIR_BLOCKS	EXT2_NDIR_BLOCKS
#define EXT3_IND_BLOCK		EXT2_IND_BLOCK
#define EXT3_DIND_BLOCK		EXT2_DIND_BLOCK
#define EXT3_TIND_BLOCK		EXT2_TIND_BLOCK
#define EXT3_VALID_FS		EXT2_VALID_FS
#define EXT3_ERROR_FS		EXT2_ERROR_FS
#define EXT3_FT_REG_FILE	EXT2_FT_REG_FILE
#define EXT3_FT_CHRDEV		EXT2_FT_CHRDEV
#define EXT3_FT_BLKDEV		EXT2_FT_BLKDEV
#define EXT3_FT_FIFO		EXT2_FT_FIFO
#define EXT3_FT_SOCK		EXT2_FT_SOCK
#define EXT3_FT_SYMLINK		EXT2_FT_SYMLINK
#define EXT3_N_BLOCKS		EXT2_N_BLOCKS
#define EXT3_DIR_PAD		EXT2_DIR_PAD
#define EXT3_ROOT_INO		EXT2_ROOT_INO
#define EXT3_I_SIZE		EXT2_I_SIZE
#define EXT3_FEATURE_COMPAT_DIR_PREALLOC	EXT2_FEATURE_COMPAT_DIR_PREALLOC
#define EXT3_FEATURE_COMPAT_IMAGIC_INODES	EXT2_FEATURE_COMPAT_IMAGIC_INODES
#define EXT3_FEATURE_COMPAT_EXT_ATTR		EXT2_FEATURE_COMPAT_EXT_ATTR
#define EXT3_FEATURE_COMPAT_RESIZE_INODE	EXT2_FEATURE_COMPAT_RESIZE_INODE
#define EXT3_FEATURE_COMPAT_DIR_INDEX		EXT2_FEATURE_COMPAT_DIR_INDEX
#define EXT3_FEATURE_INCOMPAT_COMPRESSION	EXT2_FEATURE_INCOMPAT_COMPRESSION
#define EXT3_FEATURE_INCOMPAT_FILETYPE		EXT2_FEATURE_INCOMPAT_FILETYPE
#define EXT3_FEATURE_INCOMPAT_META_BG		EXT2_FEATURE_INCOMPAT_META_BG
#define EXT3_FEATURE_RO_COMPAT_SPARSE_SUPER	EXT2_FEATURE_RO_COMPAT_SPARSE_SUPER
#define EXT3_FEATURE_RO_COMPAT_LARGE_FILE	EXT2_FEATURE_RO_COMPAT_LARGE_FILE
#define EXT3_FEATURE_RO_COMPAT_BTREE_DIR	0x0004
typedef ext2_super_block ext3_super_block;
typedef ext2_group_desc ext3_group_desc;
typedef ext2_inode ext3_inode;
typedef ext2_dir_entry_2 ext3_dir_entry_2;

// Get declaration of journal_superblock_t
#include <ext2fs/ext2fs.h>
// This header is a copy from e2fsprogs-1.40.7 except that the type
// of 'journal_revoke_header_t::r_count' was changed from int to __s32.
#include "kernel-jbd.h"

#ifndef USE_PCH
#include <stdint.h>
#endif

extern uint32_t inode_count_;

// This (POD) struct protects it's members so we
// can do access control for debugging purposes.

struct Inode : protected ext3_inode {
  public:
    __u16 mode(void) const { return i_mode; }
    __u16 uid_low(void) const { return i_uid_low; }
    off_t size(void) const { return EXT3_I_SIZE(this); }
    __u32 atime(void) const { return i_atime; }
    __u32 ctime(void) const { return i_ctime; }
    __u32 mtime(void) const { return i_mtime; }
    __u32 dtime(void) const { return i_dtime; }
    __u16 gid_low(void) const { return i_gid_low; }
    __u16 links_count(void) const { return i_links_count; }
    __u32 blocks(void) const { return i_blocks; }
    __u32 flags(void) const { return i_flags; }
    __u32 const* block(void) const { return i_block; }
    __u32 generation(void) const { return i_generation; }
    __u32 file_acl(void) const { return i_file_acl; }
    __u32 dir_acl(void) const { return i_dir_acl; }
    __u32 faddr(void) const { return i_faddr; }
    __u16 uid_high(void) const { return i_uid_high; }
    __u16 gid_high(void) const { return i_gid_high; }

    #ifndef i_reseved2
    #define i_reserved2 osd2.hurd2.h_i_author
#endif
    __u32 reserved2(void) const { return i_reserved2; }
    void set_reserved2(__u32 val) { i_reserved2 = val; }

    // Returns true if this inode is part of an ORPHAN list.
    // In that case, dtime is overloaded to point to the next orphan and contains an inode number.
    bool is_orphan(void) const
    {
       // This relies on the fact that time_t is larger than the number of inodes.
       // Assuming we might deal with files as old as five years, then this would
       // go wrong for partitions larger than ~ 8 TB (assuming a block size of 4096
       // and twice as many blocks as inodes).
       return i_links_count == 0 && i_atime && i_dtime < i_atime && i_dtime <= inode_count_;
    }

    // This returns true if dtime() is expected to contain a date.
    bool has_valid_dtime(void) const
    {
      return i_dtime && !is_orphan();
    }

    // This returns true if the inode appears to contain data refering to a previously
    // deleted file, directory or symlink but does not contain the block list anymore.
    // That means it will return false for orphan-ed inodes, although they are basically
    // (partially) deleted.
    bool is_deleted(void) const
    {
      return i_links_count == 0 && i_mode && (i_block[0] == 0 ||
                                              !((i_mode & 0xf000) == 0x4000 || (i_mode & 0xf000) == 0x8000));
    }
};

#endif // EXT3_H
```

*ä½¿ç”¨*

åœ¨å¼€å§‹æ¢å¤å‰,é€‰æ‹©ä¸€ä¸ªç›®å½•æ¥å­˜æ”¾è¢«æ¢å¤çš„æ–‡ä»¶.ext3grep ç¨‹åºä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º RESTORED_FILES çš„ç›®å½•æ¥å­˜æ”¾è¢«æ¢å¤çš„æ–‡ä»¶.å› æ­¤åœ¨è¿è¡Œ ext3grep å‘½ä»¤å‰,å…ˆè¦åˆ‡æ¢åˆ°ä¸€ä¸ªä½ å¯è¯»å†™çš„ç›®å½•ä¸­.

å› ä¸ºè¿›å…¥äº†å•ç”¨æˆ·æ¨¡å¼,å¹¶ä¸”å°†æ ¹åˆ†åŒºè®¾æˆäº†åªè¯»,é‚£ä¹ˆåªèƒ½æŠŠæ¢å¤å‡ºæ¥çš„æ–‡ä»¶æ”¾åœ¨Uç›˜ä¸­äº†.å› æ­¤,å…ˆ cd /mnt è¿›å…¥Uç›˜ç›®å½•.å¦‚æœä½ æœ‰å¹¸è®°å¾—ä½ è¯¯åˆ é™¤çš„æ–‡ä»¶ååŠå…¶è·¯å¾„çš„è¯,å°±å¯ä»¥ç›´æ¥ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæ¢å¤äº†:
```bash
ext3grep /dev/your-device --restore-file path/to/your/file/filename
# éœ€è¦æ³¨æ„çš„æ˜¯,ä¸Šé¢çš„æ–‡ä»¶è·¯å¾„,æ˜¯åœ¨è¯¥åˆ†åŒºä¸Šæ–‡ä»¶è·¯å¾„.å‡è®¾æˆ‘ä»¬è¦æ¢å¤ /dev/sda3 åˆ†åŒºä¸Šæ–‡ä»¶,è¿™ä¸ªåˆ†åŒºåŸæ¥çš„å®‰è£…ç‚¹æ˜¯ /home,ç°åœ¨æƒ³æ¢å¤æ–‡ä»¶ /home//vi/tips.xml,é‚£ä¹ˆè¾“å…¥çš„å‘½ä»¤åº”è¯¥æ˜¯:

ext3grep /dev/sda3 --restore-file /vi/tips.xml

# å¦‚æœä½ å¿˜è®°äº†æ–‡ä»¶å,æˆ–è€…ä½ è¯¯åˆ é™¤çš„æ˜¯ä¸€ä¸ªç›®å½•è€Œä½ æ— æ³•è®°å…¨è¯¥ç›®å½•ä¸­çš„æ–‡ä»¶,ä½ å¯ä»¥å…ˆç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢ä¸€ä¸‹æ–‡ä»¶å:
ext3grep /dev/sda3 --dump-names | tee filename.txt

ä¸Šé¢çš„å‘½ä»¤æŠŠ ext3grep å‘½ä»¤çš„è¾“å‡ºè®°å½•åˆ°æ–‡ä»¶ filename.txt ä¸­,ä½ å¯ä»¥æ…¢æ…¢æŸ¥çœ‹,æˆ–è€…ä½¿ç”¨ grep å‘½ä»¤è¿‡æ»¤å‡ºä½ éœ€è¦çš„ä¿¡æ¯.

å½“ä½ çŸ¥é“äº†ç›®å½•/æ–‡ä»¶çš„ä¿¡æ¯å,å°±å¯ä»¥ç”¨ä¸Šé¢è¯´çš„å‘½ä»¤è¿›è¡Œæ¢å¤äº†.

# è¿™æ¬¾è½¯ä»¶ä¸èƒ½æŒ‰ç›®å½•æ¢å¤æ–‡ä»¶,åªèƒ½æ‰§è¡Œæ¢å¤å…¨éƒ¨å‘½ä»¤:
ext3grep /dev/sda3 --restore-all
```

*binlog*

å¼€å¯ Binlog,è®© ext3grep ä» Binlog ä¸­æ¢å¤,å¯¹æ•°æ®åº“åœºæ™¯æœ‰ç”¨.

---

# ç³»ç»Ÿ
## å¯†ç é‡ç½®

### centos7

1. åœ¨å¯åŠ¨èœå•é€‰æ‹©å¯åŠ¨å†…æ ¸,æŒ‰ e ç¼–è¾‘,æ‰¾åˆ° rhgb quiet ä¸€è¡Œ,æŠŠ `rhgb quiet` æ›¿æ¢ä¸º `init=/bin/bash` (ä¸´æ—¶ç”Ÿæ•ˆ)
2. æŒ‰ `CTRL+X` è¿›å…¥å•ç”¨æˆ·æ¨¡å¼
3. æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ: `mount -o remount,rw /`
4. ä½¿ç”¨ `passwd` å‘½ä»¤ç›´æ¥è®¾ç½® root å¯†ç : `passwd root` è¾“å…¥ä¸¤æ¬¡æ–°å¯†ç .
5. æœ€å,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ›´æ–° SELinux: `touch /.autorelabel`
6. è¿›å…¥æ­£å¸¸æ¨¡å¼: `exec /sbin/init`  ç°åœ¨å¯ä»¥ä½¿ç”¨æ–°è®¾ç½®çš„ root å¯†ç ç™»å½•äº†.

### Ubuntu14

- æ–¹æ¡ˆä¸€
    1. é‡å¯ç”µè„‘é•¿æŒ‰ shift é”®ç›´åˆ°è¿›å…¥è¿›å…¥ GRUB å¼•å¯¼æ¨¡å¼ï¼Œé€‰æ‹©ç¬¬äºŒè¡Œ Ubuntu é«˜çº§é€‰é¡¹, é€‰ä¸­ç›´æ¥å›è½¦
    2. æŒ‰ e è¿›å…¥ï¼ˆrecovery modeï¼‰ ç¼–è¯‘kernelè¿›è¡Œå¯åŠ¨å‚æ•°
    3. å€’æ•°ç¬¬å››è¡Œï¼Œåˆ é™¤ `recovery nomodeset` ,æ·»åŠ  `quiet splash rw init=/bin/bash` ã€‚ç„¶åæŒ‰ F10, å¯åŠ¨ã€‚
    4. è¿è¡Œåç³»ç»Ÿç›´æ¥è¿›å…¥ root modeï¼Œè¾“å…¥ï¼š`passwd`

- æ–¹æ¡ˆäºŒ
    1. é‡å¯ç”µè„‘é•¿æŒ‰ shift é”®ç›´åˆ°è¿›å…¥è¿›å…¥ GRUB å¼•å¯¼æ¨¡å¼ï¼Œé€‰æ‹©ç¬¬äºŒè¡Œ Ubuntu é«˜çº§é€‰é¡¹, é€‰ä¸­ç›´æ¥å›è½¦
    2. é€‰æ‹©ä¸€ä¸ªæ‹¬å·é‡Œæ˜¯ recovery mode çš„ç³»ç»Ÿå‘è¡Œç¼–å·ï¼Œå›è½¦è¿›å…¥
    3. é€‰æ‹© root é¡¹ï¼Œå›è½¦
    4. æœ€ä¸‹æ–¹è¾“å…¥ root å¯†ç ï¼Œå›è½¦ï¼Œä¾¿ä¼šåˆ‡æ¢åˆ° root ç”¨æˆ·ï¼›æ­¤æ—¶éœ€è¦è¾“å…¥æ­¤æ¡å‘½ä»¤ `mount -o remount,rw /` å›è½¦ï¼Œå†ç”¨ `passwd ç”¨æˆ·å` ä¾¿å¯ä»¥ä¿®æ”¹å¯†ç äº†ï¼›
    5. ç»§ç»­è¾“å…¥ `exit` è¿”å›ï¼Œé€‰ä¸­ `resume`ï¼Œå›è½¦ï¼Œæ­¤æ—¶ä¼šè·³å‡ºä¸€ä¸ªç¡®è®¤ç•Œé¢ï¼Œå†å›è½¦å³å¯

---

## ä¼šè¯

### æŸ¥

```bash
who     # æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·
w       # æŸ¥çœ‹ç™»å½•ç”¨æˆ·è¡Œä¸º
last    # æŸ¥çœ‹ç™»å½•ç”¨æˆ·å†å²
```

### é˜²

```bash
pkill -u linfengfeiye   # ç›´æ¥å‰”é™¤ç”¨æˆ·
ps -ef| grep pts/0      # å¾—åˆ°ç”¨æˆ·ç™»å½•ç›¸åº”çš„è¿›ç¨‹å· pid åæ‰§è¡Œ
kill -9 pid             # å®‰å…¨å‰”é™¤ç”¨æˆ·
```

### ä¿®æ”¹è´¦æˆ·è¶…æ—¶å€¼,è®¾ç½®è‡ªåŠ¨æ³¨é”€æ—¶é—´

```
vim /etc/profile

TMOUT=600
```

### å‘½ä»¤è®°å½•

```bash
histroy                 # æŸ¥çœ‹ root çš„å†å²å‘½ä»¤
```
è¿›å…¥ `/home` å„å¸å·ç›®å½•ä¸‹çš„ `.bash_history` æŸ¥çœ‹æ™®é€šå¸å·çš„å†å²å‘½ä»¤

**historyä¼˜åŒ–**
```bash
# ä¿å­˜1ä¸‡æ¡å‘½ä»¤
sed -i 's/^HISTSIZE=1000/HISTSIZE=10000/g' /etc/profile

# è®°å½•IPï¼Œåœ¨ /etc/profile çš„æ–‡ä»¶å°¾éƒ¨æ·»åŠ å¦‚ä¸‹è¡Œæ•°é…ç½®ä¿¡æ¯
USER_IP=`who -u am i 2>/dev/null | awk '{print $NF}' | sed -e 's/[()]//g'`
if [ "$USER_IP" = "" ]
then
USER_IP=`hostname`
fi
export HISTTIMEFORMAT="%F %T $USER_IP `whoami` "
shopt -s histappend
export PROMPT_COMMAND="history -a"

# è®©é…ç½®ç”Ÿæ•ˆ
source /etc/profile
```

---

## å¼€æœºå¯åŠ¨

### æŸ¥çœ‹å¼€æœºå¯åŠ¨æœåŠ¡

```bash
chkconfig                   # æŸ¥çœ‹å¼€æœºå¯åŠ¨æœåŠ¡å‘½ä»¤
chkconfig --list | grep "3:å¯ç”¨\|3:å¼€\|3:on\|5:å¯ç”¨\|5:å¼€\|5:on"

ls /etc/init.d              # æŸ¥çœ‹å¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶å‘½ä»¤
cat /etc/rc.local           # æŸ¥çœ‹ rc å¯åŠ¨æ–‡ä»¶
ls /etc/rc.d/rc[0~6].d

runlevel                    # æŸ¥çœ‹è¿è¡Œçº§åˆ«å‘½ä»¤
```

### æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡

```bash
crontab -l                  # è®¡åˆ’ä»»åŠ¡åˆ—è¡¨
ls -alh /var/spool/cron     # é»˜è®¤ç¼–å†™çš„ crontab æ–‡ä»¶ä¼šä¿å­˜åœ¨ /var/spool/cron/ç”¨æˆ·å ä¸‹
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny
cat /etc/crontab
cat /etc/anacrontab
cat /var/spool/cron/crontabs/root
```

---

## è´¦å·

### å¼‚å¸¸æŸ¥æ‰¾
```bash
awk -F: '{if($3==0||$4==0)print $1}' /etc/passwd            # æŸ¥çœ‹ UID\GID ä¸º0çš„å¸å·
awk -F: '{if($7!="/usr/sbin/nologin"&&$7!="/sbin/nologin")print $1}' /etc/passwd # æŸ¥çœ‹èƒ½å¤Ÿç™»å½•çš„å¸å·
awk '/\$1|\$6/{print $1}' /etc/shadow                       # æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯
lastlog                                                     # ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æœ€è¿‘ä¸€æ¬¡ç™»å½•ä¿¡æ¯
lastb                                                       # æ˜¾ç¤ºç”¨æˆ·é”™è¯¯çš„ç™»å½•åˆ—è¡¨
users                                                       # æ‰“å°å½“å‰ç™»å½•çš„ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·åå¯¹åº”ä¸€ä¸ªç™»å½•ä¼šè¯ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·ä¸æ­¢ä¸€ä¸ªç™»å½•ä¼šè¯ï¼Œå…¶ç”¨æˆ·åæ˜¾ç¤ºç›¸åŒæ¬¡æ•°
```

### å¼‚å¸¸è®¾ç½®

**/etc/passwd**
- è‹¥ç”¨æˆ· ID=0,åˆ™è¡¨ç¤ºè¯¥ç”¨æˆ·æ‹¥æœ‰è¶…çº§ç”¨æˆ·çš„æƒé™
- æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ª ID=0
- ç¦ç”¨æˆ–åˆ é™¤å¤šä½™çš„è´¦å·

**/etc/login.defs**
```bash
PASS_MAX_DAYS   90              # ç”¨æˆ·çš„å¯†ç æœ€é•¿ä½¿ç”¨å¤©æ•°
PASS_MIN_DAYS   0               # ä¸¤æ¬¡ä¿®æ”¹å¯†ç çš„æœ€å°æ—¶é—´é—´éš”
PASS_MIN_LEN    7               # å¯†ç çš„æœ€å°é•¿åº¦
PASS_WARN_AGE   9               # å¯†ç è¿‡æœŸå‰å¤šå°‘å¤©å¼€å§‹æç¤º
```

### å½“æŸ¥åˆ°å¼‚å¸¸ç”¨æˆ·æ—¶,éœ€è¦ç«‹å³ç¦ç”¨
```bash
usermod -L user     # ç¦ç”¨å¸å·ï¼Œå¸å·æ— æ³•ç™»å½•ï¼Œ/etc/shadowç¬¬äºŒæ ä¸º!å¼€å¤´
userdel user        # åˆ é™¤userç”¨æˆ·
userdel -r admin    # å°†åˆ é™¤userç”¨æˆ·ï¼Œå¹¶ä¸”å°†/homeç›®å½•ä¸‹çš„adminç›®å½•ä¸€å¹¶åˆ é™¤
```

### å®‰å…¨é…ç½®

**è®¾ç½®è´¦æˆ·é”å®šç™»å½•å¤±è´¥é”å®šæ¬¡æ•°ã€é”å®šæ—¶é—´**
```bash
vim /etc/pam.d/system-auth

auth required pam_tally.so onerr=fail deny=6 unlock_time=300  # è®¾ç½®ä¸ºå¯†ç è¿ç»­è¾“é”™6æ¬¡,é”å®šæ—¶é—´300ç§’
auth required pam_tally.so deny=2 unlock_time=60 even_day_root root_unlock_time=60
```

### å®‰å…¨å®¡è®¡

```bash
ps -ef | grep auditd            # æŸ¥çœ‹æ˜¯å¦å¼€å¯ç³»ç»Ÿå®‰å…¨å®¡è®¡åŠŸèƒ½
more /etc/audit/audit.rules     # æŸ¥çœ‹å®¡è®¡çš„è§„åˆ™æ–‡ä»¶
    - w æ–‡ä»¶ -p æƒé™(rè¯» wå†™ xæ‰§è¡Œ aä¿®æ”¹æ–‡ä»¶å±æ€§) -k å…³é”®å­—
    - w /etc/passwd -p wa -k passwd_changes             # å¯¹é‡è¦æ–‡ä»¶çš„æ“ä½œè¡Œä¸ºè¿›è¡Œç›‘æ§
    - a -ç³»åˆ—åŠ¨ä½œ -S ç³»ç»Ÿè°ƒç”¨åç§° -F å­—æ®µ-å€¼ -k å…³é”®å­—
    - a exit,always -S mount -S umount                  # å¯¹ç³»ç»Ÿè°ƒç”¨è¿›è¡Œç›‘æ§
more /etc/audit/auditd.conf     # æŸ¥çœ‹å®‰å…¨äº‹ä»¶é…ç½®

ausearch -i | less              # æŸ¥çœ‹å®¡è®¡æ—¥å¿—
more /var/log/audit/audit.log   # æŸ¥çœ‹å®¡è®¡æ—¥å¿—
```

**audit**

linux audit å­ç³»ç»Ÿæ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†è®°å½•ç³»ç»Ÿã€å†…æ ¸ã€ç”¨æˆ·è¿›ç¨‹å‘ç”Ÿçš„è¡Œä¸ºäº‹ä»¶çš„ä¸€ç§å®‰å…¨å®¡è®¡ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå¯ä»¥å¯é åœ°æ”¶é›†æœ‰å…³ä¸Šä»»ä½•ä¸å®‰å…¨ç›¸å…³ï¼ˆæˆ–ä¸å®‰å…¨æ— å…³ï¼‰äº‹ä»¶çš„ä¿¡æ¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©è·Ÿè¸ªåœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œè¿‡çš„ä¸€äº›æ“ä½œã€‚

audit å’Œ syslog æœ‰æœ¬è´¨åŒºåˆ«ã€‚syslog è®°å½•çš„ä¿¡æ¯æœ‰é™ï¼Œä¸»è¦ç›®çš„æ˜¯è½¯ä»¶è°ƒè¯•ï¼Œå¯¹äºç”¨æˆ·çš„æ“ä½œè¡Œä¸ºï¼ˆå¦‚æŸç”¨æˆ·ä¿®æ”¹åˆ é™¤äº†æŸæ–‡ä»¶ï¼‰å´æ— æ³•é€šè¿‡è¿™äº›æ—¥å¿—æ–‡ä»¶æ¥æŸ¥çœ‹ã€‚è€Œ audit çš„ç›®çš„åˆ™ä¸åŒï¼Œå®ƒæ˜¯ linux å®‰å…¨ä½“ç³»çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯ä¸€ç§ â€œè¢«åŠ¨â€ çš„é˜²å¾¡ä½“ç³»ã€‚

```bash
yum install audit*.* -y         # å®‰è£… audit
service auditd start            # å¯åŠ¨ audit
service auditd status           # æŸ¥çœ‹ audit çŠ¶æ€

# å¼€å¯äº† autid æœåŠ¡åï¼Œæ‰€æœ‰çš„å®¡è®¡æ—¥å¿—ä¼šè®°å½•åœ¨ /var/log/audit/audit.log æ–‡ä»¶ä¸­ã€‚
```

audit å®‰è£…åä¼šç”Ÿæˆ 2 ä¸ªé…ç½®æ–‡ä»¶:
* /etc/audit/auditd.conf
* /etc/audit/audit.rules

å…·ä½“é…ç½®ä¿¡æ¯è¯·æŸ¥çœ‹ [æ–‡ä»¶](./ç¬”è®°/æ–‡ä»¶.md#etc)

audit å¸¸ç”¨å‘½ä»¤
```bash
ausearch    # æŸ¥è¯¢ audit log å·¥å…·
aureport    # è¾“å‡º audit ç³»ç»ŸæŠ¥å‘Š

auditctl -l # æŸ¥çœ‹ audit è§„åˆ™
aureport --user
aureport --file
aureport --summary

# é…ç½®è®°å½•å‘½ä»¤rmå‘½ä»¤æ‰§è¡Œ
auditctl -w /bin/rm -p x -k removefile
```

---

## SELinux

**å…³é—­Â SELinux**
- éœ€è¦é‡å¯
	```vim
	vimÂ /etc/selinux/config

	SELINUX=disabled
	```

- ä¸éœ€è¦é‡å¯

	`setenforce 0`

---

## è¿›ç¨‹

### è¿›ç¨‹å®šä½

```bash
ps -aux         # åˆ—å‡ºæ‰€æœ‰è¿›ç¨‹ä»¥åŠç›¸å…³ä¿¡æ¯å‘½ä»¤
ps -ef
service --status-all | grep running
top             # æ€»è§ˆç³»ç»Ÿå…¨é¢ä¿¡æ¯å‘½ä»¤
pidof name      # å®šä½ç¨‹åºçš„ pid
pidof -x name   # å®šä½è„šæœ¬çš„ pid
lsof -g gid     # å¯»æ‰¾æ¶æ„æ–‡ä»¶å…³è”çš„ lib æ–‡ä»¶
```

### è¿›ç¨‹é™åˆ¶

```bash
ulimit -u 20    # ä¸´æ—¶æ€§å…è®¸ç”¨æˆ·æœ€å¤šåˆ›å»º 20 ä¸ªè¿›ç¨‹,é¢„é˜²ç±»ä¼¼ fork ç‚¸å¼¹
```

```vim
vim /etc/security/limits.conf
    user1 - nproc 20  # é€€å‡ºåé‡æ–°ç™»å½•,å°±ä¼šå‘ç°æœ€å¤§è¿›ç¨‹æ•°å·²ç»æ›´æ”¹ä¸º 20 äº†
```

### è´Ÿè½½

**æ–‡ç« **
- [Linuxç³»ç»Ÿæ¸…é™¤ç¼“å­˜](https://www.cnblogs.com/jiu0821/p/9854704.html)

**æŸ¥è¯¢è´Ÿè½½ã€è¿›ç¨‹ç›‘æ§**

```bash
ps aux | grep Z                                         # åˆ—å‡ºè¿›ç¨‹è¡¨ä¸­æ‰€æœ‰åƒµå°¸è¿›ç¨‹
ps aux|head -1;ps aux|grep -v PID|sort -rn -k +3|head   # è·å–å ç”¨CPUèµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
ps aux|head -1;ps aux|grep -v PID|sort -rn -k +4|head   # è·å–å ç”¨å†…å­˜èµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
```

**æ¸…ç†ç¼“å­˜**

```bash
sync    # sync å‘½ä»¤åšåŒæ­¥,ä»¥ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§,å°†æ‰€æœ‰æœªå†™çš„ç³»ç»Ÿç¼“å†²åŒºå†™åˆ°ç£ç›˜ä¸­,åŒ…å«å·²ä¿®æ”¹çš„ i-nodeã€å·²å»¶è¿Ÿçš„å— I/O å’Œè¯»å†™æ˜ å°„æ–‡ä»¶.å¦åˆ™åœ¨é‡Šæ”¾ç¼“å­˜çš„è¿‡ç¨‹ä¸­,å¯èƒ½ä¼šä¸¢å¤±æœªä¿å­˜çš„æ–‡ä»¶.
echo 1 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecache(é¡µé¢ç¼“å­˜)
echo 2 > /proc/sys/vm/drop_caches   # æ¸…ç† dentries(ç›®å½•ç¼“å­˜)å’Œinodes
echo 3 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecacheã€dentries å’Œ inodes
sync
```

---

## ç³»ç»Ÿå®Œæ•´æ€§

é€šè¿‡ rpm è‡ªå¸¦çš„ -Va æ¥æ ¡éªŒæ£€æŸ¥æ‰€æœ‰çš„ rpm è½¯ä»¶åŒ…ï¼ŒæŸ¥çœ‹å“ªäº›å‘½ä»¤æ˜¯å¦è¢«æ›¿æ¢äº†
```bash
rpm -Va
# å¦‚æœä¸€åˆ‡å‡æ ¡éªŒæ­£å¸¸å°†ä¸ä¼šäº§ç”Ÿä»»ä½•è¾“å‡ºï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œå°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¾“å‡ºæ ¼å¼æ˜¯8ä½é•¿å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ç”¨ä»¥è¡¨ç¤ºæ–‡ä»¶ä¸RPMæ•°æ®åº“ä¸­ä¸€ç§å±æ€§çš„æ¯”è¾ƒç»“æœ ï¼Œå¦‚æœæ˜¯. (ç‚¹) åˆ™è¡¨ç¤ºæµ‹è¯•é€šè¿‡ã€‚

éªŒè¯å†…å®¹ä¸­çš„8ä¸ªä¿¡æ¯çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š
- S         æ–‡ä»¶å¤§å°æ˜¯å¦æ”¹å˜
- M         æ–‡ä»¶çš„ç±»å‹æˆ–æ–‡ä»¶çš„æƒé™ï¼ˆrwxï¼‰æ˜¯å¦è¢«æ”¹å˜
- 5         æ–‡ä»¶MD5æ ¡éªŒæ˜¯å¦æ”¹å˜ï¼ˆå¯ä»¥çœ‹æˆæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼‰
- D         è®¾å¤‡ä¸­ï¼Œä»ä»£ç æ˜¯å¦æ”¹å˜
- L         æ–‡ä»¶è·¯å¾„æ˜¯å¦æ”¹å˜
- U         æ–‡ä»¶çš„å±ä¸»ï¼ˆæ‰€æœ‰è€…ï¼‰æ˜¯å¦æ”¹å˜
- G         æ–‡ä»¶çš„å±ç»„æ˜¯å¦æ”¹å˜
- T         æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ”¹å˜
```

**è¿˜åŸæ›¿æ¢å‘½ä»¤**
```bash
rpm  -qf /bin/ls  # æŸ¥è¯¢ ls å‘½ä»¤å±äºå“ªä¸ªè½¯ä»¶åŒ…
mv  /bin/ls /tmp  # å…ˆæŠŠ ls è½¬ç§»åˆ° tmp ç›®å½•ä¸‹ï¼Œé€ æˆ ls å‘½ä»¤ä¸¢å¤±çš„å‡è±¡
rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls # æå– rpm åŒ…ä¸­ ls å‘½ä»¤åˆ°å½“å‰ç›®å½•çš„/bin/lsä¸‹
cp /root/bin/ls  /bin/ # æŠŠ ls å‘½ä»¤å¤åˆ¶åˆ° /bin/ ç›®å½•,ä¿®å¤æ–‡ä»¶ä¸¢å¤±
```

---

## æ—¥å¿—

**ç³»ç»Ÿæ—¥å¿—**
- å†…å®¹è§ [æ—¥å¿—](./ç¬”è®°/æ—¥å¿—.md)

å¯¹äºæ—¥å¿—æ–‡ä»¶çš„ä¿æŠ¤
```bash
chattr +a xxx
chattr +a -R xxx # é€’å½’å¼å¢åŠ aæƒé™
# aé€‰é¡¹ä¸ºappend (è¿½åŠ ) only ,å³ç»™æ—¥å¿—æ–‡ä»¶åŠ ä¸Šaæƒé™å,å°†åªå¯ä»¥è¿½åŠ ,ä¸å¯ä»¥åˆ é™¤å’Œä¿®æ”¹ä¹‹å‰çš„å†…å®¹ã€‚
```

**webæ—¥å¿—**
- å†…å®¹è§ [å–è¯](../../Security/BlueTeam/å–è¯.md#ä¸­é—´ä»¶æœåŠ¡å™¨ç¨‹åºæ—¥å¿—) ä¸­é—´ä»¶æœåŠ¡å™¨ç¨‹åºæ—¥å¿—éƒ¨åˆ†

**æ•°æ®åº“æ—¥å¿—**
- å†…å®¹è§ [å–è¯](../../Security/BlueTeam/å–è¯.md#æ•°æ®åº“å–è¯) æ•°æ®åº“å–è¯éƒ¨åˆ†

---

# Net
## ç«¯å£

**æŸ¥**
```bash
getent services     # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„é»˜è®¤ç«¯å£åç§°å’Œç«¯å£å·

lsof -i -P          # æ˜¾ç¤ºè¿›ç¨‹ä½¿ç”¨ç«¯å£ä½¿ç”¨æƒ…å†µ
lsof -i:22          # åªæŸ¥ 22 ç«¯å£

ss -tnlp
ss -tnlp | grep ssh
ss -tnlp | grep ":22"

netstat -tnlp
netstat -tnlp | grep ssh

nmap -sV -p 22 localhost
```

æ›´å¤šå†…å®¹æŸ¥çœ‹ [ç½‘ç»œ](./ç¬”è®°/ä¿¡æ¯.md#ç½‘ç»œ)

**é˜²**
- [EtherDream/anti-portscan: ä½¿ç”¨ iptables é˜²æ­¢ç«¯å£æ‰«æ](https://github.com/EtherDream/anti-portscan)
    ```bash
    git clone https://github.com/EtherDream/anti-portscan
    cd anti-portscan
    vim install.sh # ä¿®æ”¹éœ€è¦æ‰“å¼€çš„ç«¯å£
    sh install.sh
    ```

---

## Firewall

**æŸ¥**
```bash
firewall-cmd --list-services    # æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®
firewall-cmd --state                    # æ˜¾ç¤ºé˜²ç«å¢™çŠ¶æ€
firewall-cmd --get-zones                # åˆ—å‡ºå½“å‰æœ‰å‡ ä¸ª zone
firewall-cmd --get-active-zones         # å–å¾—å½“å‰æ´»åŠ¨çš„ zones
firewall-cmd --get-default-zone         # å–å¾—é»˜è®¤çš„ zone
firewall-cmd --get-service              # å–å¾—å½“å‰æ”¯æŒ service
firewall-cmd --get-service --permanent  # æ£€æŸ¥ä¸‹ä¸€æ¬¡é‡è½½åå°†æ¿€æ´»çš„æœåŠ¡

firewall-cmd --zone=public --list-ports # åˆ—å‡º zone public ç«¯å£
firewall-cmd --zone=public --list-all   # åˆ—å‡º zone public å½“å‰è®¾ç½®

cat /etc/hosts.deny                     # tcp_Wrappers é˜²ç«å¢™çš„é…ç½®æ–‡ä»¶,è¯¦æƒ…è§ æ–‡ä»¶.md
cat /etc/hosts.allow                    # tcp_Wrappers é˜²ç«å¢™çš„é…ç½®æ–‡ä»¶,è¯¦æƒ…è§ æ–‡ä»¶.md
```

**é˜²**
```bash
firewall-cmd --permanent --zone=public --remove-service=ssh
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=internal --add-source=1.1.1.1
firewall-cmd --reload           # é‡å¯é˜²ç«å¢™æœåŠ¡
```

åœ¨ä¸Šé¢çš„é…ç½®ä¸­,å¦‚æœæœ‰äººå°è¯•ä» 1.1.1.1 å» ssh,è¿™ä¸ªè¯·æ±‚å°†ä¼šæˆåŠŸ,å› ä¸ºè¿™ä¸ªæºåŒºåŸŸ(internal)è¢«é¦–å…ˆåº”ç”¨,å¹¶ä¸”å®ƒå…è®¸ ssh è®¿é—®.

å¦‚æœæœ‰äººå°è¯•ä»å…¶å®ƒçš„åœ°å€,å¦‚ 2.2.2.2,å»è®¿é—® ssh,å®ƒä¸æ˜¯è¿™ä¸ªæºåŒºåŸŸçš„,å› ä¸ºå’Œè¿™ä¸ªæºåŒºåŸŸä¸åŒ¹é….å› æ­¤,è¿™ä¸ªè¯·æ±‚è¢«ç›´æ¥è½¬åˆ°æ¥å£åŒºåŸŸ(public),å®ƒæ²¡æœ‰æ˜¾å¼å¤„ç† ssh,å› ä¸º,public çš„ç›®æ ‡æ˜¯ default,è¿™ä¸ªè¯·æ±‚è¢«ä¼ é€’åˆ°é»˜è®¤åŠ¨ä½œ,å®ƒå°†è¢«æ‹’ç».

å¦‚æœ 1.1.1.1 å°è¯•è¿›è¡Œ http è®¿é—®ä¼šæ€æ ·ï¼ŸæºåŒºåŸŸ(internal)ä¸å…è®¸å®ƒ,ä½†æ˜¯,ç›®æ ‡æ˜¯ default,å› æ­¤,è¯·æ±‚å°†ä¼ é€’åˆ°æ¥å£åŒºåŸŸ(public),å®ƒè¢«å…è®¸è®¿é—®.

ç°åœ¨,è®©æˆ‘ä»¬å‡è®¾æœ‰äººä» 3.3.3.3 æ‹–ä½ çš„ç½‘ç«™.è¦é™åˆ¶ä»é‚£ä¸ª IP çš„è®¿é—®,ç®€å•åœ°å¢åŠ å®ƒåˆ°é¢„å®šä¹‰çš„ drop åŒºåŸŸ,æ­£å¦‚å…¶å,å®ƒå°†ä¸¢å¼ƒæ‰€æœ‰çš„è¿æ¥:
```bash
firewall-cmd --permanent --zone=drop --add-source=3.3.3.3
firewall-cmd --reload
```
ä¸‹ä¸€æ¬¡ 3.3.3.3 å°è¯•å»è®¿é—®ä½ çš„ç½‘ç«™,firewalld å°†è½¬å‘è¯·æ±‚åˆ°æºåŒºåŸŸ(drop).å› ä¸ºç›®æ ‡æ˜¯ DROP,è¯·æ±‚å°†è¢«æ‹’ç»,å¹¶ä¸”å®ƒä¸ä¼šè¢«è½¬å‘åˆ°æ¥å£åŒºåŸŸ(public).

`æ³¨:é…ç½®äº† firewalld æœåŠ¡åä¸€å®šè¦å»æ£€æŸ¥ä¸‹è§„åˆ™,å› ä¸ºä»–ä¸ä¼šé˜»æ‰æ­£åœ¨è¿›è¡Œçš„è¿æ¥,åªèƒ½é˜»æ‰é…ç½®å‘½ä»¤åè¿›è¡Œçš„è¿æ¥,æ‰€ä»¥ä½ ä¸çŸ¥é“ä½ çš„sshä¼šè¯ä¼šä¸ä¼šä¸€æ–­å°±å†ä¹Ÿè¿ä¸ä¸Šäº†,è¡€çš„æ•™è®­ğŸ¤£`

---

## iptable

**æŸ¥è¯¢è¡¨ä¸­çš„è§„åˆ™**

```bash
iptables -t raw -L      # åˆ—å‡ºæ‰€æœ‰ raw è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
iptables -t mangle -L   # åˆ—å‡º mangle è¡¨ä¸­æ‰€æœ‰è§„åˆ™
iptables -t nat -L      # åˆ—å‡º nat è¡¨ä¸­æ‰€æœ‰è§„åˆ™
iptables -t filter -L   # åˆ—å‡º filter è¡¨ä¸­æ‰€æœ‰è§„åˆ™
```

**æŸ¥çœ‹ä¸åŒçš„é“¾ä¸­çš„è§„åˆ™**

```bash
iptables -L INPUT       # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™
iptables -vL INPUT      # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…
iptables -nvL INPUT     # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…ï¼ŒåŒæ—¶ä¸å¯¹ IP åœ°å€è¿›è¡Œåç§°åè§£æï¼Œç›´æ¥æ˜¾ç¤º IP
iptables --line-number -nvL INPUT  # åªçœ‹ filter è¡¨ä¸­ï¼ˆé»˜è®¤ - t æ˜¯ filter è¡¨ï¼‰input é“¾çš„è§„åˆ™è¯¦æƒ…ï¼ŒåŒæ—¶ä¸å¯¹ IP åœ°å€è¿›è¡Œåç§°åè§£æï¼Œç›´æ¥æ˜¾ç¤º IPï¼Œæ¯è¡ŒåŠ è¡Œæ ‡
```

---

## nftables

**æŸ¥çœ‹è§„åˆ™æ±‡æ€»**

```bash
nft list tables [<family>]
nft list table [<family>] <name> [-n] [-a]
nft list tables  # åˆ—å‡ºæ‰€æœ‰è¡¨
nft list table family table # åˆ—å‡ºæŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é“¾å’Œè§„åˆ™
nft list table inet filter # è¦åˆ—å‡ºinetç°‡ä¸­f
nft list chain family table chain  # åˆ—å‡ºä¸€ä¸ªé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft list chain inet filter output  # è¦åˆ—å‡ºinetä¸­filterè¡¨çš„outputé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
```

**nftè¡¨ç®¡ç†**

```bash
nft add table family table  # åˆ›å»ºä¸€ä¸ªæ–°çš„è¡¨
nft list tables  # åˆ—å‡ºæ‰€æœ‰è¡¨
nft list table family table # åˆ—å‡ºæŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰é“¾å’Œè§„åˆ™
nft list table inet filter # è¦åˆ—å‡ºinetç°‡ä¸­filterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
nft delete table family table  # åˆ é™¤ä¸€ä¸ªè¡¨
nft flush table family table # è¦æ¸…ç©ºä¸€ä¸ªè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™
```

**nfté“¾ç®¡ç†**

```bash
nft add chain family table chain   # å°†åä¸ºchainçš„å¸¸è§„é“¾æ·»åŠ åˆ°åä¸ºtableçš„è¡¨ä¸­
nft add chain inet filter tcpchain   # ä¾‹å¦‚ï¼Œå°†åä¸ºtcpchainçš„å¸¸è§„é“¾æ·»åŠ åˆ°inetç°‡ä¸­åä¸ºfilterçš„è¡¨ä¸­
nft add chain family table chain { type type hook hook priority priority \; }   # æ·»åŠ åŸºæœ¬é“¾ï¼Œéœ€è¦æŒ‡å®šé’©å­å’Œä¼˜å…ˆçº§å€¼
nft list chain family table chain  # åˆ—å‡ºä¸€ä¸ªé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft list chain inet filter output  # è¦åˆ—å‡ºinetä¸­filterè¡¨çš„outputé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™
nft chain family table chain { [ type type hook hook device device priority priority \; policy <policy> \; ] }  # è¦ç¼–è¾‘ä¸€ä¸ªé“¾ï¼Œåªéœ€æŒ‰åç§°è°ƒç”¨å¹¶å®šä¹‰è¦æ›´æ”¹çš„è§„åˆ™
nft chain inet filter input { policy drop \; }   # å°†é»˜è®¤è¡¨ä¸­çš„inputé“¾ç­–ç•¥ä»acceptæ›´æ”¹ä¸ºdrop
nft delete chain family table chain # åˆ é™¤ä¸€ä¸ªé“¾,è¦åˆ é™¤çš„é“¾ä¸èƒ½åŒ…å«ä»»ä½•è§„åˆ™æˆ–è€…è·³è½¬ç›®æ ‡ã€‚
nft flush chain family table chain # æ¸…ç©ºä¸€ä¸ªé“¾çš„è§„åˆ™
```

**æ·»åŠ è§„åˆ™**

```bash
nft add rule family table chain handle handle statement  # å°†ä¸€æ¡è§„åˆ™æ·»åŠ åˆ°é“¾ä¸­
nft insert rule family table chain handle handle statement # å°†è§„åˆ™æ’å…¥åˆ°æŒ‡å®šä½ç½®,å¦‚æœæœªæŒ‡å®šhandleï¼Œåˆ™è§„åˆ™æ’å…¥åˆ°é“¾çš„å¼€å¤´ã€‚
```

**åˆ é™¤è§„åˆ™**

```bash
# ä¸‹é¢å‘½ä»¤ç¡®å®šä¸€ä¸ªè§„åˆ™çš„å¥æŸ„ï¼Œç„¶ååˆ é™¤ã€‚--numberå‚æ•°ç”¨äºæŸ¥çœ‹æ•°å­—è¾“å‡ºï¼Œå¦‚æœªè§£æçš„IPåœ°å€ã€‚
nft --handle --numeric list chain inet filter input
nft delete rule inet fltrTable input handle 10

# å¯ä»¥ç”¨nft flush tableå‘½ä»¤æ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰çš„é“¾ã€‚å¯ä»¥ç”¨nft flush chainæˆ–è€…nft delete ruleå‘½ä»¤æ¸…ç©ºå•ä¸ªé“¾ã€‚
# ç¬¬ä¸€ä¸ªå‘½ä»¤æ¸…ç©ºfooè¡¨ä¸­çš„æ‰€æœ‰é“¾ã€‚ç¬¬äºŒä¸ªå‘½ä»¤æ¸…ç©ºip fooè¡¨ä¸­çš„baré“¾ã€‚ç¬¬ä¸‰ä¸ªå‘½ä»¤åˆ é™¤ip6 fooè¡¨barä¸¤ç§çš„æ‰€æœ‰è§„åˆ™ã€‚
nft flush table foo
nft flush chain foo bar
nft delete rule ip6 foo bar
```

**è‡ªåŠ¨é‡è½½**

```bash
æ¸…ç©ºå½“å‰è§„åˆ™é›†ï¼š

# echo "flush ruleset" > /tmp/nftables
å¯¼å‡ºå½“å‰è§„åˆ™é›†ï¼š

# nft list ruleset >> /tmp/nftables
å¯ä»¥ç›´æ¥ä¿®æ”¹/tmp/nftablesæ–‡ä»¶ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆåˆ™è¿è¡Œï¼š

# nft -f /tmp/nftables
```

---

## ç¦ping

**ä¸´æ—¶æ€§,é‡å¯åå¤±æ•ˆ**
```bash
echo 0 >/proc/sys/net/ipv4/icmp_echo_ignore_all     # å…è®¸ ping
echo 1 >/proc/sys/net/ipv4/icmp_echo_ignore_all     # ç¦æ­¢ ping
```

**é•¿æœŸæ€§**
```bash
vim /etc/rc.d/rc.local

echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
```

æˆ–

```bash
vim /etc/sysctl.conf

net.ipv4.icmp_echo_ignore_all=1
```

`sysctl -p` ä½¿æ–°é…ç½®ç”Ÿæ•ˆ

---

## SSH

**æ–‡ç« **
- [Multiple Ways to Secure SSH Port](http://www.hackingarticles.in/multiple-ways-to-secure-ssh-port/)

**æŸ¥**
- **æŸ¥è¯¢å¯ä»¥è¿œç¨‹ç™»å½•çš„å¸å·ä¿¡æ¯**
    ```bash
    awk '/\$1|\$6/{print $1}' /etc/shadow
    ```

- **æŸ¥çœ‹å°è¯•æš´åŠ›ç ´è§£æœºå™¨å¯†ç çš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for root" /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
    ```

- **æŸ¥çœ‹æš´åŠ›çŒœç”¨æˆ·åçš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for invalid user" /var/log/auth.log | awk '{print $13}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for invalid user" /var/log/secure | awk '{print $13}' | sort | uniq -c | sort -nr | more
    grep "Failed password" /var/log/secure | awk {'print $9'} | sort | uniq -c | sort -nr
    grep -o "Failed password" /var/log/secure|uniq -c
    ```

- **IP ä¿¡æ¯**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for root" /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
    ```

- **ç™»å½•æˆåŠŸ**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    grep "Accepted " /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    grep 'Accepted' /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr
    grep "Accepted " /var/log/secure | awk '{print $1,$2,$3,$9,$11}'
    grep "Accepted " /var/log/secure* | awk '{print $1,$2,$3,$9,$11}'
    ```

- **ç§é’¥**
    ```bash
    ll -al /etc/ssh/
    ll -al /root/.ssh/
    ```

**é˜²**
- **ping é’¥åŒ™**
    - [ä½¿ç”¨ ping é’¥åŒ™ä¸´æ—¶å¼€å¯ SSH:22 ç«¯å£,å®ç°è¿œç¨‹å®‰å…¨ SSH ç™»å½•ç®¡ç†å°±è¿™ä¹ˆç®€å•](https://www.cnblogs.com/martinzhang/p/5348769.html)

    ```bash
    # è§„åˆ™1 åªæ¥å—Dataä¸º1078å­—èŠ‚çš„pingåŒ…,å¹¶å°†æºIPè®°å½•åˆ°è‡ªå®šä¹‰åä¸ºsshKeyListçš„åˆ—è¡¨ä¸­
    iptables -A INPUT -p icmp -m icmp --icmp-type 8 -m length --length 1078 -m recent --name sshKeyList --set -j ACCEPT

    # è§„åˆ™2 è‹¥30ç§’å†…å‘é€æ¬¡æ•°è¾¾åˆ°6æ¬¡(åŠæ›´é«˜),å½“å‘èµ·SSH:22æ–°è¿æ¥è¯·æ±‚æ—¶æ‹’ç»
    iptables -A INPUT -p tcp -m tcp --dport 22 --syn -m recent --name sshKeyList --rcheck --seconds 30 --hitcount 6 -j DROP

    # è§„åˆ™3 è‹¥30ç§’å†…å‘é€æ¬¡æ•°è¾¾åˆ°5æ¬¡,å½“å‘èµ·SSH:22æ–°è¿æ¥è¯·æ±‚æ—¶æ”¾è¡Œ
    iptables -A INPUT -p tcp -m tcp --dport 22 --syn -m recent --name sshKeyList --rcheck --seconds 30 --hitcount 5 -j ACCEPT

    # è§„åˆ™4 å¯¹äºå·²å»ºç«‹çš„è¿æ¥æ”¾è¡Œ
    iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT

    # è§„åˆ™5 è€è§„çŸ©:æœ€åçš„æ‹’ç»
    iptables -A INPUT -j DROP
    ```

- **æ›´æ”¹é»˜è®¤ç«¯å£**

    ä¿®æ”¹ `/etc/ssh/sshd_config` æ–‡ä»¶,å°†å…¶ä¸­çš„ Port 22 æ”¹ä¸ºæŒ‡å®šçš„ç«¯å£

    `!!! è­¦å‘Š,è®°å¾—é˜²ç«å¢™è¦å…ˆæ”¾è¡Œç«¯å£,ä¸ç„¶ä½ çš„è¿œç¨‹ä¸»æœºå°±è¿ä¸ä¸Šäº†ğŸ¤£!!!`
    ```
    service ssh restart
    ```

- **é…ç½®ä½¿ç”¨ RSA ç§é’¥ç™»å½•**

    1. å…ˆç”Ÿæˆä½ çš„å®¢æˆ·ç«¯çš„å¯†é’¥,åŒ…æ‹¬ä¸€ä¸ªç§é’¥å’Œå…¬é’¥
        ```bash
        ssh-keygen -t rsa
        ```

    2. æŠŠå…¬é’¥æ‹·è´åˆ°æœåŠ¡å™¨ä¸Š,æ³¨æ„,ç”Ÿæˆç§é’¥çš„æ—¶å€™,æ–‡ä»¶åæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„,ä¸”å¯ä»¥å†åŠ ä¸€å±‚å¯†ç ,æ‰€ä»¥å»ºè®®æ–‡ä»¶åå–è‡ªå·±èƒ½è¯†åˆ«å‡ºå“ªå°æœºå™¨çš„åå­—.
        ```bash
        cd /root/.ssh
        scp id_rsa.pub root@XX.XX.XX.XX:~/
        ```

    3. ç„¶ååœ¨æœåŠ¡å™¨ä¸Š,ä½ çš„ç”¨æˆ·ç›®å½•ä¸‹,æ–°å»º `.ssh` æ–‡ä»¶å¤¹,å¹¶å°†è¯¥æ–‡ä»¶å¤¹çš„æƒé™è®¾ä¸º 700
        ```bash
        cd
        mkdir .ssh
        chmod 700 .ssh
        ```

    4. æ–°å»ºä¸€ä¸ª authorized_keys,è¿™æ˜¯é»˜è®¤å…è®¸çš„ key å­˜å‚¨çš„æ–‡ä»¶.å¦‚æœå·²ç»å­˜åœ¨,åˆ™åªéœ€è¦å°†ä¸Šä¼ çš„ id_rsa.pub æ–‡ä»¶å†…å®¹è¿½åŠ è¿›å»å³å¯,å¦‚æœä¸å­˜åœ¨åˆ™æ–°å»ºå¹¶æ”¹æƒé™ä¸º 400 å³å¯. ç„¶åç¼–è¾‘ ssh çš„é…ç½®æ–‡ä»¶
        ```bash
        mv id_rsa.pub .ssh
        cd .ssh
        cat id_rsa.pub >> authorized_keys
        chmod 600 authorized_keys
        ```
        ```bash
        vim /etc/ssh/sshd_config

        RSAAuthentication yes                           # RSA è®¤è¯
        PubkeyAuthentication yes                        # å¼€å¯å…¬é’¥éªŒè¯
        AuthorizedKeysFile /root/.ssh/authorized_keys   # éªŒè¯æ–‡ä»¶è·¯å¾„
        PasswordAuthentication no                       # ç¦æ­¢å¯†ç ç™»å½•
        ```

        `service sshd restart` é‡å¯ sshd æœåŠ¡

    5. æµ‹è¯•ä½¿ç”¨ç§é’¥ç™»å½•
        ```bash
        ssh root@x.x.x.x -i id_rsa
        ```

- **ç¦æ­¢ root ç”¨æˆ·ç™»å½•**

    å¯ä»¥å»ºä¸€ä¸ªç”¨æˆ·æ¥ä¸“é—¨ç®¡ç†,è€Œéç›´æ¥ä½¿ç”¨ root ç”¨æˆ·,ä¿®æ”¹ /etc/ssh/sshd_config
    ```vim
    vim /etc/ssh/sshd_config

    PermitRootLogin no
    ```

- **ä½¿ç”¨ Fail2ban**
    - [fail2ban](https://github.com/fail2ban/fail2ban) ,è¯¦ç»†æ­å»ºæ­¥éª¤è¯·ç§»æ­¥ [Power-Linux](./Power-Linux.md##Fail2ban)

- **SSH é™·é˜±**
    - [skeeto/endlessh](https://github.com/skeeto/endlessh) - è“é˜Ÿ SSH é™·é˜±

---

## æ–‡ä»¶å…±äº«

**NFSæœåŠ¡**

é…ç½®æ–‡ä»¶
```
/etc/exports
```

**TFTPæœåŠ¡**

é…ç½®æ–‡ä»¶
```
/etc/default/tftpd-hpa

/etc/xinetd.d/tftp
```

**sambaæœåŠ¡**

é…ç½®æ–‡ä»¶
```
/etc/samba/smb.conf
```

---

# åŠ å›º

## æŸ¥åé—¨

**ç›¸å…³æ–‡ç« **
- [linuxå¸¸è§backdooråŠæ’æŸ¥æŠ€æœ¯](https://xz.aliyun.com/t/4090)

**æ·»åŠ  root æƒé™åé—¨ç”¨æˆ·**

æ£€æŸ¥ `/etc/passwd` æ–‡ä»¶æ˜¯å¦æœ‰å¼‚å¸¸

**vim åé—¨**

æ£€æµ‹å¯¹åº” vim è¿›ç¨‹å·è™šæ‹Ÿç›®å½•çš„ map æ–‡ä»¶æ˜¯å¦æœ‰ python å­—çœ¼.

æŸ¥çœ‹è¿æ¥æƒ…å†µ `netstat -antlp`

ä¾‹å¦‚å‘ç° vim pid ä¸º 12
```
file /proc/12/exe
more /proc/12/cmdline
more /proc/12/maps | grep python
```

**strace è®°å½•**

é€šè¿‡æ’æŸ¥ shell çš„é…ç½®æ–‡ä»¶æˆ–è€… `alias` å‘½ä»¤å³å¯å‘ç°,ä¾‹å¦‚ `~/.bashrc` å’Œ `~/.bash_profile` æ–‡ä»¶æŸ¥çœ‹æ˜¯å¦æœ‰æ¶æ„çš„ alias é—®é¢˜.

**å®šæ—¶ä»»åŠ¡å’Œå¼€æœºå¯åŠ¨é¡¹**

 ä¸€èˆ¬é€šè¿‡ `crontab -l` å‘½ä»¤å³å¯æ£€æµ‹åˆ°å®šæ—¶ä»»åŠ¡åé—¨.ä¸åŒçš„ linux å‘è¡Œç‰ˆå¯èƒ½æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹çš„æ–‡ä»¶ä¸å¤§ç›¸åŒ,Debian ç³» linux ç³»ç»Ÿä¸€èˆ¬æ˜¯é€šè¿‡æŸ¥çœ‹ `/etc/init.d` ç›®å½•æœ‰æ— æœ€è¿‘ä¿®æ”¹å’Œå¼‚å¸¸çš„å¼€æœºå¯åŠ¨é¡¹.è€Œ Redhat ç³»çš„ linux ç³»ç»Ÿä¸€èˆ¬æ˜¯æŸ¥çœ‹ `/etc/rc.d/init.d` æˆ–è€… `/etc/systemd/system` ç­‰ç›®å½•.

**é¢„åŠ è½½å‹åŠ¨æ€é“¾æ¥åº“åé—¨ ld.so.preload**

é€šè¿‡ `strace` å‘½ä»¤å»è·Ÿè¸ªé¢„åŠ è½½çš„æ–‡ä»¶æ˜¯å¦ä¸º `/etc/ld.so.preload` ,ä»¥åŠæ–‡ä»¶ä¸­æ˜¯å¦æœ‰å¼‚å¸¸çš„åŠ¨æ€é“¾æ¥åº“.ä»¥åŠæ£€æŸ¥æ˜¯å¦è®¾ç½® LD_PRELOAD ç¯å¢ƒå˜é‡ç­‰.æ³¨æ„:åœ¨è¿›è¡Œåº”æ€¥å“åº”çš„æ—¶å€™æœ‰å¯èƒ½ç³»ç»Ÿå‘½ä»¤è¢«æ›¿æ¢æˆ–è€…å…³é”®ç³»ç»Ÿå‡½æ•°è¢«åŠ«æŒ(ä¾‹å¦‚é€šè¿‡é¢„åŠ è½½å‹åŠ¨æ€é“¾æ¥åº“åé—¨),å¯¼è‡´ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œä¸æ­£å¸¸,è¿™ä¸ªæ—¶å€™å¯ä»¥ä¸‹è½½ busybox.ä¸‹è½½ç¼–è¯‘å¥½çš„å¯¹åº”å¹³å°ç‰ˆæœ¬çš„ busybox,æˆ–è€…ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘é€šè¿‡Uç›˜æ‹·è´åˆ°ç³»ç»Ÿä¸Š,å› ä¸º busybox æ˜¯é™æ€ç¼–è¯‘çš„,ä¸ä¾èµ–äºç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“,busybox çš„ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹ busybox ls,busybox ps -a.

**å†…æ ¸çº§ rootkit**

å¯ä»¥é€šè¿‡ unhide ç­‰å·¥å…·è¿›è¡Œæ’æŸ¥,æ›´å¤šå†…å®¹è§ [åº”æ€¥](../../Security/BlueTeam/åº”æ€¥.md#rootkit)

**æ·±ä¿¡æœ Web åé—¨æ‰«æ**

http://edr.sangfor.com.cn/backdoor_detection.html

---

## æ€æ¯’

**[ClamavNet](https://www.clamav.net/downloads)**

---

## é…ç½® pam.d ç­–ç•¥

- [pam](./å®éªŒ/pam.md)
- [è®¤è¯](./ç¬”è®°/è®¤è¯.md#pam)
