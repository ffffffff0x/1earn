# åŠ å›ºç¬”è®°

---

## å…è´£å£°æ˜Ž

`æœ¬äººæ’°å†™çš„æ‰‹å†Œ,ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨,è¯·å‹¿ä½¿ç”¨æ–‡ä¸­çš„æŠ€æœ¯æºç ç”¨äºŽéžæ³•ç”¨é€”,ä»»ä½•äººé€ æˆçš„ä»»ä½•è´Ÿé¢å½±å“,ä¸Žæœ¬äººæ— å…³ã€‚`

---

**æ–‡ç« **
- [å¦‚ä½•å®‰å…¨çš„å­˜å‚¨ç”¨æˆ·çš„å¯†ç ](http://xdxd.love/2018/02/26/%E5%A6%82%E4%BD%95%E5%AE%89%E5%85%A8%E7%9A%84%E5%AD%98%E5%82%A8%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81/)
- [ç»éªŒåˆ†äº« | ä¼ä¸šå¦‚ä½•åšå¥½å®‰å…¨åŸºçº¿é…ç½®](https://www.freebuf.com/articles/es/158781.html)

**èµ„æº**
- [CIS Benchmarks](https://learn.cisecurity.org/benchmarks) - å®‰å…¨é…ç½®å»ºè®®,å†…å®¹å¾ˆå¤š,è™½ç„¶æ˜¯è‹±æ–‡ç‰ˆæœ¬
- [re4lity/Benchmarks](https://github.com/re4lity/Benchmarks) - å¸¸ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“ã€ä¸­é—´ä»¶å®‰å…¨é…ç½®åŸºçº¿
- [trimstray/linux-hardening-checklist](https://github.com/trimstray/linux-hardening-checklist) - linuxå®‰å…¨é…ç½®çš„æ ¸æŸ¥

**å·¥å…·**
- [lis912/CapOS](https://github.com/lis912/CapOS) - ç­‰çº§ä¿æŠ¤æµ‹è¯„ windows åŸºçº¿æ£€æŸ¥
- [lis912/Evaluation_tools](https://github.com/lis912/Evaluation_tools)

---

# æ“ä½œç³»ç»Ÿ
## Linux
- è¯¥éƒ¨åˆ†å†…å®¹å‚è€ƒ [Secure-Linux](../../è¿ç»´/Linux/Secure-Linux.md)

## Windows
**æ–‡ç« **
- [Windowså®‰å…¨åŠ å›º](https://www.freebuf.com/column/201869.html)
- [WindowsæœåŠ¡å™¨ä¸»æœºåŠ å›ºåˆ†äº«](https://www.freebuf.com/articles/system/215787.html)
- [windowså®‰å…¨é˜²æŠ¤](https://www.freebuf.com/column/195870.html)

---

# webæœåŠ¡å’Œä¸­é—´ä»¶

![image](../../../assets/img/æ‰æ€ª.png)

---

# ä¸šåŠ¡è½¯ä»¶
## æ•°æ®åº“
### mysql
**åˆ é™¤åŒ¿åå¸æˆ·**
```sql
mysql>  delete from user where user='';
mysql>  flush privileges;
```

**æ£€æŸ¥æ˜¯å¦æœ‰ä¸æ°å½“çš„æŽˆæƒæ–‡ä»¶**
```bash
ls -al .bash_history    # åº”ä¸º600æƒé™
ls â€“al /etc/my.cnf  # åº”ä¸º644æƒé™
find / -name .MYD |xargs ls â€“al # åº”ä¸º600æƒé™
find / -name .MYI |xargs ls â€“al # åº”ä¸º600æƒé™
find / -name .frm |xargs ls â€“al # åº”ä¸º600æƒé™
```

**æ£€æŸ¥ MySQL æ˜¯å¦å…è®¸è¯»å–ä¸»æœºä¸Šçš„æ–‡ä»¶**

æ£€æŸ¥æ˜¯å¦åœ¨ /etc/my.cnf ä¸­è®¾ç½®
åœ¨æ–‡ä»¶ä¸­æ·»åŠ ï¼š`set-variable=local-infile=0`
å®ŒæˆåŽæŒ‰é”®ç›˜çš„ ECS é”®ï¼Œè¾“å…¥ :wqï¼Œè¿›è¡Œä¿å­˜é€€å‡º

**æ£€æŸ¥ mysqld æ˜¯å¦ä»¥æ™®é€šå¸æˆ·è¿è¡Œ(é€šå¸¸å°±æ˜¯ mysql ç”¨æˆ·)**

å¯ä»¥é€šè¿‡åœ¨ /etc/my.cnf ä¸­è®¾ç½®ï¼š
æ·»åŠ ä»¥ä¸‹ï¼š
```vim
vim /etc/mysql/my.cnf

[mysql.server]
user=mysql
```

## è¿œç¨‹æœåŠ¡
### SSH
**æŸ¥**
- **æŸ¥çœ‹å°è¯•æš´åŠ›ç ´è§£æœºå™¨å¯†ç çš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for root" /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
    ```

- **æŸ¥çœ‹æš´åŠ›çŒœç”¨æˆ·åçš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for invalid user" /var/log/auth.log | awk '{print $13}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for invalid user" /var/log/secure | awk '{print $13}' | sort | uniq -c | sort -nr | more
    ```

**é˜²**
- **æ›´æ”¹é»˜è®¤ç«¯å£**

    ä¿®æ”¹ `/etc/ssh/sshd_config` æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ Port 22 æ”¹ä¸ºæŒ‡å®šçš„ç«¯å£

    `!!! è­¦å‘Šï¼Œè®°å¾—é˜²ç«å¢™è¦å…ˆæ”¾è¡Œç«¯å£ï¼Œä¸ç„¶ä½ çš„è¿œç¨‹ä¸»æœºå°±è¿žä¸ä¸Šäº†ðŸ¤£!!!`
    ```
    service ssh restart
    ```

- **é…ç½®ä½¿ç”¨ RSA ç§é’¥ç™»é™†**

    1. å…ˆç”Ÿæˆä½ çš„å®¢æˆ·ç«¯çš„å¯†é’¥ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç§é’¥å’Œå…¬é’¥
    2. æŠŠå…¬é’¥æ‹·è´åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ³¨æ„ï¼Œç”Ÿæˆç§é’¥çš„æ—¶å€™ï¼Œæ–‡ä»¶åæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä¸”å¯ä»¥å†åŠ ä¸€å±‚å¯†ç ï¼Œæ‰€ä»¥å»ºè®®æ–‡ä»¶åå–è‡ªå·±èƒ½è¯†åˆ«å‡ºå“ªå°æœºå™¨çš„åå­—ã€‚
    3. ç„¶åŽåœ¨æœåŠ¡å™¨ä¸Šï¼Œä½ çš„ç”¨æˆ·ç›®å½•ä¸‹ï¼Œæ–°å»º `.ssh` æ–‡ä»¶å¤¹ï¼Œå¹¶å°†è¯¥æ–‡ä»¶å¤¹çš„æƒé™è®¾ä¸º 700
    4. æ–°å»ºä¸€ä¸ª authorized_keysï¼Œè¿™æ˜¯é»˜è®¤å…è®¸çš„ key å­˜å‚¨çš„æ–‡ä»¶ã€‚å¦‚æžœå·²ç»å­˜åœ¨ï¼Œåˆ™åªéœ€è¦å°†ä¸Šä¼ çš„ id_rsa.pub æ–‡ä»¶å†…å®¹è¿½åŠ è¿›åŽ»å³å¯ï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™æ–°å»ºå¹¶æ”¹æƒé™ä¸º 400 å³å¯ã€‚ ç„¶åŽç¼–è¾‘ ssh çš„é…ç½®æ–‡ä»¶

    ```bash
    ssh-keygen -t rsa
    scp id_rsa.pub root@XX.XX.XX.XX:~/
    ```
    ```bash
    cd /
    mkdir .ssh
    chmod 700 .ssh
    mv id_rsa.pub .ssh
    cd .ssh
    cat id_rsa.pub >> authorized_keys
    chmod 600 authorized_keys
    ```
    ```vim
    vim /etc/ssh/sshd_config

    RSAAuthentication yes # RSA è®¤è¯
    PubkeyAuthentication yes # å¼€å¯å…¬é’¥éªŒè¯
    AuthorizedKeysFile /root/.ssh/authorized_keys # éªŒè¯æ–‡ä»¶è·¯å¾„
    ```

    `sudo service sshd restart` é‡å¯ sshd æœåŠ¡

- **ç¦æ­¢ root ç”¨æˆ·ç™»å½•**

    å¯ä»¥å»ºä¸€ä¸ªç”¨æˆ·æ¥ä¸“é—¨ç®¡ç†ï¼Œè€Œéžç›´æŽ¥ä½¿ç”¨ root ç”¨æˆ·ï¼Œä¿®æ”¹ /etc/ssh/sshd_config
    ```vim
    vim /etc/ssh/sshd_config

    PermitRootLogin no
    ```

- **ä½¿ç”¨ Fail2ban**

    - [fail2ban](https://github.com/fail2ban/fail2ban) ,è¯¦ç»†æ­å»ºæ­¥éª¤è¯·ç§»æ­¥ [Power-Linux](./Power-Linux.md) --> å®‰å…¨æœåŠ¡ --> Fail2ban éƒ¨åˆ†
