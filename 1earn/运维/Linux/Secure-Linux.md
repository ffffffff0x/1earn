```
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                              â–ˆâ–ˆ       â–ˆâ–ˆ
 â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘                                              â–‘â–ˆâ–ˆ      â–‘â–‘
â–‘â–ˆâ–ˆ         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â–‘â–ˆâ–ˆ       â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ
â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆ â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆ â–ˆâ–ˆ
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–‘ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ â–‘ â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆ
       â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘ â–‘â–ˆâ–ˆ   â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ   â–‘â–ˆâ–ˆâ–‘â–‘â–‘â–‘       â–‘â–ˆâ–ˆ      â–‘â–ˆâ–ˆ â–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–ˆâ–ˆ  â–‘â–ˆâ–ˆ  â–ˆâ–ˆâ–‘â–ˆâ–ˆ
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆ   â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆ â–ˆâ–ˆâ–ˆ  â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ â–‘â–‘â–ˆâ–ˆ
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘  â–‘â–‘â–‘â–‘â–‘   â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘     â–‘â–‘â–‘â–‘â–‘â–‘       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘ â–‘â–‘â–‘   â–‘â–‘  â–‘â–‘â–‘â–‘â–‘â–‘ â–‘â–‘   â–‘â–‘
```

`Linux åŠ å›º+ç»´æŠ¤+åº”æ€¥å“åº”å‚è€ƒ`

`æ–‡æ¡£å†…å®¹å’Œ` [åŠ å›ºç¬”è®°](../../å®‰å…¨/ç¬”è®°/åŠ å›ºç¬”è®°.md) `éš¾å…æœ‰é‡å¤çš„éƒ¨åˆ†,å»ºè®®2ä¸ªéƒ½çœ‹çœ‹`

<p align="center">
    <a href="https://commons.wikimedia.org/wiki/File:William_J._McCloskey_(1859%E2%80%931941),_Wrapped_Oranges,_1889._Oil_on_canvas._Amon_Carter_Museum_of_American_Art.jpg"><img src="../../../assets/img/è¿ç»´/Linux/Secure-Linux.png" width="90%"></a>
</p>

---

# æœ¬åœ°ğŸ‘®ğŸ»â€
## å¯†ç é‡ç½®
**centos7**

1. åœ¨å¯åŠ¨èœå•é€‰æ‹©å¯åŠ¨å†…æ ¸,æŒ‰ e ç¼–è¾‘,æ‰¾åˆ° rhgb quiet ä¸€è¡Œ,æŠŠ `rhgb quiet` æ›¿æ¢ä¸º `init=/bin/bash` (ä¸´æ—¶ç”Ÿæ•ˆ)
2. æŒ‰ `CTRL+X` è¿›å…¥å•ç”¨æˆ·æ¨¡å¼
3. æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ: `mount -o remount,rw /`
4. ä½¿ç”¨ `passwd` å‘½ä»¤ç›´æ¥è®¾ç½® root å¯†ç : `passwd root` è¾“å…¥ä¸¤æ¬¡æ–°å¯†ç .
5. æœ€å,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ›´æ–° SELinux: `touch /.autorelabel`
6. è¿›å…¥æ­£å¸¸æ¨¡å¼: `exec /sbin/init`  ç°åœ¨å¯ä»¥ä½¿ç”¨æ–°è®¾ç½®çš„ root å¯†ç ç™»å½•äº†.

---

## ä¼šè¯

**æŸ¥**
```bash
who  # æŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·
w   # æŸ¥çœ‹ç™»å½•ç”¨æˆ·è¡Œä¸º
last # æŸ¥çœ‹ç™»é™†ç”¨æˆ·å†å²
```

**é˜²**
```bash
pkill -u linfengfeiye   # ç›´æ¥å‰”é™¤ç”¨æˆ·
ps -ef| grep pts/0  # å¾—åˆ°ç”¨æˆ·ç™»å½•ç›¸åº”çš„è¿›ç¨‹å· pid åæ‰§è¡Œ
kill -9 pid # å®‰å…¨å‰”é™¤ç”¨æˆ·
```

---

## åŠ å›º
**æŸ¥åé—¨**
- **æ·»åŠ  root æƒé™åé—¨ç”¨æˆ·**

   æ£€æŸ¥ `/etc/passwd` æ–‡ä»¶æ˜¯å¦æœ‰å¼‚å¸¸

- **vim åé—¨**

   æ£€æµ‹å¯¹åº” vim è¿›ç¨‹å·è™šæ‹Ÿç›®å½•çš„ map æ–‡ä»¶æ˜¯å¦æœ‰ python å­—çœ¼.
   `netstat -antlp`
   ä¾‹å¦‚å‘ç° vim pid ä¸º 12
   ```
   file /proc/12/exe
   more /proc/12/cmdline
   more /proc/12/maps | grep python
   ```

- **straceè®°å½•**

    é€šè¿‡æ’æŸ¥ shell çš„é…ç½®æ–‡ä»¶æˆ–è€… `alias` å‘½ä»¤å³å¯å‘ç°,ä¾‹å¦‚ `~/.bashrc` å’Œ `~/.bash_profile` æ–‡ä»¶æŸ¥çœ‹æ˜¯å¦æœ‰æ¶æ„çš„ alias é—®é¢˜.

- **å®šæ—¶ä»»åŠ¡å’Œå¼€æœºå¯åŠ¨é¡¹**

    ä¸€èˆ¬é€šè¿‡ `crontab -l` å‘½ä»¤å³å¯æ£€æµ‹åˆ°å®šæ—¶ä»»åŠ¡åé—¨.ä¸åŒçš„ linux å‘è¡Œç‰ˆå¯èƒ½æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹çš„æ–‡ä»¶ä¸å¤§ç›¸åŒ,Debian ç³» linux ç³»ç»Ÿä¸€èˆ¬æ˜¯é€šè¿‡æŸ¥çœ‹ `/etc/init.d` ç›®å½•æœ‰æ— æœ€è¿‘ä¿®æ”¹å’Œå¼‚å¸¸çš„å¼€æœºå¯åŠ¨é¡¹.è€Œ Redhat ç³»çš„ linux ç³»ç»Ÿä¸€èˆ¬æ˜¯æŸ¥çœ‹ `/etc/rc.d/init.d` æˆ–è€… `/etc/systemd/system` ç­‰ç›®å½•.

- **é¢„åŠ è½½å‹åŠ¨æ€é“¾æ¥åº“åé—¨ ld.so.preload**

    é€šè¿‡ `strace` å‘½ä»¤å»è·Ÿè¸ªé¢„åŠ è½½çš„æ–‡ä»¶æ˜¯å¦ä¸º `/etc/ld.so.preload` ,ä»¥åŠæ–‡ä»¶ä¸­æ˜¯å¦æœ‰å¼‚å¸¸çš„åŠ¨æ€é“¾æ¥åº“.ä»¥åŠæ£€æŸ¥æ˜¯å¦è®¾ç½® LD_PRELOAD ç¯å¢ƒå˜é‡ç­‰.æ³¨æ„ï¼šåœ¨è¿›è¡Œåº”æ€¥å“åº”çš„æ—¶å€™æœ‰å¯èƒ½ç³»ç»Ÿå‘½ä»¤è¢«æ›¿æ¢æˆ–è€…å…³é”®ç³»ç»Ÿå‡½æ•°è¢«åŠ«æŒ(ä¾‹å¦‚é€šè¿‡é¢„åŠ è½½å‹åŠ¨æ€é“¾æ¥åº“åé—¨),å¯¼è‡´ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œä¸æ­£å¸¸,è¿™ä¸ªæ—¶å€™å¯ä»¥ä¸‹è½½ busybox.ä¸‹è½½ç¼–è¯‘å¥½çš„å¯¹åº”å¹³å°ç‰ˆæœ¬çš„ busybox,æˆ–è€…ä¸‹è½½æºç è¿›è¡Œç¼–è¯‘é€šè¿‡Uç›˜æ‹·è´åˆ°ç³»ç»Ÿä¸Š,å› ä¸º busybox æ˜¯é™æ€ç¼–è¯‘çš„,ä¸ä¾èµ–äºç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“,busybox çš„ä½¿ç”¨ç±»ä¼¼å¦‚ä¸‹ busybox ls,busybox ps -a.

- **å†…æ ¸çº§ rootkit**

    å¯ä»¥é€šè¿‡ unhide ç­‰å·¥å…·è¿›è¡Œæ’æŸ¥

- **æ·±ä¿¡æœ Web åé—¨æ‰«æ**

    http://edr.sangfor.com.cn/backdoor_detection.html

**æ€æ¯’**
- **[ClamavNet](https://www.clamav.net/downloads)**

**Reference**
- [linuxå¸¸è§backdooråŠæ’æŸ¥æŠ€æœ¯](https://xz.aliyun.com/t/4090)

---

## SELinux
**å…³é—­Â SELinux**
- éœ€è¦é‡å¯
	```vim
	vimÂ /etc/selinux/config

	SELINUX=disabled
	```

- ä¸éœ€è¦é‡å¯

	`setenforce 0`

---

## ç³»ç»Ÿç®¡ç†ğŸ‘¨â€ğŸ“
### ç³»ç»Ÿä¿¡æ¯
#### è¿›ç¨‹ç®¡ç†

**è¿›ç¨‹å®šä½**
```bash
pidof name  # å®šä½ç¨‹åºçš„ pid
pidof -x name   # å®šä½è„šæœ¬çš„ pid
```

**è¿›ç¨‹é™åˆ¶**
```bash
ulimit -u 20    # ä¸´æ—¶æ€§å…è®¸ç”¨æˆ·æœ€å¤šåˆ›å»º 20 ä¸ªè¿›ç¨‹,é¢„é˜²ç±»ä¼¼ fork ç‚¸å¼¹
```

```vim
vim /etc/security/limits.conf
    user1 - nproc 20  # é€€å‡ºåé‡æ–°ç™»å½•,å°±ä¼šå‘ç°æœ€å¤§è¿›ç¨‹æ•°å·²ç»æ›´æ”¹ä¸º 20 äº†
```

##### è´Ÿè½½

**æŸ¥**
- **æŸ¥è¯¢è´Ÿè½½ã€è¿›ç¨‹ç›‘æ§**
    ```bash
    ps aux | grep Z # åˆ—å‡ºè¿›ç¨‹è¡¨ä¸­æ‰€æœ‰åƒµå°¸è¿›ç¨‹
    ps aux|head -1;ps aux|grep -v PID|sort -rn -k +3|head   # è·å–å ç”¨CPUèµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
    ps aux|head -1;ps aux|grep -v PID|sort -rn -k +4|head   # è·å–å ç”¨å†…å­˜èµ„æºæœ€å¤šçš„10ä¸ªè¿›ç¨‹
    ```

**é˜²**
- **æ¸…ç†ç¼“å­˜**
    ```bash
    sync    # sync å‘½ä»¤åšåŒæ­¥,ä»¥ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿçš„å®Œæ•´æ€§,å°†æ‰€æœ‰æœªå†™çš„ç³»ç»Ÿç¼“å†²åŒºå†™åˆ°ç£ç›˜ä¸­,åŒ…å«å·²ä¿®æ”¹çš„ i-nodeã€å·²å»¶è¿Ÿçš„å— I/O å’Œè¯»å†™æ˜ å°„æ–‡ä»¶.å¦åˆ™åœ¨é‡Šæ”¾ç¼“å­˜çš„è¿‡ç¨‹ä¸­,å¯èƒ½ä¼šä¸¢å¤±æœªä¿å­˜çš„æ–‡ä»¶.
    echo 1 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecache(é¡µé¢ç¼“å­˜)
    echo 2 > /proc/sys/vm/drop_caches   # æ¸…ç† dentries(ç›®å½•ç¼“å­˜)å’Œinodes
    echo 3 > /proc/sys/vm/drop_caches   # æ¸…ç† pagecacheã€dentries å’Œ inodes
    sync
    ```

- **æ–‡ç« **
    - [Linuxç³»ç»Ÿæ¸…é™¤ç¼“å­˜](https://www.cnblogs.com/jiu0821/p/9854704.html)

---

# NetğŸ•µğŸ»
## ç«¯å£

**æŸ¥**
```bash
getent services # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„é»˜è®¤ç«¯å£åç§°å’Œç«¯å£å·

lsof -i -P  # æ˜¾ç¤ºè¿›ç¨‹ä½¿ç”¨ç«¯å£ä½¿ç”¨æƒ…å†µ
lsof -i:22  # åªæŸ¥ 22 ç«¯å£

ss -tnlp
ss -tnlp | grep ssh
ss -tnlp | grep ":22"

etstat -tnlp
netstat -tnlp | grep ssh

nmap -sV -p 22 localhost
```

---

## Firewall
**æŸ¥**
```bash
firewall-cmd --list-services  # æŸ¥çœ‹é˜²ç«å¢™è®¾ç½®
```

**é˜²**
```bash
firewall-cmd --permanent --zone=public --remove-service=ssh
firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=internal --add-source=1.1.1.1
firewall-cmd --reload   # é‡å¯é˜²ç«å¢™æœåŠ¡
```

åœ¨ä¸Šé¢çš„é…ç½®ä¸­,å¦‚æœæœ‰äººå°è¯•ä» 1.1.1.1 å» ssh,è¿™ä¸ªè¯·æ±‚å°†ä¼šæˆåŠŸ,å› ä¸ºè¿™ä¸ªæºåŒºåŸŸ(internal)è¢«é¦–å…ˆåº”ç”¨,å¹¶ä¸”å®ƒå…è®¸ ssh è®¿é—®.

å¦‚æœæœ‰äººå°è¯•ä»å…¶å®ƒçš„åœ°å€,å¦‚ 2.2.2.2,å»è®¿é—® ssh,å®ƒä¸æ˜¯è¿™ä¸ªæºåŒºåŸŸçš„,å› ä¸ºå’Œè¿™ä¸ªæºåŒºåŸŸä¸åŒ¹é….å› æ­¤,è¿™ä¸ªè¯·æ±‚è¢«ç›´æ¥è½¬åˆ°æ¥å£åŒºåŸŸ(public),å®ƒæ²¡æœ‰æ˜¾å¼å¤„ç† ssh,å› ä¸º,public çš„ç›®æ ‡æ˜¯ default,è¿™ä¸ªè¯·æ±‚è¢«ä¼ é€’åˆ°é»˜è®¤åŠ¨ä½œ,å®ƒå°†è¢«æ‹’ç».

å¦‚æœ 1.1.1.1 å°è¯•è¿›è¡Œ http è®¿é—®ä¼šæ€æ ·ï¼ŸæºåŒºåŸŸ(internal)ä¸å…è®¸å®ƒ,ä½†æ˜¯,ç›®æ ‡æ˜¯ default,å› æ­¤,è¯·æ±‚å°†ä¼ é€’åˆ°æ¥å£åŒºåŸŸ(public),å®ƒè¢«å…è®¸è®¿é—®.

ç°åœ¨,è®©æˆ‘ä»¬å‡è®¾æœ‰äººä» 3.3.3.3 æ‹–ä½ çš„ç½‘ç«™.è¦é™åˆ¶ä»é‚£ä¸ª IP çš„è®¿é—®,ç®€å•åœ°å¢åŠ å®ƒåˆ°é¢„å®šä¹‰çš„ drop åŒºåŸŸ,æ­£å¦‚å…¶å,å®ƒå°†ä¸¢å¼ƒæ‰€æœ‰çš„è¿æ¥ï¼š
```bash
firewall-cmd --permanent --zone=drop --add-source=3.3.3.3
firewall-cmd --reload
```
ä¸‹ä¸€æ¬¡ 3.3.3.3 å°è¯•å»è®¿é—®ä½ çš„ç½‘ç«™,firewalld å°†è½¬å‘è¯·æ±‚åˆ°æºåŒºåŸŸ(drop).å› ä¸ºç›®æ ‡æ˜¯ DROP,è¯·æ±‚å°†è¢«æ‹’ç»,å¹¶ä¸”å®ƒä¸ä¼šè¢«è½¬å‘åˆ°æ¥å£åŒºåŸŸ(public).

`æ³¨:é…ç½®äº† firewalld æœåŠ¡åä¸€å®šè¦å»æ£€æŸ¥ä¸‹è§„åˆ™,å› ä¸ºä»–ä¸ä¼šé˜»æ‰æ­£åœ¨è¿›è¡Œçš„è¿æ¥,åªèƒ½é˜»æ‰é…ç½®å‘½ä»¤åè¿›è¡Œçš„è¿æ¥,æ‰€ä»¥ä½ ä¸çŸ¥é“ä½ çš„sshä¼šè¯ä¼šä¸ä¼šä¸€æ–­å°±å†ä¹Ÿè¿ä¸ä¸Šäº†,è¡€çš„æ•™è®­ğŸ¤£`

---

## ç¦ ping
**ä¸´æ—¶æ€§,é‡å¯åå¤±æ•ˆ**
```bash
echo 0 >/proc/sys/net/ipv4/icmp_echo_ignore_all # å…è®¸ ping
echo 1 >/proc/sys/net/ipv4/icmp_echo_ignore_all # ç¦æ­¢ ping
```

**é•¿æœŸæ€§**
```bash
vim /etc/rc.d/rc.local

echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all
```

æˆ–

```bash
vim /etc/sysctl.conf

net.ipv4.icmp_echo_ignore_all=1
```

`sysctl -p` ä½¿æ–°é…ç½®ç”Ÿæ•ˆ

---

## SSH

**æŸ¥**
- **æŸ¥çœ‹å°è¯•æš´åŠ›ç ´è§£æœºå™¨å¯†ç çš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for root" /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for root" /var/log/secure | awk '{print $11}' | sort | uniq -c | sort -nr | more
    ```

- **æŸ¥çœ‹æš´åŠ›çŒœç”¨æˆ·åçš„äºº**
    ```bash
    # Debian ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for invalid user" /var/log/auth.log | awk '{print $13}' | sort | uniq -c | sort -nr | more

    # Red Hat ç³»çš„å‘è¡Œç‰ˆ
    sudo grep "Failed password for invalid user" /var/log/secure | awk '{print $13}' | sort | uniq -c | sort -nr | more
    ```

**é˜²**
- **éªšæ“ä½œ:ping é’¥åŒ™**
    - [ä½¿ç”¨ ping é’¥åŒ™ä¸´æ—¶å¼€å¯ SSH:22 ç«¯å£,å®ç°è¿œç¨‹å®‰å…¨ SSH ç™»å½•ç®¡ç†å°±è¿™ä¹ˆç®€å•](https://www.cnblogs.com/martinzhang/p/5348769.html)

    ```bash
    # è§„åˆ™1 åªæ¥å—Dataä¸º1078å­—èŠ‚çš„pingåŒ…,å¹¶å°†æºIPè®°å½•åˆ°è‡ªå®šä¹‰åä¸ºsshKeyListçš„åˆ—è¡¨ä¸­
    iptables -A INPUT -p icmp -m icmp --icmp-type 8 -m length --length 1078 -m recent --name sshKeyList --set -j ACCEPT

    # è§„åˆ™2 è‹¥30ç§’å†…å‘é€æ¬¡æ•°è¾¾åˆ°6æ¬¡(åŠæ›´é«˜),å½“å‘èµ·SSH:22æ–°è¿æ¥è¯·æ±‚æ—¶æ‹’ç»
    iptables -A INPUT -p tcp -m tcp --dport 22 --syn -m recent --name sshKeyList --rcheck --seconds 30 --hitcount 6 -j DROP

    # è§„åˆ™3 è‹¥30ç§’å†…å‘é€æ¬¡æ•°è¾¾åˆ°5æ¬¡,å½“å‘èµ·SSH:22æ–°è¿æ¥è¯·æ±‚æ—¶æ”¾è¡Œ
    iptables -A INPUT -p tcp -m tcp --dport 22 --syn -m recent --name sshKeyList --rcheck --seconds 30 --hitcount 5 -j ACCEPT

    # è§„åˆ™4 å¯¹äºå·²å»ºç«‹çš„è¿æ¥æ”¾è¡Œ
    iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT

    # è§„åˆ™5 è€è§„çŸ©ï¼šæœ€åçš„æ‹’ç»
    iptables -A INPUT -j DROP
    ```

- **æ›´æ”¹é»˜è®¤ç«¯å£**

    ä¿®æ”¹ `/etc/ssh/sshd_config` æ–‡ä»¶,å°†å…¶ä¸­çš„ Port 22 æ”¹ä¸ºæŒ‡å®šçš„ç«¯å£

    `!!! è­¦å‘Š,è®°å¾—é˜²ç«å¢™è¦å…ˆæ”¾è¡Œç«¯å£,ä¸ç„¶ä½ çš„è¿œç¨‹ä¸»æœºå°±è¿ä¸ä¸Šäº†ğŸ¤£!!!`
    ```
    service ssh restart
    ```

- **é…ç½®ä½¿ç”¨ RSA ç§é’¥ç™»é™†**

    1. å…ˆç”Ÿæˆä½ çš„å®¢æˆ·ç«¯çš„å¯†é’¥,åŒ…æ‹¬ä¸€ä¸ªç§é’¥å’Œå…¬é’¥
    2. æŠŠå…¬é’¥æ‹·è´åˆ°æœåŠ¡å™¨ä¸Š,æ³¨æ„,ç”Ÿæˆç§é’¥çš„æ—¶å€™,æ–‡ä»¶åæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„,ä¸”å¯ä»¥å†åŠ ä¸€å±‚å¯†ç ,æ‰€ä»¥å»ºè®®æ–‡ä»¶åå–è‡ªå·±èƒ½è¯†åˆ«å‡ºå“ªå°æœºå™¨çš„åå­—.
    3. ç„¶ååœ¨æœåŠ¡å™¨ä¸Š,ä½ çš„ç”¨æˆ·ç›®å½•ä¸‹,æ–°å»º `.ssh` æ–‡ä»¶å¤¹,å¹¶å°†è¯¥æ–‡ä»¶å¤¹çš„æƒé™è®¾ä¸º 700
    4. æ–°å»ºä¸€ä¸ª authorized_keys,è¿™æ˜¯é»˜è®¤å…è®¸çš„ key å­˜å‚¨çš„æ–‡ä»¶.å¦‚æœå·²ç»å­˜åœ¨,åˆ™åªéœ€è¦å°†ä¸Šä¼ çš„ id_rsa.pub æ–‡ä»¶å†…å®¹è¿½åŠ è¿›å»å³å¯,å¦‚æœä¸å­˜åœ¨åˆ™æ–°å»ºå¹¶æ”¹æƒé™ä¸º 400 å³å¯. ç„¶åç¼–è¾‘ ssh çš„é…ç½®æ–‡ä»¶

    ```bash
    ssh-keygen -t rsa
    scp id_rsa.pub root@XX.XX.XX.XX:~/
    ```
    ```bash
    cd /
    mkdir .ssh
    chmod 700 .ssh
    mv id_rsa.pub .ssh
    cd .ssh
    cat id_rsa.pub >> authorized_keys
    chmod 600 authorized_keys
    ```
    ```vim
    vim /etc/ssh/sshd_config

    RSAAuthentication yes   # RSA è®¤è¯
    PubkeyAuthentication yes    # å¼€å¯å…¬é’¥éªŒè¯
    AuthorizedKeysFile /root/.ssh/authorized_keys   # éªŒè¯æ–‡ä»¶è·¯å¾„
    PasswordAuthentication no   # ç¦æ­¢å¯†ç ç™»å½•
    ```

    `sudo service sshd restart` é‡å¯ sshd æœåŠ¡

- **ç¦æ­¢ root ç”¨æˆ·ç™»å½•**

    å¯ä»¥å»ºä¸€ä¸ªç”¨æˆ·æ¥ä¸“é—¨ç®¡ç†,è€Œéç›´æ¥ä½¿ç”¨ root ç”¨æˆ·,ä¿®æ”¹ /etc/ssh/sshd_config
    ```vim
    vim /etc/ssh/sshd_config

    PermitRootLogin no
    ```

- **ä½¿ç”¨ Fail2ban**

    - [fail2ban](https://github.com/fail2ban/fail2ban) ,è¯¦ç»†æ­å»ºæ­¥éª¤è¯·ç§»æ­¥ [Power-Linux](./Power-Linux.md##[Fail2ban](https://github.com/fail2ban/fail2ban))

---

`çœŸæ­£çš„äºº,çœŸæ­£çš„äº‹,å¾€å¾€ä¸åŠå¿ƒä¸­æ‰€æƒ³çš„é‚£ä¹ˆå¥½.(é‡‘åº¸ã€Šå€šå¤©å± é¾™è®°ã€‹)`
